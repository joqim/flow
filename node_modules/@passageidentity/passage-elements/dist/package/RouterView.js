"use strict";var e=Object.defineProperty,t=Object.defineProperties,i=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,a=Object.prototype.propertyIsEnumerable,r=(t,i,n)=>i in t?e(t,i,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[i]=n,l=(e,t)=>{for(var i in t||(t={}))o.call(t,i)&&r(e,i,t[i]);if(n)for(var i of n(t))a.call(t,i)&&r(e,i,t[i]);return e},s=(e,n)=>t(e,i(n)),c=(e,t,i)=>new Promise(((n,o)=>{var a=e=>{try{l(i.next(e))}catch(t){o(t)}},r=e=>{try{l(i.throw(e))}catch(t){o(t)}},l=e=>e.done?n(e.value):Promise.resolve(e.value).then(a,r);l((i=i.apply(e,t)).next())})),u=require("./customElements.js"),d=(e=>(e.onLoaded="onLoaded",e.onRegisterDevice="onRegisterDevice",e.onVerifyIdentity="onVerifyIdentity",e.onMagicLinkLogin="onMagicLinkLogin",e.onMagicLinkRegister="onMagicLinkRegister",e.onMagicLinkActivated="onMagicLinkActivated",e.onMagicLinkActivateSuccess="onMagicLinkActivateSuccess",e))(d||{});const p=()=>!0,m=e=>{window.location.href=e.redirect_url},f=()=>{},g=u.ref(p),v=u.ref(m),h=u.ref(f);function k(e){g.value=void 0!==e?e:p}function y(e){v.value=void 0!==e?e:m}function B(e){h.value=void 0!==e?e:f}function w(){return{beforeAuth:u.readonly(g),onSuccess:u.readonly(v),onEvent:u.readonly(h),setBeforeAuth:k,setOnSuccess:y,setOnEvent:B}}const b={component:"auth-view"},S={component:"register-device-view"},C={component:"magic-link-view"},I={component:"webauthn-sign-in-view"},V={component:"activate-magic-link-view"};const x=u.reactive(new class{constructor(){this._history=[],this._homeRoute=b,this._history.push(this._homeRoute)}get homeRoute(){return this._homeRoute}set homeRoute(e){this._homeRoute=e,this._history[0]=e}get currentRoute(){return this._history[this._history.length-1]}push(e,t){this._history.push(s(l({},e),{props:t}))}resetRouter(){this._history=[],this._homeRoute=b,this._history.push(this._homeRoute)}}),E=u.computed((()=>x.currentRoute));function N(){return{router:x,currentRoute:E}}function _(){const e=u.ref();return u.watch(e,(()=>{void 0!==e.value&&e.value.focus()})),{autofocusButton:e}}const M=u.defineComponent({name:"AddDevice",components:{InlineSvg:u.InlineSvg,PlatformIcon:u._sfc_main},props:{authResult:{type:Object,required:!1}},setup(e){const{t:t}=u.useLocale(),{appId:i}=u.useAppId(),n=u.ref(!1),o=u.ref(!1),a=u.ref(),{addDevice:r,addPending:l,errorMessage:s}=u.useAddDevice(i.value),{autofocusButton:d}=_(),p=u.computed((()=>n.value?t("something-went-wrong"):t("success")));return{showSuccess:o,showFailure:n,title:p,addPending:l,errorMessage:s,newDevice:a,onButtonClick:function(){return c(this,null,(function*(){var t,i;a.value=yield r(),(null==(t=a.value)?void 0:t.id)?(o.value=!0,n.value=!1,(null==(i=e.authResult)?void 0:i.redirect_url)&&w().onSuccess.value(e.authResult)):(n.value=!0,o.value=!1)}))},onSkipButtonClick:()=>{var t;(null==(t=e.authResult)?void 0:t.redirect_url)&&w().onSuccess.value(e.authResult)},Icons:u.Icons,t:t,autofocusButton:d}}}),D={class:"image has-text-centered"},L={class:"content has-text-centered","data-test":"activate-magic-link-message"},R={key:0},A={key:1},T={style:{"margin-bottom":"10px"}},F={style:{"margin-bottom":"10px"}},W={style:{"margin-bottom":"10px"}},P={class:"flex-row flex-center",style:{padding:"20px 0px"}},U=["disabled"],q={key:0},$={key:1},z={key:0,class:"link has-text-centered"};var O=u._export_sfc(M,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("inline-svg"),l=u.resolveComponent("platform-icon");return u.openBlock(),u.createElementBlock(u.Fragment,null,[u.createBaseVNode("div",{class:u.normalizeClass(["title has-text-centered",[e.showFailure?"secondary-title":"main-title"]])},u.toDisplayString(e.title),3),u.createBaseVNode("figure",D,[e.showFailure?(u.openBlock(),u.createBlock(r,{key:0,src:e.Icons.fingerprintFailed,alt:"Device failure"},null,8,["src"])):(u.openBlock(),u.createBlock(l,{key:1}))]),u.createBaseVNode("div",L,[e.showFailure?(u.openBlock(),u.createElementBlock("div",R,u.toDisplayString(e.t("failed-to-add-this-device")),1)):(u.openBlock(),u.createElementBlock("div",A,[u.createBaseVNode("div",T,[u.createBaseVNode("strong",null,u.toDisplayString(e.t("save-device")),1)]),u.createBaseVNode("div",F,u.toDisplayString(e.t("trust-device")),1),u.createBaseVNode("div",W,u.toDisplayString(e.t("does-not-give-app-personal-info")),1)]))]),u.createBaseVNode("div",P,[u.createBaseVNode("button",{onClick:t[0]||(t[0]=u.withModifiers(((...t)=>e.onButtonClick&&e.onButtonClick(...t)),["prevent"])),type:"button",class:u.normalizeClass(["button is-primary",{"is-loading":e.addPending}]),part:"button",disabled:e.addPending,"data-test":"save-device-button",ref:"autofocusButton"},[e.showFailure?(u.openBlock(),u.createElementBlock("span",q,u.toDisplayString(e.t("try-again")),1)):(u.openBlock(),u.createElementBlock("span",$,u.toDisplayString(e.t("continue")),1))],10,U)]),e.showSuccess?u.createCommentVNode("",!0):(u.openBlock(),u.createElementBlock("div",z,[u.createBaseVNode("div",null,[u.createBaseVNode("a",{onClick:t[1]||(t[1]=u.withModifiers(((...t)=>e.onSkipButtonClick&&e.onSkipButtonClick(...t)),["prevent"])),role:"button","data-test":"add-device-skip"},u.toDisplayString(e.t("skip")),1)])]))],64)}]]);function j(e){const t=u.ref(!1),i=u.ref(!1),n="function"==typeof window.webkitConvertPointFromNodeToPage,o=()=>c(this,null,(function*(){const t=yield e.appInfo();return e.checkWebauthnConfig(t)?i.value=yield e.isWebauthnSupported(!1):i.value=!1,i.value})),a=n=>{const o=n.split(".")[2];return t.value=!(!i.value||!e.credIDExists(o)),t.value};return{deviceRecognized:t,webauthnAllowed:i,userGestureRequired:n,checkWebauthnAndDeviceRecognized:e=>c(this,null,(function*(){yield o(),a(e)})),verifyWebAuthnAllowed:o,isDeviceRecognized:a}}var H=(e=>(e.LOGIN="psg_magic_link",e.VERIFY="psg_verify_link",e))(H||{});function G(e){return c(this,null,(function*(){if(e&&"string"==typeof e)return void localStorage.setItem("psg_last_login",e);let t=e;if(void 0===e){const{appId:e}=u.useAppId(),i=new u.Qe(e.value);t=yield i.getCurrentUser().userInfo()}void 0!==t&&localStorage.setItem("psg_last_login",t.email?t.email:t.phone)}))}const Q=({magicLink:e,uiState:t,magicLinkUtils:i,passage:n,webauthnUtils:o})=>{const a=u.ref(null),r=()=>{t.uiLoading({addDevice:!1}),a.value={auth_token:"",redirect_url:""}},l=()=>{t.uiError()},s=()=>{i.invalidMagicLink.value=!0,t.uiError()},d=e=>c(this,[e],(function*({addDevice:e=!1,result:i}){a.value=i;G(yield n.getCurrentUser().userInfo()),t.uiSuccess({addDevice:e}),yield new Promise((e=>{setTimeout(e,1e3)})),a.value.redirect_url&&!t.showAddDevice.value&&w().onSuccess.value(a.value)})),p=()=>c(this,null,(function*(){r();try{const t=yield n.magicLinkActivate(e);d({addDevice:o.webauthnAllowed.value,result:t})}catch(t){t.statusCode===u.M.NotFound?s():l()}}));return{authResult:a,onBeforeActivate:r,onActivateError:l,onActivateErrorInvalidMagicLink:s,onActivateSuccess:d,activateWithoutBiometrics:p,activateWithBiometrics:()=>c(this,null,(function*(){r();try{const t=yield n.magicLinkActivateWebAuthnLogin(e);d({addDevice:!1,result:t})}catch(t){const e=t;e.statusCode===u.M.NotFound?s():e.statusCode===u.M.PSGCredObjectDoesNotExist||e.statusCode===u.M.Unauthorized?p():l()}}))}},Y=u.defineComponent({name:"ActivateMagicLink",props:{magicLink:{type:String,required:!0}},components:{AddDevice:O,InlineSvg:u.InlineSvg,PlatformIcon:u._sfc_main},setup(e){const{t:t}=u.useLocale(),{appId:i}=u.useAppId(),n=new u.Qe(i.value),o=function(){const e=u.ref(!1),t=u.ref(!1),i=u.ref(!1),n=u.ref(!0),o=u.ref(!1),{t:a}=u.useLocale(),r=u.computed((()=>t.value?a("success"):e.value?a("something-went-wrong"):a("verify-your-identity")));return{showFailure:e,showSuccess:t,loading:i,pageLoading:n,showAddDevice:o,title:r,uiSuccess:({addDevice:n=!1})=>{t.value=!0,e.value=!1,o.value=n,i.value=!1},uiError:()=>{t.value=!1,e.value=!0,o.value=!1,i.value=!1},uiLoading:({addDevice:n=!1})=>{t.value=!1,e.value=!1,o.value=n,i.value=!0}}}(),a=j(n),r=(e=>{const t=u.ref(),i=u.ref(!1);return{magicLinkAction:t,invalidMagicLink:i,isMagicLinkValid:()=>{const n=new URLSearchParams(window.location.href.split("?")[1]);return n.has("psg_magic_link")?t.value="psg_magic_link":n.has("psg_verify_link")&&(t.value="psg_verify_link"),t.value&&e||(i.value=!0),!i.value}}})(e.magicLink),p=Q({uiState:o,webauthnUtils:a,magicLinkUtils:r,passage:n,magicLink:e.magicLink});return u.onMounted((()=>c(this,null,(function*(){if(r.isMagicLinkValid()){yield a.checkWebauthnAndDeviceRecognized(e.magicLink);const t=!a.deviceRecognized.value||!a.webauthnAllowed.value||!a.userGestureRequired&&a.deviceRecognized.value,i=!a.userGestureRequired&&a.deviceRecognized.value;t&&(i?p.activateWithBiometrics():p.activateWithoutBiometrics()),w().onEvent.value(d.onMagicLinkActivateSuccess)}else o.uiError();o.pageLoading.value=!1})))),s(l(l(l({},o),a),r),{activation:p,MagicLinkActionEnum:H,onButtonClick:function(){r.invalidMagicLink.value?window.location.href=window.location.href.split("?")[0]:a.deviceRecognized.value?p.activateWithBiometrics():p.activateWithoutBiometrics()},redirectNow:function(){var e;(null==(e=p.authResult.value)?void 0:e.redirect_url)&&w().onSuccess.value(p.authResult.value)},Icons:u.Icons,t:t})}}),K={class:"auth-flex-container"},Z={class:"image has-text-centered"},J={class:"content has-text-centered","data-test":"activate-magic-link-message"},X={key:0},ee={key:1},te={key:2},ie={key:3},ne={key:4},oe={key:5},ae={key:6},re={key:7},le={key:8},se={key:0,class:"flex-row flex-center",style:{padding:"20px 0px"}},ce=["disabled"],ue={key:0},de={key:1},pe={key:2},me={key:3};var fe=u._export_sfc(Y,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("inline-svg"),l=u.resolveComponent("platform-icon"),s=u.resolveComponent("AddDevice");return u.openBlock(),u.createElementBlock(u.Fragment,null,[u.withDirectives(u.createBaseVNode("div",K,[u.createBaseVNode("div",{class:u.normalizeClass(["title has-text-centered",[e.showSuccess?"main-title":"secondary-title"]])},u.toDisplayString(e.showFailure?e.invalidMagicLink?e.t("invalid-link"):e.t("device-login-failed-title"):e.title),3),u.createBaseVNode("figure",Z,[e.showSuccess&&e.webauthnAllowed?(u.openBlock(),u.createBlock(r,{key:0,src:e.Icons.fingerprintSuccess,alt:"Device success"},null,8,["src"])):e.showSuccess&&!e.webauthnAllowed?(u.openBlock(),u.createBlock(r,{key:1,src:e.Icons.emailSuccess,alt:"Magic link success"},null,8,["src"])):e.showFailure&&e.magicLinkAction===e.MagicLinkActionEnum.VERIFY?(u.openBlock(),u.createBlock(r,{key:2,src:e.Icons.emailFailed,alt:"Magic link failure"},null,8,["src"])):e.showFailure&&e.invalidMagicLink?(u.openBlock(),u.createBlock(r,{key:3,src:e.Icons.emailFailed,alt:"Magic link failure"},null,8,["src"])):e.showFailure&&e.webauthnAllowed?(u.openBlock(),u.createBlock(r,{key:4,src:e.Icons.fingerprintFailed,alt:"Device failure"},null,8,["src"])):e.webauthnAllowed?(u.openBlock(),u.createBlock(l,{key:5})):u.createCommentVNode("",!0)]),u.createBaseVNode("div",J,[e.showSuccess&&e.magicLinkAction===e.MagicLinkActionEnum.LOGIN?(u.openBlock(),u.createElementBlock("div",X,u.toDisplayString(e.t("successfully-logged-in-redirect")),1)):e.showSuccess&&e.magicLinkAction===e.MagicLinkActionEnum.VERIFY?(u.openBlock(),u.createElementBlock("div",ee,u.toDisplayString(e.t("successfully-changed-email")),1)):e.showFailure&&e.invalidMagicLink&&e.magicLinkAction===e.MagicLinkActionEnum.VERIFY?(u.openBlock(),u.createElementBlock("div",te,u.toDisplayString(e.t("link-invalid")),1)):e.showFailure&&e.invalidMagicLink?(u.openBlock(),u.createElementBlock("div",ie,u.toDisplayString(e.t("login-link-invalid")),1)):e.showFailure&&e.magicLinkAction===e.MagicLinkActionEnum.VERIFY?(u.openBlock(),u.createElementBlock("div",ne,u.toDisplayString(e.t("verification-failed-please-try-again")),1)):e.showFailure?(u.openBlock(),u.createElementBlock("div",oe,u.toDisplayString(e.t("device-login-failed")),1)):e.webauthnAllowed&&e.magicLinkAction===e.MagicLinkActionEnum.LOGIN?(u.openBlock(),u.createElementBlock("div",ae,u.toDisplayString(e.t("log-in-to-proceed")),1)):e.webauthnAllowed&&e.magicLinkAction===e.MagicLinkActionEnum.VERIFY?(u.openBlock(),u.createElementBlock("div",re,u.toDisplayString(e.t("verify-your-identity-with-device")),1)):e.webauthnAllowed?(u.openBlock(),u.createElementBlock("div",le,u.toDisplayString(e.t("log-into-your-account-extended")),1)):u.createCommentVNode("",!0)]),e.userGestureRequired||e.showFailure||e.showSuccess?(u.openBlock(),u.createElementBlock("div",se,[u.createBaseVNode("button",{onClick:t[0]||(t[0]=u.withModifiers(((...t)=>e.onButtonClick&&e.onButtonClick(...t)),["prevent"])),type:"button",class:u.normalizeClass(["button is-primary",{"is-loading":e.loading,small:e.showFailure&&e.invalidMagicLink}]),part:"button",disabled:e.loading,"data-test":"activate-magic-link-button"},[e.showFailure&&e.invalidMagicLink?(u.openBlock(),u.createElementBlock("span",ue,u.toDisplayString(e.t("request-new-link")),1)):e.showFailure?(u.openBlock(),u.createElementBlock("span",de,u.toDisplayString(e.t("try-again")),1)):e.showSuccess?(u.openBlock(),u.createElementBlock("span",pe,u.toDisplayString(e.t("redirect-now")),1)):(u.openBlock(),u.createElementBlock("span",me,u.toDisplayString(e.t("login-with-device")),1))],10,ce)])):u.createCommentVNode("",!0)],512),[[u.vShow,!e.pageLoading&&!e.showAddDevice]]),!e.pageLoading&&e.showAddDevice?(u.openBlock(),u.createElementBlock("div",{key:0,class:"auth-flex-container",style:u.normalizeStyle(e.showFailure?"justify-content: space-between":"")},[u.createVNode(s,{"auth-result":e.activation.authResult.value},null,8,["auth-result"])],4)):u.createCommentVNode("",!0)],64)}]]);const ge=u.defineComponent({name:"ActivateMagicLinkView",props:{magicLink:{type:String,required:!0}},components:{ActivateMagicLink:fe}}),ve={class:"view-verify-token"};var he=u._export_sfc(ge,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("activate-magic-link");return u.openBlock(),u.createElementBlock("div",ve,[u.createVNode(r,{magicLink:e.magicLink},null,8,["magicLink"])])}]]);function ke(){const{router:e}=N();u.onMounted((()=>{const t=window.location.search,i=new URLSearchParams(t);let n=null;i.has("psg_magic_link")?n=i.get("psg_magic_link"):i.has("psg_verify_link")&&(n=i.get("psg_verify_link")),null!==n&&e.push(V,{magicLink:n})}))}var ye=(e=>(e.phone="PHONE",e.email="EMAIL",e))(ye||{});const Be=u.defineComponent({name:"ValidatedIdentiferForm",emits:["onSubmit","update:validationError","update:identifier","update:countryCode","update:showWelcomeBack"],props:{appId:{type:String,required:!0},validationError:{type:String,default:""},identifier:{type:String,required:!0},countryCode:{type:String,required:!0},identifierMode:{type:String,required:!0},showWelcomeBack:{type:Boolean,default:!1}},setup(e,t){const{t:i}=u.useLocale(),n=u.ref(""),o=u.ref(),a=u.ref(),{autofocusButton:r}=_(),l=u.computed((()=>e.showWelcomeBack)),s=u.computed((()=>{let t;switch(e.identifierMode){case u.bt.phone:t=i("phone-number");break;case u.bt.email:t=i("email-address");break;case u.bt.both:t=i("email-or-phone-number")}return t.charAt(0).toUpperCase()+t.slice(1)})),d=u.computed((()=>"example@email.com")),p=u.computed((()=>e.identifierMode===u.bt.phone?"tel":"email")),m=u.computed({get:()=>e.identifier,set(e){t.emit("update:identifier",e)}});function f(){var e;if(!m.value)return"";let t=m.value;return l.value||(t=h()?null!=(e=null==k?void 0:k.getNumber())?e:"":m.value),t.trim().toLowerCase()}const g=u.computed((()=>u.isStringNullish(e.validationError)?u.isStringNullish(n.value)?"":n.value:e.validationError));function v(){return/^(([^<>()[\]\\.,;:\s@"]+(\.[^<>()[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/.test(f())}function h(){return l.value?w():void 0!==k&&k.isValidNumber()}let k;function y(){void 0===k&&(o.value.addEventListener("countrychange",(()=>{var e;t.emit("update:countryCode",null!=(e=null==k?void 0:k.getSelectedCountryData().iso2)?e:"")})),k=u.intlTelInput(o.value,{initialCountry:e.countryCode,utilsScript:"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js",dropdownContainer:a.value,autoPlaceholder:"aggressive"}),o.value.focus())}const B=u.ref();function w(){return/^\+$|^\+?[0-9,(,),\-, ]+$/.test(m.value.trim())}u.onMounted((()=>{e.identifierMode===u.bt.phone&&y()})),e.identifierMode===u.bt.both&&u.watch(m,(()=>{w()?y():void 0!==k&&(k.destroy(),k=void 0,o.value&&o.value.focus())}));const b=u.computed((()=>e.countryCode));return u.watch(b,(e=>{null==k||k.setCountry(e)})),{error:g,identifierText:m,checkIdentifier:function(){return c(this,null,(function*(){if(!function(){if(""===f()){let t="";switch(e.identifierMode){case u.bt.phone:t=i("enter-a-phone-number");break;case u.bt.email:t=i("enter-an-email-address");break;case u.bt.both:t=i("enter-an-email-or-phone-number")}return n.value=t,!1}if(e.identifierMode===u.bt.email&&!v())return n.value=i("enter-a-valid-email-address"),!1;if(e.identifierMode===u.bt.phone&&!h())return n.value=i("enter-a-valid-phone-number"),!1;if(e.identifierMode===u.bt.both&&!h()&&!v())return n.value=i("enter-a-valid-email-or-phone-number"),!1;return!0}())return;const o=new u.Qe(e.appId);let a,r,l,s,c,d=!1,p="";try{const e=yield o.identifierExists(f());null!==e?(a=!0,r=e.webauthn,c=e.status,p=e.id,s=e.email_verified,d=e.phone_verified,l=e.webauthn_types.includes(u.vt.Passkey)):(a=!1,r=!1,c=u.St.INACTIVE)}catch(m){let t;switch(e.identifierMode){case u.bt.email:t=i("enter-a-valid-email-address");break;case u.bt.phone:t=i("enter-a-valid-phone-number");break;case u.bt.both:t=i("enter-a-valid-email-or-phone-number")}return void(n.value=t)}t.emit("onSubmit",{identifier:f(),identifierExists:a,identifierType:h()?ye.phone:ye.email,userHasWebauthn:r,userStatus:c,userID:p,emailVerified:s,phoneVerified:d,userHasPasskey:l})}))},clearErrors:function(){n.value="",t.emit("update:validationError","")},identifierInput:o,controlContainer:a,placeholder:d,label:s,inputMode:p,moveInput:function(){o.value.getRootNode().host.appendChild(o.value)},labelRef:B,moveBack:function(){var e;null==(e=B.value)||e.append(o.value)},showWelcomeUI:l,switchAccount:function(){t.emit("update:showWelcomeBack",!1),m.value=""},t:i,autofocusButton:r}}}),we={class:"has-text-centered"},be=u.createBaseVNode("br",null,null,-1),Se=["autocomplete","inputmode","placeholder"],Ce={ref:"controlContainer",style:{width:"100%"}},Ie={class:"flex-row flex-center"},Ve={key:0,style:{"margin-top":"30px"},class:"link has-text-centered"};var xe=u._export_sfc(Be,[["render",function(e,t,i,n,o,a){return u.openBlock(),u.createElementBlock("form",{onSubmit:t[3]||(t[3]=u.withModifiers(((...t)=>e.checkIdentifier&&e.checkIdentifier(...t)),["prevent"]))},[u.withDirectives(u.createBaseVNode("div",we,[u.createTextVNode(u.toDisplayString(e.t("welcome-back-sign-in-as")),1),be,u.createBaseVNode("strong",null,u.toDisplayString(e.identifierText),1)],512),[[u.vShow,e.showWelcomeBack]]),u.withDirectives(u.createBaseVNode("div",null,[u.createBaseVNode("div",{class:"label",ref:"labelRef"},u.toDisplayString(e.label),513),u.withDirectives(u.createBaseVNode("input",{"onUpdate:modelValue":t[0]||(t[0]=t=>e.identifierText=t),type:"text",class:u.normalizeClass(["input",{"is-danger":e.error}]),part:"input",autocomplete:e.inputMode,inputmode:e.inputMode,id:"identifier",placeholder:e.placeholder,onInput:t[1]||(t[1]=u.withModifiers(((...t)=>e.clearErrors&&e.clearErrors(...t)),["prevent"])),ref:"identifierInput","data-test":"identifier-input"},null,42,Se),[[u.vModelText,e.identifierText]])],512),[[u.vShow,!e.showWelcomeBack]]),u.createBaseVNode("div",Ce,null,512),u.createBaseVNode("div",{style:u.normalizeStyle(`text-align: ${e.showWelcomeUI?"center":"left"};`),class:"help is-danger error-message","data-test":"validation-error"},u.toDisplayString(e.error),5),u.renderSlot(e.$slots,"default"),u.createBaseVNode("div",Ie,[u.createBaseVNode("button",{type:"submit",class:"button is-primary",part:"button","data-test":"continue-button",ref:"autofocusButton"},u.toDisplayString(e.t("continue")),513)]),e.showWelcomeUI?(u.openBlock(),u.createElementBlock("div",Ve,[u.createBaseVNode("a",{onClick:t[2]||(t[2]=u.withModifiers(((...t)=>e.switchAccount&&e.switchAccount(...t)),["prevent"])),role:"button","data-test":"register-link"},u.toDisplayString(e.t("switch-account")),1)])):u.createCommentVNode("",!0)],32)}]]);const Ee=u.defineComponent({name:"Login",components:{ValidatedIdentifierForm:xe},props:{canToggleLoginRegister:Boolean,identifier:{type:String,required:!0},countryCode:{type:String,required:!0},appInfo:{type:Object,required:!0},webauthnAllowed:{type:Boolean,required:!0},visible:{type:Boolean,default:!1}},emits:["update:identifier","update:countryCode"],setup(e,t){const{router:i}=N(),{appId:n}=u.useAppId(),{t:o}=u.useLocale(),a=u.ref(""),r=u.computed({get:()=>e.identifier,set(e){t.emit("update:identifier",e)}}),l=u.computed({get:()=>e.countryCode,set(e){t.emit("update:countryCode",e)}}),s=new u.Qe(n.value),p=u.ref();u.watch(p,(()=>c(this,null,(function*(){w().onEvent.value(d.onLoaded)}))));const m=u.computed((()=>{var t;return null!=(t=e.appInfo.allowed_identifier)?t:u.bt.email}));ke();const f=u.ref(!1);return u.onMounted((()=>{const e=localStorage.getItem("psg_last_login");e&&(r.value=e,f.value=!0)})),u.watch((()=>e.visible),(()=>{!0===f.value&&(r.value=""),f.value=!1})),{appId:n,error:a,identifierText:r,countryCodeText:l,onSubmit:function(t){return c(this,null,(function*(){const{identifier:n,identifierExists:r,userHasWebauthn:l,userHasPasskey:c,userStatus:p,userID:m,identifierType:f,emailVerified:g,phoneVerified:v}=t;if(!w().beforeAuth.value(n))return;const h=function(t,i,n){if(!t){let t=i===ye.email?o("email"):o("phone");t=t.charAt(0).toUpperCase()+t.slice(1);let n=o("not-recognized",[t]);return e.canToggleLoginRegister&&(n=n+". "+o("toggle-register")),n}if(t&&n===u.St.INACTIVE)return o("account-no-longer-active");return""}(r,f,p);if(""===h)if(function(t,i,n){if(e.appInfo.require_identifier_verification&&(n===ye.email&&!t||n===ye.phone&&!i))return!0;return!1}(g,v,f))i.push(C,{identifier:n,identifierType:f,identifierVerifying:!0});else{const t=yield s.browserInfo();if(c&&window.PublicKeyCredential&&t.getPassKeySupported)return w().onEvent.value(d.onVerifyIdentity),void i.push(I,{identifier:n,identifierType:f});e.webauthnAllowed?l&&s.credIDExists(m)?(w().onEvent.value(d.onVerifyIdentity),i.push(I,{identifier:n,identifierType:f})):(w().onEvent.value(d.onMagicLinkLogin),i.push(C,{identifier:n,identifierType:f,setupNewDevice:!0})):(w().onEvent.value(d.onMagicLinkLogin),i.push(C,{identifier:n,identifierType:f}))}else a.value=h}))},identifierMode:m,inputForm:p,showWelcomeBack:f}}});var Ne=u._export_sfc(Ee,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("validated-identifier-form");return u.openBlock(),u.createBlock(r,{appId:e.appId,identifierMode:e.identifierMode,showWelcomeBack:e.showWelcomeBack,"onUpdate:showWelcomeBack":t[0]||(t[0]=t=>e.showWelcomeBack=t),identifier:e.identifierText,"onUpdate:identifier":t[1]||(t[1]=t=>e.identifierText=t),validationError:e.error,"onUpdate:validationError":t[2]||(t[2]=t=>e.error=t),countryCode:e.countryCodeText,"onUpdate:countryCode":t[3]||(t[3]=t=>e.countryCodeText=t),onOnSubmit:t[4]||(t[4]=t=>e.onSubmit(t)),ref:"inputForm"},null,8,["appId","identifierMode","showWelcomeBack","identifier","validationError","countryCode"])}]]);const _e=u.defineComponent({name:"Register",props:{canToggleLoginRegister:Boolean,identifier:{type:String,required:!0},countryCode:{type:String,required:!0},appInfo:{type:Object,required:!0},webauthnAllowed:{type:Boolean,required:!0}},emits:["update:identifier","update:countryCode"],components:{ValidatedIdentifierForm:xe,UserMetadata:u.UserMetadata},setup(e,t){const{t:i}=u.useLocale(),{router:n}=N(),{appId:o}=u.useAppId(),a=u.ref(""),r=u.computed({get:()=>e.identifier,set(e){t.emit("update:identifier",e)}}),l=u.computed({get:()=>e.countryCode,set(e){t.emit("update:countryCode",e)}}),s=u.computed((()=>e.appInfo.public_signup)),p=u.computed((()=>e.appInfo.allowed_identifier));ke();const m=u.ref({}),f=u.ref();return{appId:o,error:a,identifierText:r,countryCodeText:l,onSubmit:function(t){return c(this,null,(function*(){const{identifier:r,identifierExists:l,userStatus:s,identifierType:c}=t;if(!w().beforeAuth.value(r))return;let p=!0;if(f.value&&(p=f.value.validate()),l){if(s===u.St.ACTIVE){let t=i("account-already-exists",[c===ye.email?i("email"):i("phone-number")]);return e.canToggleLoginRegister&&(t+=i("toggle-login")),void(a.value=t)}if(s===u.St.INACTIVE)return void(a.value=i("account-no-longer-active"))}const g=new u.Qe(o.value);if(p){try{yield g.createUser({identifier:r,user_metadata:u.transformMetadata(m.value,e.appInfo.user_metadata_schema,!0)})}catch(v){return void(v instanceof u._&&v.message.startsWith("Public signup")?a.value=v.message:a.value=i("unexpected-error"))}e.appInfo.require_identifier_verification?n.push(C,{identifier:r,identifierType:c,userIsRegistering:!0,identifierVerifying:!0}):e.webauthnAllowed?(w().onEvent.value(d.onRegisterDevice,{identifier:r}),n.push(S,{identifier:r,identifierType:c})):(w().onEvent.value(d.onMagicLinkRegister,{identifier:r}),n.push(C,{identifier:r,identifierType:c,userIsRegistering:!0}))}}))},identifierMode:p,metadata:m,metadataComponent:f,LayoutType:u.LayoutType,publicSignup:s,t:i}}}),Me={key:0,class:"notification is-danger has-text-centered","data-test":"invalid-app-id"};var De=u._export_sfc(_e,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("user-metadata"),l=u.resolveComponent("validated-identifier-form");return u.openBlock(),u.createElementBlock("div",null,[u.createVNode(l,{appId:e.appId,identifierMode:e.identifierMode,identifier:e.identifierText,"onUpdate:identifier":t[0]||(t[0]=t=>e.identifierText=t),validationError:e.error,"onUpdate:validationError":t[1]||(t[1]=t=>e.error=t),countryCode:e.countryCodeText,"onUpdate:countryCode":t[2]||(t[2]=t=>e.countryCodeText=t),onOnSubmit:t[3]||(t[3]=t=>e.onSubmit(t))},{default:u.withCtx((()=>[e.appInfo&&e.appInfo.layouts.registration.length>0?(u.openBlock(),u.createBlock(r,{key:0,isEditing:!0,appInfo:e.appInfo,layoutType:e.LayoutType.Registration,userMetadata:e.metadata,ref:"metadataComponent"},null,8,["appInfo","layoutType","userMetadata"])):u.createCommentVNode("",!0)])),_:1},8,["appId","identifierMode","identifier","validationError","countryCode"]),e.publicSignup?u.createCommentVNode("",!0):(u.openBlock(),u.createElementBlock("div",Me,u.toDisplayString(e.t("public-registration-not-allowed")),1))])}]]);class Le{newEphemeralApp(){return c(this,null,(function*(){const e=yield fetch("https://api.passage.id/v1/apps/",{method:"POST",body:JSON.stringify({auth_origin:window.location.origin,name:"Ephemeral Random "+(1e6*Math.random()).toString()})}),t=yield e.json();if(200!==e.status)throw t.message;return localStorage.setItem("psg_ephemeral_app_id",t.app.id),localStorage.setItem("psg_ephemeral_app_name",t.app.name),t}))}}const Re=u.defineComponent({name:"EphemeralAppInfo",setup(){const e="https://console.passage.id",{t:t}=u.useLocale(),i=u.ref(!1),n=u.ref(!1),o=u.ref(!1),a=u.ref(""),r=u.ref(""),l=()=>c(this,null,(function*(){const{appIdUnassigned:t,updateAppId:o}=u.useAppId();if(t.value){n.value=!0;const t=localStorage.getItem("psg_ephemeral_app_id"),l=localStorage.getItem("psg_ephemeral_app_name");if(t){const i=l?`?name=${encodeURIComponent(l)}`:"";a.value=`${e}/claim/${t}${i}`,o(t),d()}else try{const t=new Le,i=yield t.newEphemeralApp();o(i.app.id);const n=i.app.name?`?name=${encodeURIComponent(i.app.name)}`:"";a.value=`${e}/claim/${i.app.id}${n}`,d()}catch(r){i.value=!0,o("")}}})),s=()=>c(this,null,(function*(){const{appId:e}=u.useAppId();if(!n.value)return;const t=new u.Qe(e.value);try{(yield t.appInfo()).ephemeral||(o.value=!0,r.value=`<passage-auth app-id="${e.value}"/>`)}catch(a){i.value=!0}}));function d(){const{appId:e}=u.useAppId();console.info(`Passage Test App ID: ${e.value}`),console.info(`Claim your app: ${a.value}`)}return u.onBeforeMount((()=>c(this,null,(function*(){yield l(),yield s()})))),{error:i,isEphemeral:n,claimed:o,ephemeralClaimUrl:a,exampleTag:r,t:t}}}),Ae={key:0},Te={key:0,class:"notification is-danger"},Fe={key:1,class:"notification ephemeral-box","data-test":"ephemeral-app-message"},We={key:0},Pe=["href"],Ue=u.createTextVNode("."),qe={key:1},$e=u.createBaseVNode("br",null,null,-1);var ze=u._export_sfc(Re,[["render",function(e,t,i,n,o,a){return e.isEphemeral?(u.openBlock(),u.createElementBlock("div",Ae,[e.error?(u.openBlock(),u.createElementBlock("div",Te,u.toDisplayString(e.t("unable-to-create-test-app")),1)):(u.openBlock(),u.createElementBlock("div",Fe,[e.claimed?(u.openBlock(),u.createElementBlock("div",qe,[u.createTextVNode(u.toDisplayString(e.t("add-your-claimed-app-like-this"))+" ",1),$e,u.createTextVNode(u.toDisplayString(e.exampleTag),1)])):(u.openBlock(),u.createElementBlock("div",We,[u.createTextVNode(u.toDisplayString(e.t("currently-using-test-app"))+" ",1),u.createBaseVNode("a",{href:e.ephemeralClaimUrl,target:"_blank"},u.toDisplayString(e.t("click-here")),9,Pe),Ue]))]))])):u.createCommentVNode("",!0)}]]),Oe=(e=>(e.isTop="is-top",e.isBottom="is-bottom",e.isLeft="is-left",e.isRight="is-right",e))(Oe||{});const je=u.defineComponent({name:"Tooltip",components:{InlineSvg:u.InlineSvg},props:{label:String,active:{type:Boolean,default:!0},sticky:{type:Boolean,default:!1},position:{type:String,default:"is-top"},clickMode:{type:Boolean,default:!1},title:{type:String,default:""}},setup(e){const t=u.ref(),i=u.ref(),n=u.ref(0),o=u.ref(""),a=u.ref(""),r=u.ref(e.sticky),l=u.ref(e.sticky);function s(){if(void 0===t.value||null===t.value)return;const i=t.value,a=i.getRootNode().getElementById("passage-auth-container");if(null===a)return;const{left:r,right:l}=a.getBoundingClientRect(),{left:s,right:c,top:u}=i.getBoundingClientRect(),d=(c-s)/2+s,p=d-r-20,m=l-d-20;let f;const g=u-20;switch(e.position){case"is-top":case"is-bottom":f=l-r-20;break;case"is-left":f=p;break;case"is-right":f=m}o.value=`max-height: ${g}px;`,n.value=Math.min(f,500)}function c(){e.sticky||(clearTimeout(d),clearTimeout(p),l.value=!0,s(),setTimeout((()=>{r.value=!0,function(){var e;const n=t.value,{top:o}=n.getBoundingClientRect(),r=o-20;((null==(e=i.value)?void 0:e.scrollHeight)||0)>r&&(a.value=`height: ${r}px;`)}()}),100))}let d,p;function m(){e.sticky||(d=setTimeout((()=>{r.value=!1,p=setTimeout((()=>{l.value=!1}),150)}),100))}return u.onMounted((()=>{s()})),{parentItem:t,width:n,maxHeight:o,absoluteHeight:a,cssVisible:r,domVisible:l,show:c,hide:m,cancelHide:function(){clearTimeout(d),clearTimeout(p)},handleClick:function(){l.value?m():c()},Icons:u.Icons,tooltipBody:i}}}),He={key:0,class:"tooltip-header"},Ge={class:"tooltip-content"};var Qe=u._export_sfc(je,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("inline-svg");return u.openBlock(),u.createElementBlock("div",{class:u.normalizeClass(["passage-tooltip",`${e.position} ${e.cssVisible?"show-tooltip":""}`]),ref:"parentItem"},[e.active?u.withDirectives((u.openBlock(),u.createElementBlock("div",{key:0,class:u.normalizeClass(["passage-tooltip-body",e.position]),style:u.normalizeStyle(`max-width: ${e.width}px; ${e.maxHeight} ${e.absoluteHeight}`),onMouseenter:t[0]||(t[0]=u.withModifiers((t=>e.clickMode?()=>{}:e.cancelHide()),["stop"])),onMouseleave:t[1]||(t[1]=u.withModifiers((t=>e.clickMode?()=>{}:e.hide()),["stop"])),ref:"tooltipBody"},[e.title||e.clickMode?(u.openBlock(),u.createElementBlock("div",He,[u.createBaseVNode("div",null,u.toDisplayString(e.title),1),e.clickMode?(u.openBlock(),u.createBlock(r,{key:0,src:e.Icons.close,style:{cursor:"pointer"},onClick:u.withModifiers(e.hide,["stop"])},null,8,["src","onClick"])):u.createCommentVNode("",!0)])):u.createCommentVNode("",!0),u.createBaseVNode("div",Ge,[u.renderSlot(e.$slots,"tooltipBody",{},(()=>[u.createTextVNode(u.toDisplayString(e.label),1)]))])],38)),[[u.vShow,e.domVisible]]):u.createCommentVNode("",!0),u.createBaseVNode("div",{style:{cursor:"pointer","user-select":"none"},onMouseenter:t[2]||(t[2]=u.withModifiers((t=>e.clickMode?()=>{}:e.show()),["prevent"])),onMouseleave:t[3]||(t[3]=u.withModifiers((t=>e.clickMode?()=>{}:e.hide()),["prevent"])),onClick:t[4]||(t[4]=u.withModifiers(((...t)=>e.handleClick&&e.handleClick(...t)),["stop"]))},[u.renderSlot(e.$slots,"default")],32)],2)}]]);const Ye={style:{"border-top":"1px solid #dddddd","margin-top":"20px","padding-top":"15px"}},Ke={style:{"text-align":"left"}},Ze={style:{"margin-top":"10px"}},Je={class:"flex-row flex-center"},Xe={style:{opacity:"0.5"},class:"link"},et=u.defineComponent({props:{appInfo:null},setup(e){const t=e,{t:i}=u.useLocale(),n=u.computed$1((()=>{var e;switch(null==(e=t.appInfo)?void 0:e.allowed_identifier){case u.bt.phone:return i("phone-number");case u.bt.both:return i("email-or-phone-number");default:return i("email-address")}}));return(t,o)=>(u.openBlock(),u.createElementBlock("div",Ye,[u.createVNode(Qe,{title:u.unref(i)("where-is-the-password-field"),position:u.unref(Oe).isTop,clickMode:""},{tooltipBody:u.withCtx((()=>{var t,o;return[u.createBaseVNode("div",Ke,[u.createTextVNode(u.toDisplayString(u.unref(i)("helper-footer-line-1",[null!=(o=null==(t=e.appInfo)?void 0:t.name)?o:""]))+" ",1),u.createBaseVNode("ul",null,[u.createBaseVNode("li",null,u.toDisplayString(u.unref(i)("helper-footer-bullet-0")),1),u.createBaseVNode("li",null,u.toDisplayString(u.unref(i)("helper-footer-bullet-1")),1),u.createBaseVNode("li",null,u.toDisplayString(u.unref(i)("helper-footer-bullet-2",[u.unref(n)])),1)]),u.createBaseVNode("div",Ze,u.toDisplayString(u.unref(i)("helper-footer-line-2",[u.unref(n)])),1)])]})),default:u.withCtx((()=>[u.createBaseVNode("div",Je,[u.createBaseVNode("span",Xe,u.toDisplayString(u.unref(i)("where-is-the-password-field")),1),u.createVNode(u.unref(u.InlineSvg),{style:{"margin-left":"10px"},src:u.unref(u.Icons).help},null,8,["src"])])])),_:1},8,["title","position"])]))}}),tt={class:"view-email-input"},it={class:"auth-flex-container"},nt={key:0,class:"title main-title has-text-centered"},ot=u.createBaseVNode("div",{style:{height:"20px"}},null,-1),at={key:3,class:"notification is-danger has-text-centered","data-test":"invalid-app-id"},rt={class:"spacer"},lt={key:4,class:"link has-text-centered"},st={key:0},ct=["onClick"],ut={key:1},dt=["onClick"],pt=u.defineComponent({props:{register:{type:Boolean}},setup(e){const t=e,{t:i}=u.useLocale(),n=u.ref(!t.register),{appInfo:o,loading:a,webauthnAllowed:r,invalidAppId:l}=u.useAppInfo(),s=u.ref(""),{defaultCountryCode:c}=u.useDefaultCountryCode(),d=c,p=u.computed((()=>{var e;return!!o.value&&(null==(e=o.value)?void 0:e.public_signup)}));function m(){n.value=!n.value}return(e,t)=>(u.openBlock(),u.createElementBlock("div",tt,[u.createBaseVNode("div",it,[u.unref(a)?u.createCommentVNode("",!0):(u.openBlock(),u.createElementBlock("div",nt,u.toDisplayString(n.value?u.unref(i)("login-title"):u.unref(i)("register-title")),1)),ot,u.unref(a)?u.createCommentVNode("",!0):u.withDirectives((u.openBlock(),u.createBlock(Ne,{key:1,identifier:s.value,"onUpdate:identifier":t[0]||(t[0]=e=>s.value=e),canToggleLoginRegister:!0,countryCode:u.unref(d),"onUpdate:countryCode":t[1]||(t[1]=e=>u.isRef(d)?d.value=e:null),appInfo:u.unref(o),webauthnAllowed:u.unref(r),visible:n.value},null,8,["identifier","countryCode","appInfo","webauthnAllowed","visible"])),[[u.vShow,n.value]]),u.unref(a)?u.createCommentVNode("",!0):u.withDirectives((u.openBlock(),u.createBlock(De,{key:2,identifier:s.value,"onUpdate:identifier":t[2]||(t[2]=e=>s.value=e),canToggleLoginRegister:!0,countryCode:u.unref(d),"onUpdate:countryCode":t[3]||(t[3]=e=>u.isRef(d)?d.value=e:null),appInfo:u.unref(o),webauthnAllowed:u.unref(r)},null,8,["identifier","countryCode","appInfo","webauthnAllowed"])),[[u.vShow,!n.value]]),u.unref(l)?(u.openBlock(),u.createElementBlock("div",at,u.toDisplayString(u.unref(i)("invalid-app-id")),1)):u.createCommentVNode("",!0),u.createBaseVNode("div",rt,[u.createVNode(ze)]),u.unref(a)?u.createCommentVNode("",!0):(u.openBlock(),u.createElementBlock("div",lt,[n.value&&u.unref(p)?(u.openBlock(),u.createElementBlock("div",st,[u.createTextVNode(u.toDisplayString(u.unref(i)("dont-have-an-account"))+" ",1),u.createBaseVNode("a",{onClick:u.withModifiers(m,["prevent"]),role:"button","data-test":"register-link"},u.toDisplayString(u.unref(i)("register-here")),9,ct)])):n.value?u.createCommentVNode("",!0):(u.openBlock(),u.createElementBlock("div",ut,[u.createTextVNode(u.toDisplayString(u.unref(i)("already-have-an-account"))+" ",1),u.createBaseVNode("a",{onClick:u.withModifiers(m,["prevent"]),role:"button","data-test":"login-link"},u.toDisplayString(u.unref(i)("login-here")),9,dt)]))])),u.unref(a)?u.createCommentVNode("",!0):(u.openBlock(),u.createBlock(et,{key:5,appInfo:u.unref(o)},null,8,["appInfo"]))])]))}}),mt={class:"view-email-input"},ft={key:1,class:"notification is-danger has-text-centered","data-test":"invalid-app-id"},gt=u.defineComponent({setup(e){const{t:t}=u.useLocale(),i=u.ref(""),{defaultCountryCode:n}=u.useDefaultCountryCode(),o=n,{appInfo:a,loading:r,webauthnAllowed:l,invalidAppId:s}=u.useAppInfo();return(e,n)=>(u.openBlock(),u.createElementBlock("div",mt,[u.unref(r)?u.createCommentVNode("",!0):(u.openBlock(),u.createBlock(Ne,{key:0,identifier:i.value,"onUpdate:identifier":n[0]||(n[0]=e=>i.value=e),countryCode:u.unref(o),"onUpdate:countryCode":n[1]||(n[1]=e=>u.isRef(o)?o.value=e:null),canToggleLoginRegister:!1,appInfo:u.unref(a),webauthnAllowed:u.unref(l)},null,8,["identifier","countryCode","appInfo","webauthnAllowed"])),u.unref(s)?(u.openBlock(),u.createElementBlock("div",ft,u.toDisplayString(u.unref(t)("invalid-app-id")),1)):u.createCommentVNode("",!0),u.unref(r)?u.createCommentVNode("",!0):(u.openBlock(),u.createBlock(et,{key:2,appInfo:u.unref(a)},null,8,["appInfo"]))]))}}),vt={class:"view-email-input"},ht={key:1,class:"notification is-danger has-text-centered","data-test":"invalid-app-id"},kt=u.defineComponent({setup(e){const{t:t}=u.useLocale(),i=u.ref(""),{defaultCountryCode:n}=u.useDefaultCountryCode(),o=n,{appInfo:a,loading:r,webauthnAllowed:l,invalidAppId:s}=u.useAppInfo();return(e,n)=>(u.openBlock(),u.createElementBlock("div",vt,[u.unref(r)?u.createCommentVNode("",!0):(u.openBlock(),u.createBlock(De,{key:0,identifier:i.value,"onUpdate:identifier":n[0]||(n[0]=e=>i.value=e),countryCode:u.unref(o),"onUpdate:countryCode":n[1]||(n[1]=e=>u.isRef(o)?o.value=e:null),canToggleLoginRegister:!1,appInfo:u.unref(a),webauthnAllowed:u.unref(l)},null,8,["identifier","countryCode","appInfo","webauthnAllowed"])),u.unref(s)?(u.openBlock(),u.createElementBlock("div",ht,u.toDisplayString(u.unref(t)("invalid-app-id")),1)):u.createCommentVNode("",!0),u.unref(r)?u.createCommentVNode("",!0):(u.openBlock(),u.createBlock(et,{key:2,appInfo:u.unref(a)},null,8,["appInfo"]))]))}}),yt=u.defineComponent({name:"Spinner"}),Bt={class:"spinner-box"},wt={class:"spinner-content"};var bt=u._export_sfc(yt,[["render",function(e,t,i,n,o,a){return u.openBlock(),u.createElementBlock("div",Bt,[u.createBaseVNode("div",wt,[u.renderSlot(e.$slots,"default")])])}]]);const St={class:"auth-flex-container"},Ct={class:"title has-text-centered"},It={key:0,class:"content has-text-centered",style:{"margin-bottom":"15px !important"}},Vt=["innerHTML"],xt={class:"flex-row flex-center"},Et=["onClick","disabled"],Nt=u.createBaseVNode("div",{class:"spacer"},null,-1),_t={class:"link has-text-centered"},Mt=["onClick"],Dt=u.defineComponent({props:{identifier:null,userIsRegistering:{type:Boolean},identifierVerifying:{type:Boolean},setupNewDevice:{type:Boolean},identifierType:null},setup(e){const t=e,{t:i,locale:n}=u.useLocale(),{appId:o}=u.useAppId(),a=new u.Qe(o.value),{router:r}=N(),l=u.computed((()=>t.identifierType===ye.email)),s=u.computed((()=>t.identifierVerifying?l.value?t.userIsRegistering?i("verify-email-to-register"):i("verify-email-to-login"):t.userIsRegistering?i("verify-phone-to-register"):i("verify-phone-to-login"):l.value?t.userIsRegistering?i("check-email-to-register"):i("check-email-to-login"):t.userIsRegistering?i("check-phone-to-register"):i("check-phone-to-login"))),p=u.computed((()=>{let e="";const n=t.identifierType===ye.email?i("messagetype-email"):i("messagetype-sms"),o=t.identifierType===ye.email?i("email"):i("phone-number"),a=t.userIsRegistering?i("registration"):i("login"),r=t.identifierVerifying?i("please-verify-identifier",[o,a]):i("you-will-be-automatically-signed-in");return e=i("weve-sent-messagetype",[n,t.identifier,r]),t.setupNewDevice&&!t.userIsRegistering&&(e=i("we-dont-recognize-this-device")+" "+e),e}));function m(){localStorage.removeItem("email"),localStorage.removeItem("magic_link_id"),localStorage.removeItem("wait_count"),b(721),r.push(r.homeRoute)}function f(){return c(this,null,(function*(){yield h()}))}u.onMounted((()=>{t.userIsRegistering?function(){c(this,null,(function*(){g.value=!1,v.value=!0,yield new Promise((e=>{setTimeout(e,2e3)}));try{const e=yield a.newRegisterMagicLink(t.identifier,n.value.split("-")[0]);""!=e.id&&(localStorage.setItem("magic_link_id",e.id),b(0))}catch(e){console.log("magicLinkSend error",e)}finally{v.value=!1}}))}():h()}));const g=u.ref(!1),v=u.ref(!0);function h(){return c(this,null,(function*(){g.value=!1,v.value=!0;try{const e=yield a.newLoginMagicLink(t.identifier,n.value.split("-")[0]);""!=e.id&&(localStorage.setItem("magic_link_id",e.id),b(0))}catch(e){console.log("magicLinkSend error",e)}finally{yield new Promise((e=>{setTimeout(e,3e3)})),v.value=!1}}))}let k,y;function B(){return c(this,null,(function*(){const e=localStorage.getItem("magic_link_id");yield function(e){return c(this,null,(function*(){yield a.getMagicLinkStatus(e).then((e=>{b(721),k=e})).catch((()=>{}))}))}(e).then((()=>c(this,null,(function*(){k&&""!=k.redirect_url&&(localStorage.removeItem("magic_link_id"),localStorage.removeItem("wait_count"),yield G(),w().onEvent.value(d.onMagicLinkActivated),w().onSuccess.value(k))}))))}))}function b(e){let t=e;if(!(t<720))return clearTimeout(y),void(g.value=!1);g.value=!0,y=setTimeout((()=>c(this,null,(function*(){!function(e){B(),localStorage.setItem("wait_count",e.toString())}(t),t++,b(t)}))),5e3)}return(e,t)=>(u.openBlock(),u.createElementBlock("div",St,[u.createBaseVNode("div",Ct,[u.createBaseVNode("span",null,u.toDisplayString(u.unref(s)),1)]),u.createVNode(bt,null,{default:u.withCtx((()=>[u.unref(l)?(u.openBlock(),u.createBlock(u.unref(u.InlineSvg),{key:0,src:u.unref(u.Icons).email,alt:"Email envelope"},null,8,["src"])):(u.openBlock(),u.createBlock(u.unref(u.InlineSvg),{key:1,src:u.unref(u.Icons).phone,alt:"Message bubbles"},null,8,["src"]))])),_:1}),u.unref(p)?(u.openBlock(),u.createElementBlock("div",It,[u.createBaseVNode("span",{innerHTML:u.unref(p)},null,8,Vt)])):u.createCommentVNode("",!0),u.createBaseVNode("div",xt,[u.createBaseVNode("button",{onClick:u.withModifiers(f,["prevent"]),type:"button",class:"button is-primary",part:"button",disabled:v.value},u.toDisplayString(u.unref(i)("resend-isemail-email-message",[u.unref(l)?u.unref(i)("email"):u.unref(i)("message")])),9,Et)]),Nt,u.createBaseVNode("div",_t,[u.createBaseVNode("a",{onClick:u.withModifiers(m,["prevent"]),role:"button","data-test":"change-email-button"},u.toDisplayString(u.unref(i)("change-isemail-email-phone",[u.unref(l)?u.unref(i)("email"):u.unref(i)("phone")])),9,Mt)])]))}}),Lt=u.defineComponent({name:"MagicLinkView",props:{identifier:{type:String,required:!0},userIsRegistering:{type:Boolean,default:!1},identifierVerifying:{type:Boolean,default:!1},setupNewDevice:{type:Boolean,default:!1},identifierType:{type:String,required:!0}},components:{MagicLink:Dt}}),Rt={class:"view-access-token"};var At=u._export_sfc(Lt,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("magic-link");return u.openBlock(),u.createElementBlock("div",Rt,[u.createVNode(r,{identifier:e.identifier,userIsRegistering:e.userIsRegistering,identifierVerifying:e.identifierVerifying,setupNewDevice:e.setupNewDevice,identifierType:e.identifierType},null,8,["identifier","userIsRegistering","identifierVerifying","setupNewDevice","identifierType"])])}]]);const Tt=u.defineComponent({name:"RegisterDevice",components:{InlineSvg:u.InlineSvg,PlatformIcon:u._sfc_main},props:{identifier:{type:String,required:!0},identifierType:{type:String,required:!0}},setup(e){const{t:t}=u.useLocale(),{appId:i}=u.useAppId(),{router:n}=N(),{onSuccess:o}=w(),a=u.ref(!1),{autofocusButton:r}=_(),l=u.computed((()=>e.identifierType===ye.email)),s=u.computed((()=>a.value?t("register-with-link",[l.value?t("email"):t("sms-text")]):t("register-without-a-password")));return{appId:i,router:n,onSuccess:o,isEmail:l,showFailure:a,title:s,Icons:u.Icons,t:t,autofocusButton:r}},data:()=>({loading:!1,authResult:null,passage:null}),created:function(){this.passage=new u.Qe(this.appId)},methods:{signUpWebAuthn(e){return c(this,null,(function*(){this.loading=!0,this.showFailure=!1,this.authResult={auth_token:"",redirect_url:""};try{const t=yield this.passage.register(e);this.authResult=t,this.loading=!1,this.authResult.redirect_url&&(G(e),this.onSuccess(this.authResult))}catch(t){this.showFailure=!0,this.loading=!1}}))},registerWithEmail(){this.showFailure?this.router.push(C,{identifier:this.identifier,identifierType:this.identifierType,userIsRegistering:!1}):this.router.push(C,{identifier:this.identifier,identifierType:this.identifierType,userIsRegistering:!0})},changeEmail(){localStorage.removeItem("email"),this.router.push(this.router.homeRoute,{register:!0})},redirectNow(){this.authResult.redirect_url&&(G(this.identifier),this.onSuccess(this.authResult))},onButtonClick(){this.signUpWebAuthn(this.identifier)}}}),Ft={class:"auth-flex-container"},Wt={class:"title secondary-title has-text-centered"},Pt={class:"image has-text-centered"},Ut={class:"content wrap-text has-text-centered",style:{"margin-bottom":"10px !important"},"data-tag":"register-device-message"},qt={key:0,style:{"margin-bottom":"5px"}},$t={key:1},zt={key:2},Ot={style:{"margin-bottom":"10px"}},jt={key:0,class:"flex-row flex-center"},Ht=["disabled"],Gt=["disabled"],Qt={key:1,class:"flex-row flex-center"},Yt=["disabled"],Kt={key:2,class:"content has-text-centered",style:{"margin-top":"20px !important"}},Zt={class:"link"},Jt={key:3,class:"spacer"},Xt={key:4,class:"flex-row flex-wrap flex-between"},ei={class:"link"},ti={class:"link"};var ii=u._export_sfc(Tt,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("inline-svg"),l=u.resolveComponent("platform-icon");return u.openBlock(),u.createElementBlock("div",Ft,[u.createBaseVNode("div",Wt,u.toDisplayString(e.title),1),u.createBaseVNode("figure",Pt,[e.showFailure&&e.isEmail?(u.openBlock(),u.createBlock(r,{key:0,src:e.Icons.loginWithEmail,alt:"Biometrics scan failed",style:{margin:"5px"}},null,8,["src"])):e.showFailure&&!e.isEmail?(u.openBlock(),u.createBlock(r,{key:1,src:e.Icons.loginWithText,alt:"Biometrics scan failed",style:{margin:"5px"}},null,8,["src"])):(u.openBlock(),u.createBlock(l,{key:2}))]),u.createBaseVNode("div",Ut,[e.identifier?(u.openBlock(),u.createElementBlock("div",qt,[u.createBaseVNode("strong",null,u.toDisplayString(e.identifier),1)])):u.createCommentVNode("",!0),e.showFailure?(u.openBlock(),u.createElementBlock("div",$t,[u.createBaseVNode("p",null,u.toDisplayString(e.isEmail?e.t("registration-with-link-error-message-email"):e.t("registration-with-link-error-message-phone")),1)])):(u.openBlock(),u.createElementBlock("div",zt,[u.createBaseVNode("div",Ot,u.toDisplayString(e.t("register-your-account")),1),u.createBaseVNode("div",null,u.toDisplayString(e.t("does-not-give-app-personal-info")),1)]))]),e.showFailure?(u.openBlock(),u.createElementBlock("div",jt,[u.createBaseVNode("button",{onClick:t[0]||(t[0]=u.withModifiers(((...t)=>e.registerWithEmail&&e.registerWithEmail(...t)),["prevent"])),type:"button",part:"button",class:"button is-primary small",disabled:e.loading,style:{"margin-right":"5px"},"data-test":"login-with-email-button",ref:"autofocusButton"},u.toDisplayString(e.t("send-email-or-text-link",[e.isEmail?e.t("email"):e.t("sms-text")])),9,Ht),u.createBaseVNode("button",{onClick:t[1]||(t[1]=u.withModifiers(((...t)=>e.onButtonClick&&e.onButtonClick(...t)),["prevent"])),type:"button",part:"button",class:"button is-secondary small",disabled:e.loading,style:{"margin-left":"5px"}},u.toDisplayString(e.t("try-again")),9,Gt)])):(u.openBlock(),u.createElementBlock("div",Qt,[u.createBaseVNode("button",{onClick:t[2]||(t[2]=u.withModifiers(((...t)=>e.onButtonClick&&e.onButtonClick(...t)),["prevent"])),type:"button",class:u.normalizeClass(["button",[{"is-loading":e.loading}]]),part:"button",disabled:e.loading,"data-test":"register-main-button",tabindex:"0",ref:"autofocusButton"},[u.createBaseVNode("span",null,u.toDisplayString(e.t("register-with-device")),1)],10,Yt)])),e.showFailure?(u.openBlock(),u.createElementBlock("div",Kt,[u.createBaseVNode("div",Zt,[u.createBaseVNode("a",{onClick:t[3]||(t[3]=u.withModifiers(((...t)=>e.changeEmail&&e.changeEmail(...t)),["prevent"])),role:"button","data-test":"change-email-button"},u.toDisplayString(e.t("change-isemail-email-phone",[e.isEmail?e.t("email"):e.t("phone")])),1)])])):u.createCommentVNode("",!0),e.showFailure?u.createCommentVNode("",!0):(u.openBlock(),u.createElementBlock("div",Jt)),e.showFailure?u.createCommentVNode("",!0):(u.openBlock(),u.createElementBlock("div",Xt,[u.createBaseVNode("div",ei,[u.createBaseVNode("a",{onClick:t[4]||(t[4]=u.withModifiers(((...t)=>e.changeEmail&&e.changeEmail(...t)),["prevent"])),role:"button","data-test":"change-email-button"},u.toDisplayString(e.t("change-isemail-email-phone",[e.isEmail?e.t("email"):e.t("phone")])),1)]),u.createBaseVNode("div",ti,[u.createBaseVNode("a",{onClick:t[5]||(t[5]=u.withModifiers(((...t)=>e.registerWithEmail&&e.registerWithEmail(...t)),["prevent"])),role:"button","data-test":"register-email-button"},u.toDisplayString(e.t("register-with-link",[e.isEmail?e.t("email"):e.t("sms-text")])),1)])]))])}]]);const ni=u.defineComponent({name:"RegisterDeviceView",props:{identifier:{type:String,required:!0},identifierType:{type:String,required:!0}},components:{RegisterDevice:ii}});var oi=u._export_sfc(ni,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("register-device");return u.openBlock(),u.createBlock(r,{identifier:e.identifier,identifierType:e.identifierType},null,8,["identifier","identifierType"])}]]);const ai=u.defineComponent({name:"WebauthnSignIn",components:{InlineSvg:u.InlineSvg,PlatformIcon:u._sfc_main},props:{identifier:{type:String,required:!0},identifierType:{type:String,required:!0}},setup(e){const{t:t}=u.useLocale(),{appId:i}=u.useAppId(),{router:n}=N(),o=u.computed((()=>e.identifierType===ye.email)),{autofocusButton:a}=_();return{appId:i,router:n,isEmail:o,Icons:u.Icons,t:t,autofocusButton:a}},data:()=>({showFailure:!1,loading:!1,passage:null,authResult:null}),created:function(){this.passage=new u.Qe(this.appId)},mounted(){this.signInWebAuthn()},methods:{signInWebAuthn(){return c(this,null,(function*(){if(this.authResult={auth_token:"",redirect_url:""},this.showFailure=!1,this.identifier){this.loading=!0;try{const e=yield this.passage.login(this.identifier);this.authResult=e,this.authResult.redirect_url&&(G(this.identifier),w().onSuccess.value(this.authResult)),this.loading=!1}catch(e){const t=e;this.showFailure=!0,this.loading=!1,t.statusCode===u.M.PSGParsePublicKeyForLoginFailed?this.showFailure=!0:this.router.push(C,{identifier:this.identifier,identifierType:this.identifierType})}}}))},loginWithEmail(){this.router.push(C,{identifier:this.identifier,identifierType:this.identifierType})},changeEmail(){localStorage.removeItem("email"),this.router.push(this.router.homeRoute)}}}),ri={class:"auth-flex-container"},li={class:"title has-text-centered"},si={class:"image has-text-centered",style:{margin:"5px auto"}},ci={key:0,class:"content wrap-text has-text-centered",style:{"margin-bottom":"25px !important"}},ui={key:0,style:{"margin-bottom":"5px"}},di={key:1,class:"content wrap-text has-text-centered",style:{"margin-bottom":"5px !important"}},pi={key:0,style:{"margin-bottom":"5px"}},mi={"data-test":"failure-message"},fi={key:2,class:"flex-row flex-center"},gi=["disabled"],vi=["disabled"],hi={key:3,class:"content has-text-centered",style:{"margin-top":"20px !important"}},ki={class:"link"},yi={key:4,class:"spacer"},Bi={key:5,class:"flex-row flex-wrap flex-between"},wi={class:"link"},bi={class:"link"};var Si=u._export_sfc(ai,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("inline-svg"),l=u.resolveComponent("platform-icon");return u.openBlock(),u.createElementBlock("div",ri,[u.createBaseVNode("div",li,u.toDisplayString(e.showFailure?e.t("login-with-link",[e.isEmail?e.t("email"):e.t("sms-text")]):e.t("verify-your-identity")),1),u.createBaseVNode("figure",si,[e.showFailure&&e.isEmail?(u.openBlock(),u.createBlock(r,{key:0,src:e.Icons.loginWithEmail,alt:"Biometrics scan failed",style:{margin:"5px"}},null,8,["src"])):e.showFailure&&!e.isEmail?(u.openBlock(),u.createBlock(r,{key:1,src:e.Icons.loginWithText,alt:"Biometrics scan failed",style:{margin:"5px"}},null,8,["src"])):(u.openBlock(),u.createBlock(l,{key:2}))]),e.showFailure?e.showFailure?(u.openBlock(),u.createElementBlock("div",di,[e.identifier?(u.openBlock(),u.createElementBlock("div",pi,[u.createBaseVNode("strong",null,u.toDisplayString(e.identifier),1)])):u.createCommentVNode("",!0),u.createBaseVNode("div",mi,[u.createBaseVNode("p",null,u.toDisplayString(e.isEmail?e.t("login-with-link-error-message-email"):e.t("login-with-link-error-message-phone")),1)])])):u.createCommentVNode("",!0):(u.openBlock(),u.createElementBlock("div",ci,[e.identifier?(u.openBlock(),u.createElementBlock("div",ui,[u.createBaseVNode("strong",null,u.toDisplayString(e.identifier),1)])):u.createCommentVNode("",!0),u.createBaseVNode("div",null,u.toDisplayString(e.t("log-into-your-account")),1)])),e.showFailure?(u.openBlock(),u.createElementBlock("div",fi,[u.createBaseVNode("button",{onClick:t[0]||(t[0]=u.withModifiers(((...t)=>e.loginWithEmail&&e.loginWithEmail(...t)),["prevent"])),type:"button",part:"button",class:"button is-primary small",disabled:e.loading,style:{"margin-right":"5px"},"data-test":"login-with-email-button",ref:"autofocusButton"},u.toDisplayString(e.t("send-email-or-text-link",[e.isEmail?e.t("email"):e.t("sms-text")])),9,gi),u.createBaseVNode("button",{onClick:t[1]||(t[1]=u.withModifiers(((...t)=>e.signInWebAuthn&&e.signInWebAuthn(...t)),["prevent"])),type:"button",part:"button",class:"button is-secondary small",disabled:e.loading,style:{"margin-left":"5px"}},u.toDisplayString(e.t("try-again")),9,vi)])):u.createCommentVNode("",!0),e.showFailure?(u.openBlock(),u.createElementBlock("div",hi,[u.createBaseVNode("div",ki,[u.createBaseVNode("a",{onClick:t[2]||(t[2]=u.withModifiers(((...t)=>e.changeEmail&&e.changeEmail(...t)),["prevent"])),role:"button","data-test":"change-email-button"},u.toDisplayString(e.t("change-isemail-email-phone",[e.isEmail?e.t("email"):e.t("phone")])),1)])])):u.createCommentVNode("",!0),e.showFailure?u.createCommentVNode("",!0):(u.openBlock(),u.createElementBlock("div",yi)),e.showFailure?u.createCommentVNode("",!0):(u.openBlock(),u.createElementBlock("div",Bi,[u.createBaseVNode("div",wi,[u.createBaseVNode("a",{onClick:t[3]||(t[3]=u.withModifiers(((...t)=>e.changeEmail&&e.changeEmail(...t)),["prevent"])),role:"button","data-test":"change-email-button"},u.toDisplayString(e.t("change-isemail-email-phone",[e.isEmail?e.t("email"):e.t("phone")])),1)]),u.createBaseVNode("div",bi,[u.createBaseVNode("a",{onClick:t[4]||(t[4]=u.withModifiers(((...t)=>e.loginWithEmail&&e.loginWithEmail(...t)),["prevent"])),role:"button","data-test":"register-email-button"},u.toDisplayString(e.t("login-with-link",[e.isEmail?e.t("email"):e.t("sms-text")])),1)])]))])}]]);const Ci=u.defineComponent({name:"WebauthnSignInView",props:{identifier:{type:String,required:!0},identifierType:{type:String,required:!0}},components:{WebauthnSignIn:Si}}),Ii={class:"view-webauthn-sign-in"};var Vi=u._export_sfc(Ci,[["render",function(e,t,i,n,o,a){const r=u.resolveComponent("webauthn-sign-in");return u.openBlock(),u.createElementBlock("div",Ii,[u.createVNode(r,{identifier:e.identifier,identifierType:e.identifierType},null,8,["identifier","identifierType"])])}]]);const xi=u.defineComponent({name:"RouterView",components:{ActivateMagicLinkView:he,AuthView:pt,LoginView:gt,RegisterView:kt,MagicLinkView:At,RegisterDeviceView:oi,WebauthnSignInView:Vi},setup(){const{currentRoute:e}=N();return{currentComponent:u.computed((()=>e.value.component)),currentProps:u.computed((()=>{const t=e.value.props;return void 0===t?{}:t}))}}});var Ei=u._export_sfc(xi,[["render",function(e,t,i,n,o,a){return u.openBlock(),u.createBlock(u.resolveDynamicComponent(e.currentComponent),u.normalizeProps(u.guardReactiveProps(e.currentProps)),{default:u.withCtx((()=>[u.renderSlot(e.$slots,"default")])),_:3},16)}]]);exports.LoginRoute={component:"login-view"},exports.PassageRouterView=Ei,exports.RegisterRoute={component:"register-view"},exports.useCallbacks=w,exports.useRouter=N;
//# sourceMappingURL=RouterView.js.map
