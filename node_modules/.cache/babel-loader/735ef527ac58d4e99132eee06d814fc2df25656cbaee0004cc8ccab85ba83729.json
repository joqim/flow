{"ast":null,"code":"var __defProp = Object.defineProperty;\nvar __defProps = Object.defineProperties;\nvar __getOwnPropDescs = Object.getOwnPropertyDescriptors;\nvar __getOwnPropSymbols = Object.getOwnPropertySymbols;\nvar __hasOwnProp = Object.prototype.hasOwnProperty;\nvar __propIsEnum = Object.prototype.propertyIsEnumerable;\nvar __defNormalProp = (obj, key, value) => key in obj ? __defProp(obj, key, {\n  enumerable: true,\n  configurable: true,\n  writable: true,\n  value\n}) : obj[key] = value;\nvar __spreadValues = (a, b) => {\n  for (var prop in b || (b = {})) if (__hasOwnProp.call(b, prop)) __defNormalProp(a, prop, b[prop]);\n  if (__getOwnPropSymbols) for (var prop of __getOwnPropSymbols(b)) {\n    if (__propIsEnum.call(b, prop)) __defNormalProp(a, prop, b[prop]);\n  }\n  return a;\n};\nvar __spreadProps = (a, b) => __defProps(a, __getOwnPropDescs(b));\nvar __async = (__this, __arguments, generator) => {\n  return new Promise((resolve, reject) => {\n    var fulfilled = value => {\n      try {\n        step(generator.next(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var rejected = value => {\n      try {\n        step(generator.throw(value));\n      } catch (e) {\n        reject(e);\n      }\n    };\n    var step = x => x.done ? resolve(x.value) : Promise.resolve(x.value).then(fulfilled, rejected);\n    step((generator = generator.apply(__this, __arguments)).next());\n  });\n};\nimport { r as ref, n as readonly, p as reactive, q as computed, w as watch, d as defineComponent, I as InlineSvg, t as _sfc_main$k, x as useLocale, c as useAppId, y as useAddDevice, z as Icons, _ as _export_sfc, e as resolveComponent, f as createElementBlock, h as createBaseVNode, A as toDisplayString, B as normalizeClass, i as createBlock, C as withModifiers, D as createCommentVNode, F as Fragment, k as openBlock, Q as Qe, M, E as onMounted, g as withDirectives, v as vShow, G as normalizeStyle, H as createVNode, J as bt, K as isStringNullish, L as vt, S as St, N as intlTelInput, O as createTextVNode, P as vModelText, R as renderSlot, U as UserMetadata, T as LayoutType, V as transformMetadata, W as _, X as withCtx, Y as onBeforeMount, Z as computed$1, $ as unref, a0 as useAppInfo, a1 as isRef, j as useDefaultCountryCode, a2 as normalizeProps, a3 as guardReactiveProps, a4 as resolveDynamicComponent } from \"./customElements.es.js\";\nvar OnEventType = /* @__PURE__ */(OnEventType2 => {\n  OnEventType2[\"onLoaded\"] = \"onLoaded\";\n  OnEventType2[\"onRegisterDevice\"] = \"onRegisterDevice\";\n  OnEventType2[\"onVerifyIdentity\"] = \"onVerifyIdentity\";\n  OnEventType2[\"onMagicLinkLogin\"] = \"onMagicLinkLogin\";\n  OnEventType2[\"onMagicLinkRegister\"] = \"onMagicLinkRegister\";\n  OnEventType2[\"onMagicLinkActivated\"] = \"onMagicLinkActivated\";\n  OnEventType2[\"onMagicLinkActivateSuccess\"] = \"onMagicLinkActivateSuccess\";\n  return OnEventType2;\n})(OnEventType || {});\nconst defaultBeforeAuth = () => {\n  return true;\n};\nconst defaultOnSuccess = authResult2 => {\n  window.location.href = authResult2.redirect_url;\n};\nconst defaultOnEvent = () => {\n  return;\n};\nconst beforeAuth = ref(defaultBeforeAuth);\nconst onSuccess = ref(defaultOnSuccess);\nconst onEvent = ref(defaultOnEvent);\nfunction setBeforeAuth(newBeforeAuth) {\n  if (newBeforeAuth === void 0) {\n    beforeAuth.value = defaultBeforeAuth;\n    return;\n  }\n  beforeAuth.value = newBeforeAuth;\n}\nfunction setOnSuccess(newOnSuccess) {\n  if (newOnSuccess === void 0) {\n    onSuccess.value = defaultOnSuccess;\n    return;\n  }\n  onSuccess.value = newOnSuccess;\n}\nfunction setOnEvent(newOnEvent) {\n  if (newOnEvent === void 0) {\n    onEvent.value = defaultOnEvent;\n    return;\n  }\n  onEvent.value = newOnEvent;\n}\nfunction useCallbacks() {\n  return {\n    beforeAuth: readonly(beforeAuth),\n    onSuccess: readonly(onSuccess),\n    onEvent: readonly(onEvent),\n    setBeforeAuth,\n    setOnSuccess,\n    setOnEvent\n  };\n}\nconst AuthRoute = {\n  component: \"auth-view\"\n};\nconst LoginRoute = {\n  component: \"login-view\"\n};\nconst RegisterRoute = {\n  component: \"register-view\"\n};\nconst RegisterDeviceRoute = {\n  component: \"register-device-view\"\n};\nconst MagicLinkRoute = {\n  component: \"magic-link-view\"\n};\nconst WebauthnSignInRoute = {\n  component: \"webauthn-sign-in-view\"\n};\nconst ActivateMagicLinkRoute = {\n  component: \"activate-magic-link-view\"\n};\nclass Router {\n  constructor() {\n    this._history = [];\n    this._homeRoute = AuthRoute;\n    this._history.push(this._homeRoute);\n  }\n  get homeRoute() {\n    return this._homeRoute;\n  }\n  set homeRoute(homeRoute) {\n    this._homeRoute = homeRoute;\n    this._history[0] = homeRoute;\n  }\n  get currentRoute() {\n    return this._history[this._history.length - 1];\n  }\n  push(route, props) {\n    this._history.push(__spreadProps(__spreadValues({}, route), {\n      props\n    }));\n  }\n  resetRouter() {\n    this._history = [];\n    this._homeRoute = AuthRoute;\n    this._history.push(this._homeRoute);\n  }\n}\nconst router = reactive(new Router());\nconst currentRoute = computed(() => router.currentRoute);\nfunction useRouter() {\n  return {\n    router,\n    currentRoute\n  };\n}\nfunction useAutofocusButton() {\n  const autofocusButton = ref();\n  function autofocus() {\n    if (autofocusButton.value === void 0) {\n      return;\n    }\n    autofocusButton.value.focus();\n  }\n  watch(autofocusButton, () => {\n    autofocus();\n  });\n  return {\n    autofocusButton\n  };\n}\nconst _sfc_main$j = defineComponent({\n  name: \"AddDevice\",\n  components: {\n    InlineSvg,\n    PlatformIcon: _sfc_main$k\n  },\n  props: {\n    authResult: {\n      type: Object,\n      required: false\n    }\n  },\n  setup(props) {\n    const {\n      t\n    } = useLocale();\n    const {\n      appId\n    } = useAppId();\n    const showFailure = ref(false);\n    const showSuccess = ref(false);\n    const newDevice = ref();\n    const {\n      addDevice,\n      addPending,\n      errorMessage\n    } = useAddDevice(appId.value);\n    const {\n      autofocusButton\n    } = useAutofocusButton();\n    const title = computed(() => {\n      if (showFailure.value) {\n        return t(\"something-went-wrong\");\n      } else {\n        return t(\"success\");\n      }\n    });\n    function onButtonClick() {\n      return __async(this, null, function* () {\n        var _a, _b;\n        newDevice.value = yield addDevice();\n        if ((_a = newDevice.value) == null ? void 0 : _a.id) {\n          showSuccess.value = true;\n          showFailure.value = false;\n          if ((_b = props.authResult) == null ? void 0 : _b.redirect_url) {\n            useCallbacks().onSuccess.value(props.authResult);\n          }\n        } else {\n          showFailure.value = true;\n          showSuccess.value = false;\n        }\n      });\n    }\n    const onSkipButtonClick = () => {\n      var _a;\n      if ((_a = props.authResult) == null ? void 0 : _a.redirect_url) {\n        useCallbacks().onSuccess.value(props.authResult);\n      }\n    };\n    return {\n      showSuccess,\n      showFailure,\n      title,\n      addPending,\n      errorMessage,\n      newDevice,\n      onButtonClick,\n      onSkipButtonClick,\n      Icons,\n      t,\n      autofocusButton\n    };\n  }\n});\nconst _hoisted_1$g = {\n  class: \"image has-text-centered\"\n};\nconst _hoisted_2$c = {\n  class: \"content has-text-centered\",\n  \"data-test\": \"activate-magic-link-message\"\n};\nconst _hoisted_3$8 = {\n  key: 0\n};\nconst _hoisted_4$8 = {\n  key: 1\n};\nconst _hoisted_5$8 = {\n  style: {\n    \"margin-bottom\": \"10px\"\n  }\n};\nconst _hoisted_6$7 = {\n  style: {\n    \"margin-bottom\": \"10px\"\n  }\n};\nconst _hoisted_7$6 = {\n  style: {\n    \"margin-bottom\": \"10px\"\n  }\n};\nconst _hoisted_8$6 = {\n  class: \"flex-row flex-center\",\n  style: {\n    \"padding\": \"20px 0px\"\n  }\n};\nconst _hoisted_9$5 = [\"disabled\"];\nconst _hoisted_10$4 = {\n  key: 0\n};\nconst _hoisted_11$4 = {\n  key: 1\n};\nconst _hoisted_12$3 = {\n  key: 0,\n  class: \"link has-text-centered\"\n};\nfunction _sfc_render$e(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_inline_svg = resolveComponent(\"inline-svg\");\n  const _component_platform_icon = resolveComponent(\"platform-icon\");\n  return openBlock(), createElementBlock(Fragment, null, [createBaseVNode(\"div\", {\n    class: normalizeClass([\"title has-text-centered\", [_ctx.showFailure ? \"secondary-title\" : \"main-title\"]])\n  }, toDisplayString(_ctx.title), 3), createBaseVNode(\"figure\", _hoisted_1$g, [_ctx.showFailure ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 0,\n    src: _ctx.Icons.fingerprintFailed,\n    alt: \"Device failure\"\n  }, null, 8, [\"src\"])) : (openBlock(), createBlock(_component_platform_icon, {\n    key: 1\n  }))]), createBaseVNode(\"div\", _hoisted_2$c, [_ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_3$8, toDisplayString(_ctx.t(\"failed-to-add-this-device\")), 1)) : (openBlock(), createElementBlock(\"div\", _hoisted_4$8, [createBaseVNode(\"div\", _hoisted_5$8, [createBaseVNode(\"strong\", null, toDisplayString(_ctx.t(\"save-device\")), 1)]), createBaseVNode(\"div\", _hoisted_6$7, toDisplayString(_ctx.t(\"trust-device\")), 1), createBaseVNode(\"div\", _hoisted_7$6, toDisplayString(_ctx.t(\"does-not-give-app-personal-info\")), 1)]))]), createBaseVNode(\"div\", _hoisted_8$6, [createBaseVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = withModifiers(function () {\n      return _ctx.onButtonClick && _ctx.onButtonClick(...arguments);\n    }, [\"prevent\"])),\n    type: \"button\",\n    class: normalizeClass([\"button is-primary\", {\n      \"is-loading\": _ctx.addPending\n    }]),\n    part: \"button\",\n    disabled: _ctx.addPending,\n    \"data-test\": \"save-device-button\",\n    ref: \"autofocusButton\"\n  }, [_ctx.showFailure ? (openBlock(), createElementBlock(\"span\", _hoisted_10$4, toDisplayString(_ctx.t(\"try-again\")), 1)) : (openBlock(), createElementBlock(\"span\", _hoisted_11$4, toDisplayString(_ctx.t(\"continue\")), 1))], 10, _hoisted_9$5)]), !_ctx.showSuccess ? (openBlock(), createElementBlock(\"div\", _hoisted_12$3, [createBaseVNode(\"div\", null, [createBaseVNode(\"a\", {\n    onClick: _cache[1] || (_cache[1] = withModifiers(function () {\n      return _ctx.onSkipButtonClick && _ctx.onSkipButtonClick(...arguments);\n    }, [\"prevent\"])),\n    role: \"button\",\n    \"data-test\": \"add-device-skip\"\n  }, toDisplayString(_ctx.t(\"skip\")), 1)])])) : createCommentVNode(\"\", true)], 64);\n}\nvar AddDevice = /* @__PURE__ */_export_sfc(_sfc_main$j, [[\"render\", _sfc_render$e]]);\nfunction useUIState() {\n  const showFailure = ref(false);\n  const showSuccess = ref(false);\n  const loading = ref(false);\n  const pageLoading = ref(true);\n  const showAddDevice = ref(false);\n  const {\n    t\n  } = useLocale();\n  const title = computed(() => {\n    if (showSuccess.value) {\n      return t(\"success\");\n    }\n    if (showFailure.value) {\n      return t(\"something-went-wrong\");\n    }\n    return t(\"verify-your-identity\");\n  });\n  const uiSuccess = _ref => {\n    let {\n      addDevice = false\n    } = _ref;\n    showSuccess.value = true;\n    showFailure.value = false;\n    showAddDevice.value = addDevice;\n    loading.value = false;\n  };\n  const uiError = () => {\n    showSuccess.value = false;\n    showFailure.value = true;\n    showAddDevice.value = false;\n    loading.value = false;\n  };\n  const uiLoading = _ref2 => {\n    let {\n      addDevice = false\n    } = _ref2;\n    showSuccess.value = false;\n    showFailure.value = false;\n    showAddDevice.value = addDevice;\n    loading.value = true;\n  };\n  return {\n    showFailure,\n    showSuccess,\n    loading,\n    pageLoading,\n    showAddDevice,\n    title,\n    uiSuccess,\n    uiError,\n    uiLoading\n  };\n}\nfunction checkUserGestureRequired() {\n  return typeof window.webkitConvertPointFromNodeToPage === \"function\";\n}\nfunction useWebauthnUtils(passage) {\n  const deviceRecognized = ref(false);\n  const webauthnAllowed = ref(false);\n  const userGestureRequired = checkUserGestureRequired();\n  const verifyWebAuthnAllowed = () => __async(this, null, function* () {\n    const appInfo = yield passage.appInfo();\n    if (passage.checkWebauthnConfig(appInfo)) {\n      webauthnAllowed.value = yield passage.isWebauthnSupported(false);\n    } else {\n      webauthnAllowed.value = false;\n    }\n    return webauthnAllowed.value;\n  });\n  const isDeviceRecognized = magicLink => {\n    const userID = magicLink.split(\".\")[2];\n    deviceRecognized.value = webauthnAllowed.value && passage.credIDExists(userID) ? true : false;\n    return deviceRecognized.value;\n  };\n  const checkWebauthnAndDeviceRecognized = magicLink => __async(this, null, function* () {\n    yield verifyWebAuthnAllowed();\n    isDeviceRecognized(magicLink);\n  });\n  return {\n    deviceRecognized,\n    webauthnAllowed,\n    userGestureRequired,\n    checkWebauthnAndDeviceRecognized,\n    verifyWebAuthnAllowed,\n    isDeviceRecognized\n  };\n}\nvar MagicLinkActionEnum = /* @__PURE__ */(MagicLinkActionEnum2 => {\n  MagicLinkActionEnum2[\"LOGIN\"] = \"psg_magic_link\";\n  MagicLinkActionEnum2[\"VERIFY\"] = \"psg_verify_link\";\n  return MagicLinkActionEnum2;\n})(MagicLinkActionEnum || {});\nconst useMagicLinkUtils = magicLink => {\n  const magicLinkAction = ref();\n  const invalidMagicLink = ref(false);\n  const isMagicLinkValid = () => {\n    const searchParams = new URLSearchParams(window.location.href.split(\"?\")[1]);\n    if (searchParams.has(\"psg_magic_link\")) {\n      magicLinkAction.value = \"psg_magic_link\";\n    } else if (searchParams.has(\"psg_verify_link\")) {\n      magicLinkAction.value = \"psg_verify_link\";\n    }\n    if (!magicLinkAction.value || !magicLink) {\n      invalidMagicLink.value = true;\n    }\n    return !invalidMagicLink.value;\n  };\n  return {\n    magicLinkAction,\n    invalidMagicLink,\n    isMagicLinkValid\n  };\n};\nconst storageKey = \"psg_last_login\";\nfunction getLastLogin() {\n  return localStorage.getItem(storageKey);\n}\nfunction storeLastLogin(identiferOrUserInfo) {\n  return __async(this, null, function* () {\n    if (identiferOrUserInfo && typeof identiferOrUserInfo === \"string\") {\n      localStorage.setItem(storageKey, identiferOrUserInfo);\n      return;\n    }\n    let currentInfo = identiferOrUserInfo;\n    if (identiferOrUserInfo === void 0) {\n      const {\n        appId\n      } = useAppId();\n      const passage = new Qe(appId.value);\n      currentInfo = yield passage.getCurrentUser().userInfo();\n    }\n    if (currentInfo === void 0) {\n      return;\n    }\n    localStorage.setItem(storageKey, currentInfo.email ? currentInfo.email : currentInfo.phone);\n  });\n}\nconst useMagicLinkActivation = _ref3 => {\n  let {\n    magicLink,\n    uiState,\n    magicLinkUtils,\n    passage,\n    webauthnUtils\n  } = _ref3;\n  const authResult2 = ref(null);\n  const onBeforeActivate = () => {\n    uiState.uiLoading({\n      addDevice: false\n    });\n    authResult2.value = {\n      auth_token: \"\",\n      redirect_url: \"\"\n    };\n  };\n  const onActivateError = () => {\n    uiState.uiError();\n  };\n  const onActivateErrorInvalidMagicLink = () => {\n    magicLinkUtils.invalidMagicLink.value = true;\n    uiState.uiError();\n  };\n  const onActivateSuccess = _0 => __async(void 0, [_0], function (_ref4) {\n    let {\n      addDevice = false,\n      result\n    } = _ref4;\n    return function* () {\n      authResult2.value = result;\n      const userInfo = yield passage.getCurrentUser().userInfo();\n      storeLastLogin(userInfo);\n      uiState.uiSuccess({\n        addDevice\n      });\n      yield new Promise(resolve => {\n        setTimeout(resolve, 1e3);\n      });\n      if (authResult2.value.redirect_url && !uiState.showAddDevice.value) {\n        useCallbacks().onSuccess.value(authResult2.value);\n      }\n    }();\n  });\n  const activateWithoutBiometrics = () => __async(void 0, null, function* () {\n    onBeforeActivate();\n    try {\n      const result = yield passage.magicLinkActivate(magicLink);\n      onActivateSuccess({\n        addDevice: webauthnUtils.webauthnAllowed.value,\n        result\n      });\n    } catch (err) {\n      if (err.statusCode === M.NotFound) {\n        onActivateErrorInvalidMagicLink();\n      } else {\n        onActivateError();\n      }\n    }\n  });\n  const activateWithBiometrics = () => __async(void 0, null, function* () {\n    onBeforeActivate();\n    try {\n      const result = yield passage.magicLinkActivateWebAuthnLogin(magicLink);\n      onActivateSuccess({\n        addDevice: false,\n        result\n      });\n    } catch (err) {\n      const error = err;\n      if (error.statusCode === M.NotFound) {\n        onActivateErrorInvalidMagicLink();\n      } else if (error.statusCode === M.PSGCredObjectDoesNotExist || error.statusCode === M.Unauthorized) {\n        activateWithoutBiometrics();\n      } else {\n        onActivateError();\n      }\n    }\n  });\n  return {\n    authResult: authResult2,\n    onBeforeActivate,\n    onActivateError,\n    onActivateErrorInvalidMagicLink,\n    onActivateSuccess,\n    activateWithoutBiometrics,\n    activateWithBiometrics\n  };\n};\nconst _sfc_main$i = defineComponent({\n  name: \"ActivateMagicLink\",\n  props: {\n    magicLink: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    AddDevice,\n    InlineSvg,\n    PlatformIcon: _sfc_main$k\n  },\n  setup(props) {\n    const {\n      t\n    } = useLocale();\n    const {\n      appId\n    } = useAppId();\n    const passage = new Qe(appId.value);\n    const uiState = useUIState();\n    const webauthnUtils = useWebauthnUtils(passage);\n    const magicLinkUtils = useMagicLinkUtils(props.magicLink);\n    const activation = useMagicLinkActivation({\n      uiState,\n      webauthnUtils,\n      magicLinkUtils,\n      passage,\n      magicLink: props.magicLink\n    });\n    function onButtonClick() {\n      if (magicLinkUtils.invalidMagicLink.value) {\n        window.location.href = window.location.href.split(\"?\")[0];\n      } else {\n        if (webauthnUtils.deviceRecognized.value) {\n          activation.activateWithBiometrics();\n        } else {\n          activation.activateWithoutBiometrics();\n        }\n      }\n    }\n    function redirectNow() {\n      var _a;\n      if ((_a = activation.authResult.value) == null ? void 0 : _a.redirect_url) {\n        useCallbacks().onSuccess.value(activation.authResult.value);\n      }\n    }\n    onMounted(() => __async(this, null, function* () {\n      if (magicLinkUtils.isMagicLinkValid()) {\n        yield webauthnUtils.checkWebauthnAndDeviceRecognized(props.magicLink);\n        const shouldAutoActivate = !webauthnUtils.deviceRecognized.value || !webauthnUtils.webauthnAllowed.value || !webauthnUtils.userGestureRequired && webauthnUtils.deviceRecognized.value;\n        const shouldAutoActivateWithBio = !webauthnUtils.userGestureRequired && webauthnUtils.deviceRecognized.value;\n        if (shouldAutoActivate) {\n          shouldAutoActivateWithBio ? activation.activateWithBiometrics() : activation.activateWithoutBiometrics();\n        }\n        useCallbacks().onEvent.value(OnEventType.onMagicLinkActivateSuccess);\n      } else {\n        uiState.uiError();\n      }\n      uiState.pageLoading.value = false;\n    }));\n    return __spreadProps(__spreadValues(__spreadValues(__spreadValues({}, uiState), webauthnUtils), magicLinkUtils), {\n      activation,\n      MagicLinkActionEnum,\n      onButtonClick,\n      redirectNow,\n      Icons,\n      t\n    });\n  }\n});\nconst _hoisted_1$f = {\n  class: \"auth-flex-container\"\n};\nconst _hoisted_2$b = {\n  class: \"image has-text-centered\"\n};\nconst _hoisted_3$7 = {\n  class: \"content has-text-centered\",\n  \"data-test\": \"activate-magic-link-message\"\n};\nconst _hoisted_4$7 = {\n  key: 0\n};\nconst _hoisted_5$7 = {\n  key: 1\n};\nconst _hoisted_6$6 = {\n  key: 2\n};\nconst _hoisted_7$5 = {\n  key: 3\n};\nconst _hoisted_8$5 = {\n  key: 4\n};\nconst _hoisted_9$4 = {\n  key: 5\n};\nconst _hoisted_10$3 = {\n  key: 6\n};\nconst _hoisted_11$3 = {\n  key: 7\n};\nconst _hoisted_12$2 = {\n  key: 8\n};\nconst _hoisted_13$2 = {\n  key: 0,\n  class: \"flex-row flex-center\",\n  style: {\n    \"padding\": \"20px 0px\"\n  }\n};\nconst _hoisted_14$2 = [\"disabled\"];\nconst _hoisted_15$2 = {\n  key: 0\n};\nconst _hoisted_16$2 = {\n  key: 1\n};\nconst _hoisted_17$2 = {\n  key: 2\n};\nconst _hoisted_18$1 = {\n  key: 3\n};\nfunction _sfc_render$d(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_inline_svg = resolveComponent(\"inline-svg\");\n  const _component_platform_icon = resolveComponent(\"platform-icon\");\n  const _component_AddDevice = resolveComponent(\"AddDevice\");\n  return openBlock(), createElementBlock(Fragment, null, [withDirectives(createBaseVNode(\"div\", _hoisted_1$f, [createBaseVNode(\"div\", {\n    class: normalizeClass([\"title has-text-centered\", [_ctx.showSuccess ? \"main-title\" : \"secondary-title\"]])\n  }, toDisplayString(_ctx.showFailure ? _ctx.invalidMagicLink ? _ctx.t(\"invalid-link\") : _ctx.t(\"device-login-failed-title\") : _ctx.title), 3), createBaseVNode(\"figure\", _hoisted_2$b, [_ctx.showSuccess && _ctx.webauthnAllowed ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 0,\n    src: _ctx.Icons.fingerprintSuccess,\n    alt: \"Device success\"\n  }, null, 8, [\"src\"])) : _ctx.showSuccess && !_ctx.webauthnAllowed ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 1,\n    src: _ctx.Icons.emailSuccess,\n    alt: \"Magic link success\"\n  }, null, 8, [\"src\"])) : _ctx.showFailure && _ctx.magicLinkAction === _ctx.MagicLinkActionEnum.VERIFY ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 2,\n    src: _ctx.Icons.emailFailed,\n    alt: \"Magic link failure\"\n  }, null, 8, [\"src\"])) : _ctx.showFailure && _ctx.invalidMagicLink ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 3,\n    src: _ctx.Icons.emailFailed,\n    alt: \"Magic link failure\"\n  }, null, 8, [\"src\"])) : _ctx.showFailure && _ctx.webauthnAllowed ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 4,\n    src: _ctx.Icons.fingerprintFailed,\n    alt: \"Device failure\"\n  }, null, 8, [\"src\"])) : _ctx.webauthnAllowed ? (openBlock(), createBlock(_component_platform_icon, {\n    key: 5\n  })) : createCommentVNode(\"\", true)]), createBaseVNode(\"div\", _hoisted_3$7, [_ctx.showSuccess && _ctx.magicLinkAction === _ctx.MagicLinkActionEnum.LOGIN ? (openBlock(), createElementBlock(\"div\", _hoisted_4$7, toDisplayString(_ctx.t(\"successfully-logged-in-redirect\")), 1)) : _ctx.showSuccess && _ctx.magicLinkAction === _ctx.MagicLinkActionEnum.VERIFY ? (openBlock(), createElementBlock(\"div\", _hoisted_5$7, toDisplayString(_ctx.t(\"successfully-changed-email\")), 1)) : _ctx.showFailure && _ctx.invalidMagicLink && _ctx.magicLinkAction === _ctx.MagicLinkActionEnum.VERIFY ? (openBlock(), createElementBlock(\"div\", _hoisted_6$6, toDisplayString(_ctx.t(\"link-invalid\")), 1)) : _ctx.showFailure && _ctx.invalidMagicLink ? (openBlock(), createElementBlock(\"div\", _hoisted_7$5, toDisplayString(_ctx.t(\"login-link-invalid\")), 1)) : _ctx.showFailure && _ctx.magicLinkAction === _ctx.MagicLinkActionEnum.VERIFY ? (openBlock(), createElementBlock(\"div\", _hoisted_8$5, toDisplayString(_ctx.t(\"verification-failed-please-try-again\")), 1)) : _ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_9$4, toDisplayString(_ctx.t(\"device-login-failed\")), 1)) : _ctx.webauthnAllowed && _ctx.magicLinkAction === _ctx.MagicLinkActionEnum.LOGIN ? (openBlock(), createElementBlock(\"div\", _hoisted_10$3, toDisplayString(_ctx.t(\"log-in-to-proceed\")), 1)) : _ctx.webauthnAllowed && _ctx.magicLinkAction === _ctx.MagicLinkActionEnum.VERIFY ? (openBlock(), createElementBlock(\"div\", _hoisted_11$3, toDisplayString(_ctx.t(\"verify-your-identity-with-device\")), 1)) : _ctx.webauthnAllowed ? (openBlock(), createElementBlock(\"div\", _hoisted_12$2, toDisplayString(_ctx.t(\"log-into-your-account-extended\")), 1)) : createCommentVNode(\"\", true)]), _ctx.userGestureRequired || _ctx.showFailure || _ctx.showSuccess ? (openBlock(), createElementBlock(\"div\", _hoisted_13$2, [createBaseVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = withModifiers(function () {\n      return _ctx.onButtonClick && _ctx.onButtonClick(...arguments);\n    }, [\"prevent\"])),\n    type: \"button\",\n    class: normalizeClass([\"button is-primary\", {\n      \"is-loading\": _ctx.loading,\n      \"small\": _ctx.showFailure && _ctx.invalidMagicLink\n    }]),\n    part: \"button\",\n    disabled: _ctx.loading,\n    \"data-test\": \"activate-magic-link-button\"\n  }, [_ctx.showFailure && _ctx.invalidMagicLink ? (openBlock(), createElementBlock(\"span\", _hoisted_15$2, toDisplayString(_ctx.t(\"request-new-link\")), 1)) : _ctx.showFailure ? (openBlock(), createElementBlock(\"span\", _hoisted_16$2, toDisplayString(_ctx.t(\"try-again\")), 1)) : _ctx.showSuccess ? (openBlock(), createElementBlock(\"span\", _hoisted_17$2, toDisplayString(_ctx.t(\"redirect-now\")), 1)) : (openBlock(), createElementBlock(\"span\", _hoisted_18$1, toDisplayString(_ctx.t(\"login-with-device\")), 1))], 10, _hoisted_14$2)])) : createCommentVNode(\"\", true)], 512), [[vShow, !_ctx.pageLoading && !_ctx.showAddDevice]]), !_ctx.pageLoading && _ctx.showAddDevice ? (openBlock(), createElementBlock(\"div\", {\n    key: 0,\n    class: \"auth-flex-container\",\n    style: normalizeStyle(_ctx.showFailure ? \"justify-content: space-between\" : \"\")\n  }, [createVNode(_component_AddDevice, {\n    \"auth-result\": _ctx.activation.authResult.value\n  }, null, 8, [\"auth-result\"])], 4)) : createCommentVNode(\"\", true)], 64);\n}\nvar ActivateMagicLink = /* @__PURE__ */_export_sfc(_sfc_main$i, [[\"render\", _sfc_render$d]]);\nconst _sfc_main$h = defineComponent({\n  name: \"ActivateMagicLinkView\",\n  props: {\n    magicLink: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    ActivateMagicLink\n  }\n});\nconst _hoisted_1$e = {\n  class: \"view-verify-token\"\n};\nfunction _sfc_render$c(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_activate_magic_link = resolveComponent(\"activate-magic-link\");\n  return openBlock(), createElementBlock(\"div\", _hoisted_1$e, [createVNode(_component_activate_magic_link, {\n    magicLink: _ctx.magicLink\n  }, null, 8, [\"magicLink\"])]);\n}\nvar ActivateMagicLinkView = /* @__PURE__ */_export_sfc(_sfc_main$h, [[\"render\", _sfc_render$c]]);\nfunction useMagicLink() {\n  const {\n    router: router2\n  } = useRouter();\n  onMounted(() => {\n    const queryString = window.location.search;\n    const urlParams = new URLSearchParams(queryString);\n    let magicLink = null;\n    if (urlParams.has(\"psg_magic_link\")) {\n      magicLink = urlParams.get(\"psg_magic_link\");\n    } else if (urlParams.has(\"psg_verify_link\")) {\n      magicLink = urlParams.get(\"psg_verify_link\");\n    }\n    if (magicLink !== null) {\n      router2.push(ActivateMagicLinkRoute, {\n        magicLink\n      });\n    }\n  });\n}\nvar IdentifierType = /* @__PURE__ */(IdentifierType2 => {\n  IdentifierType2[\"phone\"] = \"PHONE\";\n  IdentifierType2[\"email\"] = \"EMAIL\";\n  return IdentifierType2;\n})(IdentifierType || {});\nconst _sfc_main$g = defineComponent({\n  name: \"ValidatedIdentiferForm\",\n  emits: [\"onSubmit\", \"update:validationError\", \"update:identifier\", \"update:countryCode\", \"update:showWelcomeBack\"],\n  props: {\n    appId: {\n      type: String,\n      required: true\n    },\n    validationError: {\n      type: String,\n      default: \"\"\n    },\n    identifier: {\n      type: String,\n      required: true\n    },\n    countryCode: {\n      type: String,\n      required: true\n    },\n    identifierMode: {\n      type: String,\n      required: true\n    },\n    showWelcomeBack: {\n      type: Boolean,\n      default: false\n    }\n  },\n  setup(props, context) {\n    const {\n      t\n    } = useLocale();\n    const identifierParseError = ref(\"\");\n    const identifierInput = ref();\n    const controlContainer = ref();\n    const {\n      autofocusButton\n    } = useAutofocusButton();\n    const showWelcomeUI = computed(() => {\n      return props.showWelcomeBack;\n    });\n    const label = computed(() => {\n      let identifierType;\n      switch (props.identifierMode) {\n        case bt.phone:\n          identifierType = t(\"phone-number\");\n          break;\n        case bt.email:\n          identifierType = t(\"email-address\");\n          break;\n        case bt.both:\n          identifierType = t(\"email-or-phone-number\");\n          break;\n      }\n      return identifierType.charAt(0).toUpperCase() + identifierType.slice(1);\n    });\n    const placeholder = computed(() => {\n      return \"example@email.com\";\n    });\n    const inputMode = computed(() => {\n      if (props.identifierMode === bt.phone) {\n        return \"tel\";\n      }\n      return \"email\";\n    });\n    const identifierText = computed({\n      get() {\n        return props.identifier;\n      },\n      set(newIdentifier) {\n        context.emit(\"update:identifier\", newIdentifier);\n      }\n    });\n    function formattedIdentifier() {\n      var _a;\n      if (!identifierText.value) {\n        return \"\";\n      }\n      let identifier = identifierText.value;\n      if (!showWelcomeUI.value) {\n        identifier = isPhoneNumber() ? (_a = phoneInput == null ? void 0 : phoneInput.getNumber()) != null ? _a : \"\" : identifierText.value;\n      }\n      return identifier.trim().toLowerCase();\n    }\n    const error = computed(() => {\n      if (!isStringNullish(props.validationError)) {\n        return props.validationError;\n      }\n      if (!isStringNullish(identifierParseError.value)) {\n        return identifierParseError.value;\n      }\n      return \"\";\n    });\n    function clearErrors() {\n      identifierParseError.value = \"\";\n      context.emit(\"update:validationError\", \"\");\n    }\n    function checkIdentifier() {\n      return __async(this, null, function* () {\n        if (!validateInput()) {\n          return;\n        }\n        const passage = new Qe(props.appId);\n        let identifierExists,\n          userHasWebauthn,\n          userHasPasskey,\n          emailVerified,\n          phoneVerified = false;\n        let userStatus;\n        let userID = \"\";\n        try {\n          const userInfo = yield passage.identifierExists(formattedIdentifier());\n          if (userInfo !== null) {\n            identifierExists = true;\n            userHasWebauthn = userInfo.webauthn;\n            userStatus = userInfo.status;\n            userID = userInfo.id;\n            emailVerified = userInfo.email_verified;\n            phoneVerified = userInfo.phone_verified;\n            userHasPasskey = userInfo.webauthn_types.includes(vt.Passkey);\n          } else {\n            identifierExists = false;\n            userHasWebauthn = false;\n            userStatus = St.INACTIVE;\n          }\n        } catch (e) {\n          let errorMessage;\n          switch (props.identifierMode) {\n            case bt.email:\n              errorMessage = t(\"enter-a-valid-email-address\");\n              break;\n            case bt.phone:\n              errorMessage = t(\"enter-a-valid-phone-number\");\n              break;\n            case bt.both:\n              errorMessage = t(\"enter-a-valid-email-or-phone-number\");\n              break;\n          }\n          identifierParseError.value = errorMessage;\n          return;\n        }\n        context.emit(\"onSubmit\", {\n          identifier: formattedIdentifier(),\n          identifierExists,\n          identifierType: isPhoneNumber() ? IdentifierType.phone : IdentifierType.email,\n          userHasWebauthn,\n          userStatus,\n          userID,\n          emailVerified,\n          phoneVerified,\n          userHasPasskey\n        });\n      });\n    }\n    function isEmail() {\n      const emailRegEx = /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/;\n      return emailRegEx.test(formattedIdentifier());\n    }\n    function isPhoneNumber() {\n      if (showWelcomeUI.value) {\n        return isPhoneNumberRegex();\n      }\n      if (phoneInput === void 0) {\n        return false;\n      }\n      return phoneInput.isValidNumber();\n    }\n    function validateInput() {\n      if (formattedIdentifier() === \"\") {\n        let message = \"\";\n        switch (props.identifierMode) {\n          case bt.phone:\n            message = t(\"enter-a-phone-number\");\n            break;\n          case bt.email:\n            message = t(\"enter-an-email-address\");\n            break;\n          case bt.both:\n            message = t(\"enter-an-email-or-phone-number\");\n            break;\n        }\n        identifierParseError.value = message;\n        return false;\n      } else if (props.identifierMode === bt.email && !isEmail()) {\n        identifierParseError.value = t(\"enter-a-valid-email-address\");\n        return false;\n      } else if (props.identifierMode === bt.phone && !isPhoneNumber()) {\n        identifierParseError.value = t(\"enter-a-valid-phone-number\");\n        return false;\n      } else if (props.identifierMode === bt.both && !isPhoneNumber() && !isEmail()) {\n        identifierParseError.value = t(\"enter-a-valid-email-or-phone-number\");\n        return false;\n      }\n      return true;\n    }\n    let phoneInput;\n    function showCountryCode() {\n      if (phoneInput !== void 0) {\n        return;\n      }\n      identifierInput.value.addEventListener(\"countrychange\", () => {\n        var _a;\n        context.emit(\"update:countryCode\", (_a = phoneInput == null ? void 0 : phoneInput.getSelectedCountryData().iso2) != null ? _a : \"\");\n      });\n      phoneInput = intlTelInput(identifierInput.value, {\n        initialCountry: props.countryCode,\n        utilsScript: \"https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js\",\n        dropdownContainer: controlContainer.value,\n        autoPlaceholder: \"aggressive\"\n      });\n      identifierInput.value.focus();\n    }\n    function hideCountryCode() {\n      if (phoneInput === void 0) {\n        return;\n      }\n      phoneInput.destroy();\n      phoneInput = void 0;\n      if (identifierInput.value) {\n        identifierInput.value.focus();\n      }\n    }\n    function moveInput() {\n      const parent = identifierInput.value.getRootNode().host;\n      parent.appendChild(identifierInput.value);\n    }\n    const labelRef = ref();\n    function moveBack() {\n      var _a;\n      (_a = labelRef.value) == null ? void 0 : _a.append(identifierInput.value);\n    }\n    onMounted(() => {\n      if (props.identifierMode === bt.phone) {\n        showCountryCode();\n      }\n    });\n    function isPhoneNumberRegex() {\n      const phoneNumberRegex = /^\\+$|^\\+?[0-9,(,),\\-, ]+$/;\n      return phoneNumberRegex.test(identifierText.value.trim());\n    }\n    if (props.identifierMode === bt.both) {\n      watch(identifierText, () => {\n        if (isPhoneNumberRegex()) {\n          showCountryCode();\n        } else {\n          hideCountryCode();\n        }\n      });\n    }\n    const countryCodeText = computed(() => {\n      return props.countryCode;\n    });\n    watch(countryCodeText, newValue => {\n      phoneInput == null ? void 0 : phoneInput.setCountry(newValue);\n    });\n    function switchAccount() {\n      context.emit(\"update:showWelcomeBack\", false);\n      identifierText.value = \"\";\n    }\n    return {\n      error,\n      identifierText,\n      checkIdentifier,\n      clearErrors,\n      identifierInput,\n      controlContainer,\n      placeholder,\n      label,\n      inputMode,\n      moveInput,\n      labelRef,\n      moveBack,\n      showWelcomeUI,\n      switchAccount,\n      t,\n      autofocusButton\n    };\n  }\n});\nconst _hoisted_1$d = {\n  class: \"has-text-centered\"\n};\nconst _hoisted_2$a = /* @__PURE__ */createBaseVNode(\"br\", null, null, -1);\nconst _hoisted_3$6 = [\"autocomplete\", \"inputmode\", \"placeholder\"];\nconst _hoisted_4$6 = {\n  ref: \"controlContainer\",\n  style: {\n    \"width\": \"100%\"\n  }\n};\nconst _hoisted_5$6 = {\n  class: \"flex-row flex-center\"\n};\nconst _hoisted_6$5 = {\n  key: 0,\n  style: {\n    \"margin-top\": \"30px\"\n  },\n  class: \"link has-text-centered\"\n};\nfunction _sfc_render$b(_ctx, _cache, $props, $setup, $data, $options) {\n  return openBlock(), createElementBlock(\"form\", {\n    onSubmit: _cache[3] || (_cache[3] = withModifiers(function () {\n      return _ctx.checkIdentifier && _ctx.checkIdentifier(...arguments);\n    }, [\"prevent\"]))\n  }, [withDirectives(createBaseVNode(\"div\", _hoisted_1$d, [createTextVNode(toDisplayString(_ctx.t(\"welcome-back-sign-in-as\")), 1), _hoisted_2$a, createBaseVNode(\"strong\", null, toDisplayString(_ctx.identifierText), 1)], 512), [[vShow, _ctx.showWelcomeBack]]), withDirectives(createBaseVNode(\"div\", null, [createBaseVNode(\"div\", {\n    class: \"label\",\n    ref: \"labelRef\"\n  }, toDisplayString(_ctx.label), 513), withDirectives(createBaseVNode(\"input\", {\n    \"onUpdate:modelValue\": _cache[0] || (_cache[0] = $event => _ctx.identifierText = $event),\n    type: \"text\",\n    class: normalizeClass([\"input\", {\n      \"is-danger\": _ctx.error\n    }]),\n    part: \"input\",\n    autocomplete: _ctx.inputMode,\n    inputmode: _ctx.inputMode,\n    id: \"identifier\",\n    placeholder: _ctx.placeholder,\n    onInput: _cache[1] || (_cache[1] = withModifiers(function () {\n      return _ctx.clearErrors && _ctx.clearErrors(...arguments);\n    }, [\"prevent\"])),\n    ref: \"identifierInput\",\n    \"data-test\": \"identifier-input\"\n  }, null, 42, _hoisted_3$6), [[vModelText, _ctx.identifierText]])], 512), [[vShow, !_ctx.showWelcomeBack]]), createBaseVNode(\"div\", _hoisted_4$6, null, 512), createBaseVNode(\"div\", {\n    style: normalizeStyle(`text-align: ${_ctx.showWelcomeUI ? \"center\" : \"left\"};`),\n    class: \"help is-danger error-message\",\n    \"data-test\": \"validation-error\"\n  }, toDisplayString(_ctx.error), 5), renderSlot(_ctx.$slots, \"default\"), createBaseVNode(\"div\", _hoisted_5$6, [createBaseVNode(\"button\", {\n    type: \"submit\",\n    class: \"button is-primary\",\n    part: \"button\",\n    \"data-test\": \"continue-button\",\n    ref: \"autofocusButton\"\n  }, toDisplayString(_ctx.t(\"continue\")), 513)]), _ctx.showWelcomeUI ? (openBlock(), createElementBlock(\"div\", _hoisted_6$5, [createBaseVNode(\"a\", {\n    onClick: _cache[2] || (_cache[2] = withModifiers(function () {\n      return _ctx.switchAccount && _ctx.switchAccount(...arguments);\n    }, [\"prevent\"])),\n    role: \"button\",\n    \"data-test\": \"register-link\"\n  }, toDisplayString(_ctx.t(\"switch-account\")), 1)])) : createCommentVNode(\"\", true)], 32);\n}\nvar ValidatedIdentifierForm = /* @__PURE__ */_export_sfc(_sfc_main$g, [[\"render\", _sfc_render$b]]);\nconst _sfc_main$f = defineComponent({\n  name: \"Login\",\n  components: {\n    ValidatedIdentifierForm\n  },\n  props: {\n    canToggleLoginRegister: Boolean,\n    identifier: {\n      type: String,\n      required: true\n    },\n    countryCode: {\n      type: String,\n      required: true\n    },\n    appInfo: {\n      type: Object,\n      required: true\n    },\n    webauthnAllowed: {\n      type: Boolean,\n      required: true\n    },\n    visible: {\n      type: Boolean,\n      default: false\n    }\n  },\n  emits: [\"update:identifier\", \"update:countryCode\"],\n  setup(props, context) {\n    const {\n      router: router2\n    } = useRouter();\n    const {\n      appId\n    } = useAppId();\n    const {\n      t\n    } = useLocale();\n    const error = ref(\"\");\n    const identifierText = computed({\n      get() {\n        return props.identifier;\n      },\n      set(newIdentifier) {\n        context.emit(\"update:identifier\", newIdentifier);\n      }\n    });\n    const countryCodeText = computed({\n      get() {\n        return props.countryCode;\n      },\n      set(newCountryCode) {\n        context.emit(\"update:countryCode\", newCountryCode);\n      }\n    });\n    const passage = new Qe(appId.value);\n    const inputForm = ref();\n    watch(inputForm, () => __async(this, null, function* () {\n      useCallbacks().onEvent.value(OnEventType.onLoaded);\n    }));\n    const identifierMode = computed(() => {\n      var _a;\n      return (_a = props.appInfo.allowed_identifier) != null ? _a : bt.email;\n    });\n    useMagicLink();\n    function onSubmit(event) {\n      return __async(this, null, function* () {\n        const {\n          identifier,\n          identifierExists,\n          userHasWebauthn,\n          userHasPasskey,\n          userStatus,\n          userID,\n          identifierType,\n          emailVerified,\n          phoneVerified\n        } = event;\n        const beforeAuthResult = useCallbacks().beforeAuth.value(identifier);\n        if (!beforeAuthResult) {\n          return;\n        }\n        const errorString = checkIdentifierExistsAndStatus(identifierExists, identifierType, userStatus);\n        if (errorString !== \"\") {\n          error.value = errorString;\n          return;\n        }\n        if (userNeedsToVerify(emailVerified, phoneVerified, identifierType)) {\n          router2.push(MagicLinkRoute, {\n            identifier,\n            identifierType,\n            identifierVerifying: true\n          });\n        } else {\n          const browserInfo = yield passage.browserInfo();\n          const tryPasskey = userHasPasskey && window.PublicKeyCredential && browserInfo.getPassKeySupported;\n          if (tryPasskey) {\n            useCallbacks().onEvent.value(OnEventType.onVerifyIdentity);\n            router2.push(WebauthnSignInRoute, {\n              identifier,\n              identifierType\n            });\n            return;\n          }\n          if (props.webauthnAllowed) {\n            if (userHasWebauthn && passage.credIDExists(userID)) {\n              useCallbacks().onEvent.value(OnEventType.onVerifyIdentity);\n              router2.push(WebauthnSignInRoute, {\n                identifier,\n                identifierType\n              });\n            } else {\n              useCallbacks().onEvent.value(OnEventType.onMagicLinkLogin);\n              router2.push(MagicLinkRoute, {\n                identifier,\n                identifierType,\n                setupNewDevice: true\n              });\n            }\n          } else {\n            useCallbacks().onEvent.value(OnEventType.onMagicLinkLogin);\n            router2.push(MagicLinkRoute, {\n              identifier,\n              identifierType\n            });\n          }\n        }\n      });\n    }\n    function checkIdentifierExistsAndStatus(identifierExists, identifierType, userStatus) {\n      if (!identifierExists) {\n        let identiferString = identifierType === IdentifierType.email ? t(\"email\") : t(\"phone\");\n        identiferString = identiferString.charAt(0).toUpperCase() + identiferString.slice(1);\n        let message = t(\"not-recognized\", [identiferString]);\n        if (props.canToggleLoginRegister) {\n          message = message + \". \" + t(\"toggle-register\");\n        }\n        return message;\n      }\n      if (identifierExists && userStatus === St.INACTIVE) {\n        return t(\"account-no-longer-active\");\n      }\n      return \"\";\n    }\n    function userNeedsToVerify(emailVerified, phoneVerified, identifierType) {\n      if (props.appInfo.require_identifier_verification) {\n        if (identifierType === IdentifierType.email && !emailVerified || identifierType === IdentifierType.phone && !phoneVerified) {\n          return true;\n        }\n      }\n      return false;\n    }\n    const showWelcomeBack = ref(false);\n    onMounted(() => {\n      const lastLogin = getLastLogin();\n      if (lastLogin) {\n        identifierText.value = lastLogin;\n        showWelcomeBack.value = true;\n      }\n    });\n    watch(() => props.visible, () => {\n      if (showWelcomeBack.value === true) {\n        identifierText.value = \"\";\n      }\n      showWelcomeBack.value = false;\n    });\n    return {\n      appId,\n      error,\n      identifierText,\n      countryCodeText,\n      onSubmit,\n      identifierMode,\n      inputForm,\n      showWelcomeBack\n    };\n  }\n});\nfunction _sfc_render$a(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_validated_identifier_form = resolveComponent(\"validated-identifier-form\");\n  return openBlock(), createBlock(_component_validated_identifier_form, {\n    appId: _ctx.appId,\n    identifierMode: _ctx.identifierMode,\n    showWelcomeBack: _ctx.showWelcomeBack,\n    \"onUpdate:showWelcomeBack\": _cache[0] || (_cache[0] = $event => _ctx.showWelcomeBack = $event),\n    identifier: _ctx.identifierText,\n    \"onUpdate:identifier\": _cache[1] || (_cache[1] = $event => _ctx.identifierText = $event),\n    validationError: _ctx.error,\n    \"onUpdate:validationError\": _cache[2] || (_cache[2] = $event => _ctx.error = $event),\n    countryCode: _ctx.countryCodeText,\n    \"onUpdate:countryCode\": _cache[3] || (_cache[3] = $event => _ctx.countryCodeText = $event),\n    onOnSubmit: _cache[4] || (_cache[4] = $event => _ctx.onSubmit($event)),\n    ref: \"inputForm\"\n  }, null, 8, [\"appId\", \"identifierMode\", \"showWelcomeBack\", \"identifier\", \"validationError\", \"countryCode\"]);\n}\nvar Login = /* @__PURE__ */_export_sfc(_sfc_main$f, [[\"render\", _sfc_render$a]]);\nconst _sfc_main$e = defineComponent({\n  name: \"Register\",\n  props: {\n    canToggleLoginRegister: Boolean,\n    identifier: {\n      type: String,\n      required: true\n    },\n    countryCode: {\n      type: String,\n      required: true\n    },\n    appInfo: {\n      type: Object,\n      required: true\n    },\n    webauthnAllowed: {\n      type: Boolean,\n      required: true\n    }\n  },\n  emits: [\"update:identifier\", \"update:countryCode\"],\n  components: {\n    ValidatedIdentifierForm,\n    UserMetadata\n  },\n  setup(props, context) {\n    const {\n      t\n    } = useLocale();\n    const {\n      router: router2\n    } = useRouter();\n    const {\n      appId\n    } = useAppId();\n    const error = ref(\"\");\n    const identifierText = computed({\n      get() {\n        return props.identifier;\n      },\n      set(newIdentifier) {\n        context.emit(\"update:identifier\", newIdentifier);\n      }\n    });\n    const countryCodeText = computed({\n      get() {\n        return props.countryCode;\n      },\n      set(newCountryCode) {\n        context.emit(\"update:countryCode\", newCountryCode);\n      }\n    });\n    const publicSignup = computed(() => {\n      return props.appInfo.public_signup;\n    });\n    const identifierMode = computed(() => {\n      return props.appInfo.allowed_identifier;\n    });\n    useMagicLink();\n    function onSubmit(event) {\n      return __async(this, null, function* () {\n        const {\n          identifier,\n          identifierExists,\n          userStatus,\n          identifierType\n        } = event;\n        const beforeAuthResult = useCallbacks().beforeAuth.value(identifier);\n        if (!beforeAuthResult) {\n          return;\n        }\n        let validMetadata = true;\n        if (metadataComponent.value) {\n          validMetadata = metadataComponent.value.validate();\n        }\n        if (identifierExists) {\n          if (userStatus === St.ACTIVE) {\n            let message = t(\"account-already-exists\", [identifierType === IdentifierType.email ? t(\"email\") : t(\"phone-number\")]);\n            if (props.canToggleLoginRegister) {\n              message = message + t(\"toggle-login\");\n            }\n            error.value = message;\n            return;\n          } else if (userStatus === St.INACTIVE) {\n            error.value = t(\"account-no-longer-active\");\n            return;\n          }\n        }\n        const passage = new Qe(appId.value);\n        if (!validMetadata) {\n          return;\n        }\n        try {\n          yield passage.createUser({\n            identifier,\n            user_metadata: transformMetadata(metadata.value, props.appInfo.user_metadata_schema, true)\n          });\n        } catch (err) {\n          if (err instanceof _ && err.message.startsWith(\"Public signup\")) {\n            error.value = err.message;\n          } else {\n            error.value = t(\"unexpected-error\");\n          }\n          return;\n        }\n        if (props.appInfo.require_identifier_verification) {\n          router2.push(MagicLinkRoute, {\n            identifier,\n            identifierType,\n            userIsRegistering: true,\n            identifierVerifying: true\n          });\n        } else {\n          if (props.webauthnAllowed) {\n            useCallbacks().onEvent.value(OnEventType.onRegisterDevice, {\n              identifier\n            });\n            router2.push(RegisterDeviceRoute, {\n              identifier,\n              identifierType\n            });\n          } else {\n            useCallbacks().onEvent.value(OnEventType.onMagicLinkRegister, {\n              identifier\n            });\n            router2.push(MagicLinkRoute, {\n              identifier,\n              identifierType,\n              userIsRegistering: true\n            });\n          }\n        }\n      });\n    }\n    const metadata = ref({});\n    const metadataComponent = ref();\n    return {\n      appId,\n      error,\n      identifierText,\n      countryCodeText,\n      onSubmit,\n      identifierMode,\n      metadata,\n      metadataComponent,\n      LayoutType,\n      publicSignup,\n      t\n    };\n  }\n});\nconst _hoisted_1$c = {\n  key: 0,\n  class: \"notification is-danger has-text-centered\",\n  \"data-test\": \"invalid-app-id\"\n};\nfunction _sfc_render$9(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_user_metadata = resolveComponent(\"user-metadata\");\n  const _component_validated_identifier_form = resolveComponent(\"validated-identifier-form\");\n  return openBlock(), createElementBlock(\"div\", null, [createVNode(_component_validated_identifier_form, {\n    appId: _ctx.appId,\n    identifierMode: _ctx.identifierMode,\n    identifier: _ctx.identifierText,\n    \"onUpdate:identifier\": _cache[0] || (_cache[0] = $event => _ctx.identifierText = $event),\n    validationError: _ctx.error,\n    \"onUpdate:validationError\": _cache[1] || (_cache[1] = $event => _ctx.error = $event),\n    countryCode: _ctx.countryCodeText,\n    \"onUpdate:countryCode\": _cache[2] || (_cache[2] = $event => _ctx.countryCodeText = $event),\n    onOnSubmit: _cache[3] || (_cache[3] = $event => _ctx.onSubmit($event))\n  }, {\n    default: withCtx(() => [_ctx.appInfo && _ctx.appInfo.layouts.registration.length > 0 ? (openBlock(), createBlock(_component_user_metadata, {\n      key: 0,\n      isEditing: true,\n      appInfo: _ctx.appInfo,\n      layoutType: _ctx.LayoutType.Registration,\n      userMetadata: _ctx.metadata,\n      ref: \"metadataComponent\"\n    }, null, 8, [\"appInfo\", \"layoutType\", \"userMetadata\"])) : createCommentVNode(\"\", true)]),\n    _: 1\n  }, 8, [\"appId\", \"identifierMode\", \"identifier\", \"validationError\", \"countryCode\"]), !_ctx.publicSignup ? (openBlock(), createElementBlock(\"div\", _hoisted_1$c, toDisplayString(_ctx.t(\"public-registration-not-allowed\")), 1)) : createCommentVNode(\"\", true)]);\n}\nvar Register = /* @__PURE__ */_export_sfc(_sfc_main$e, [[\"render\", _sfc_render$9]]);\nconst ephemeralAppIdKey = \"psg_ephemeral_app_id\";\nconst ephemeralAppNameKey = \"psg_ephemeral_app_name\";\nclass EphemeralAppService {\n  newEphemeralApp() {\n    return __async(this, null, function* () {\n      const ephemeralAppUrl = \"https://api.passage.id/v1/apps/\";\n      const response = yield fetch(ephemeralAppUrl, {\n        method: \"POST\",\n        body: JSON.stringify({\n          auth_origin: window.location.origin,\n          name: \"Ephemeral Random \" + (Math.random() * 1e6).toString()\n        })\n      });\n      const responseBody = yield response.json();\n      if (response.status !== 200) {\n        throw responseBody.message;\n      }\n      localStorage.setItem(ephemeralAppIdKey, responseBody.app.id);\n      localStorage.setItem(ephemeralAppNameKey, responseBody.app.name);\n      return responseBody;\n    });\n  }\n}\nconst _sfc_main$d = defineComponent({\n  name: \"EphemeralAppInfo\",\n  setup() {\n    const consoleUrl = \"https://console.passage.id\";\n    const {\n      t\n    } = useLocale();\n    const error = ref(false);\n    const isEphemeral = ref(false);\n    const claimed = ref(false);\n    const ephemeralClaimUrl = ref(\"\");\n    const exampleTag = ref(\"\");\n    const passageWebSetup = () => __async(this, null, function* () {\n      const {\n        appIdUnassigned,\n        updateAppId\n      } = useAppId();\n      if (appIdUnassigned.value) {\n        isEphemeral.value = true;\n        const ephemeralAppId = localStorage.getItem(ephemeralAppIdKey);\n        const ephemeralAppName = localStorage.getItem(ephemeralAppNameKey);\n        if (ephemeralAppId) {\n          const nameParam = ephemeralAppName ? `?name=${encodeURIComponent(ephemeralAppName)}` : \"\";\n          ephemeralClaimUrl.value = `${consoleUrl}/claim/${ephemeralAppId}${nameParam}`;\n          updateAppId(ephemeralAppId);\n          logToConsole();\n        } else {\n          try {\n            const ephemeralService = new EphemeralAppService();\n            const res = yield ephemeralService.newEphemeralApp();\n            updateAppId(res.app.id);\n            const nameParam = res.app.name ? `?name=${encodeURIComponent(res.app.name)}` : \"\";\n            ephemeralClaimUrl.value = `${consoleUrl}/claim/${res.app.id}${nameParam}`;\n            logToConsole();\n          } catch (err) {\n            error.value = true;\n            updateAppId(\"\");\n          }\n        }\n      }\n    });\n    const checkIfClaimed = () => __async(this, null, function* () {\n      const {\n        appId\n      } = useAppId();\n      if (!isEphemeral.value) {\n        return;\n      }\n      const passage = new Qe(appId.value);\n      try {\n        const res = yield passage.appInfo();\n        if (!res.ephemeral) {\n          claimed.value = true;\n          exampleTag.value = `<passage-auth app-id=\"${appId.value}\"/>`;\n        }\n      } catch (e) {\n        error.value = true;\n      }\n    });\n    function logToConsole() {\n      const {\n        appId\n      } = useAppId();\n      console.info(`Passage Test App ID: ${appId.value}`);\n      console.info(`Claim your app: ${ephemeralClaimUrl.value}`);\n    }\n    onBeforeMount(() => __async(this, null, function* () {\n      yield passageWebSetup();\n      yield checkIfClaimed();\n    }));\n    return {\n      error,\n      isEphemeral,\n      claimed,\n      ephemeralClaimUrl,\n      exampleTag,\n      t\n    };\n  }\n});\nconst _hoisted_1$b = {\n  key: 0\n};\nconst _hoisted_2$9 = {\n  key: 0,\n  class: \"notification is-danger\"\n};\nconst _hoisted_3$5 = {\n  key: 1,\n  class: \"notification ephemeral-box\",\n  \"data-test\": \"ephemeral-app-message\"\n};\nconst _hoisted_4$5 = {\n  key: 0\n};\nconst _hoisted_5$5 = [\"href\"];\nconst _hoisted_6$4 = /* @__PURE__ */createTextVNode(\".\");\nconst _hoisted_7$4 = {\n  key: 1\n};\nconst _hoisted_8$4 = /* @__PURE__ */createBaseVNode(\"br\", null, null, -1);\nfunction _sfc_render$8(_ctx, _cache, $props, $setup, $data, $options) {\n  return _ctx.isEphemeral ? (openBlock(), createElementBlock(\"div\", _hoisted_1$b, [_ctx.error ? (openBlock(), createElementBlock(\"div\", _hoisted_2$9, toDisplayString(_ctx.t(\"unable-to-create-test-app\")), 1)) : (openBlock(), createElementBlock(\"div\", _hoisted_3$5, [!_ctx.claimed ? (openBlock(), createElementBlock(\"div\", _hoisted_4$5, [createTextVNode(toDisplayString(_ctx.t(\"currently-using-test-app\")) + \" \", 1), createBaseVNode(\"a\", {\n    href: _ctx.ephemeralClaimUrl,\n    target: \"_blank\"\n  }, toDisplayString(_ctx.t(\"click-here\")), 9, _hoisted_5$5), _hoisted_6$4])) : (openBlock(), createElementBlock(\"div\", _hoisted_7$4, [createTextVNode(toDisplayString(_ctx.t(\"add-your-claimed-app-like-this\")) + \" \", 1), _hoisted_8$4, createTextVNode(toDisplayString(_ctx.exampleTag), 1)]))]))])) : createCommentVNode(\"\", true);\n}\nvar EphemeralAppInfo = /* @__PURE__ */_export_sfc(_sfc_main$d, [[\"render\", _sfc_render$8]]);\nvar TooltipPosition = /* @__PURE__ */(TooltipPosition2 => {\n  TooltipPosition2[\"isTop\"] = \"is-top\";\n  TooltipPosition2[\"isBottom\"] = \"is-bottom\";\n  TooltipPosition2[\"isLeft\"] = \"is-left\";\n  TooltipPosition2[\"isRight\"] = \"is-right\";\n  return TooltipPosition2;\n})(TooltipPosition || {});\nconst _sfc_main$c = defineComponent({\n  name: \"Tooltip\",\n  components: {\n    InlineSvg\n  },\n  props: {\n    label: String,\n    active: {\n      type: Boolean,\n      default: true\n    },\n    sticky: {\n      type: Boolean,\n      default: false\n    },\n    position: {\n      type: String,\n      default: \"is-top\"\n    },\n    clickMode: {\n      type: Boolean,\n      default: false\n    },\n    title: {\n      type: String,\n      default: \"\"\n    }\n  },\n  setup(props) {\n    const parentItem = ref();\n    const tooltipBody = ref();\n    const width = ref(0);\n    const maxHeight = ref(\"\");\n    const absoluteHeight = ref(\"\");\n    const cssVisible = ref(props.sticky);\n    const domVisible = ref(props.sticky);\n    function calculateTooltipSize() {\n      const absoluteMaxWidth = 500;\n      if (parentItem.value === void 0 || parentItem.value === null) {\n        return;\n      }\n      const parentItemDiv = parentItem.value;\n      const viewport = parentItemDiv.getRootNode().getElementById(\"passage-auth-container\");\n      if (viewport === null) {\n        return;\n      }\n      const {\n        left: viewLeft,\n        right: viewRight\n      } = viewport.getBoundingClientRect();\n      const {\n        left: itemLeft,\n        right: itemRight,\n        top: itemTop\n      } = parentItemDiv.getBoundingClientRect();\n      const itemMidpoint = (itemRight - itemLeft) / 2 + itemLeft;\n      const spaceLeft = itemMidpoint - viewLeft - 20;\n      const spaceRight = viewRight - itemMidpoint - 20;\n      let viewportSafeWidth;\n      const viewportSafeHeight = itemTop - 20;\n      switch (props.position) {\n        case \"is-top\":\n        case \"is-bottom\":\n          viewportSafeWidth = viewRight - viewLeft - 20;\n          break;\n        case \"is-left\":\n          viewportSafeWidth = spaceLeft;\n          break;\n        case \"is-right\":\n          viewportSafeWidth = spaceRight;\n          break;\n      }\n      maxHeight.value = `max-height: ${viewportSafeHeight}px;`;\n      width.value = Math.min(viewportSafeWidth, absoluteMaxWidth);\n    }\n    function calculateScrollHeight() {\n      var _a;\n      const parentItemDiv = parentItem.value;\n      const {\n        top: itemTop\n      } = parentItemDiv.getBoundingClientRect();\n      const contentHeight = ((_a = tooltipBody.value) == null ? void 0 : _a.scrollHeight) || 0;\n      const viewportSafeHeight = itemTop - 20;\n      if (contentHeight > viewportSafeHeight) {\n        absoluteHeight.value = `height: ${viewportSafeHeight}px;`;\n      }\n    }\n    function show() {\n      if (props.sticky) {\n        return;\n      }\n      clearTimeout(hideTimeout);\n      clearTimeout(innerTimeout);\n      domVisible.value = true;\n      calculateTooltipSize();\n      setTimeout(() => {\n        cssVisible.value = true;\n        calculateScrollHeight();\n      }, 100);\n    }\n    let hideTimeout;\n    let innerTimeout;\n    function hide() {\n      if (props.sticky) {\n        return;\n      }\n      hideTimeout = setTimeout(() => {\n        cssVisible.value = false;\n        innerTimeout = setTimeout(() => {\n          domVisible.value = false;\n        }, 150);\n      }, 100);\n    }\n    function cancelHide() {\n      clearTimeout(hideTimeout);\n      clearTimeout(innerTimeout);\n    }\n    function handleClick() {\n      if (domVisible.value) {\n        hide();\n      } else {\n        show();\n      }\n    }\n    onMounted(() => {\n      calculateTooltipSize();\n    });\n    return {\n      parentItem,\n      width,\n      maxHeight,\n      absoluteHeight,\n      cssVisible,\n      domVisible,\n      show,\n      hide,\n      cancelHide,\n      handleClick,\n      Icons,\n      tooltipBody\n    };\n  }\n});\nconst _hoisted_1$a = {\n  key: 0,\n  class: \"tooltip-header\"\n};\nconst _hoisted_2$8 = {\n  class: \"tooltip-content\"\n};\nfunction _sfc_render$7(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_inline_svg = resolveComponent(\"inline-svg\");\n  return openBlock(), createElementBlock(\"div\", {\n    class: normalizeClass([\"passage-tooltip\", `${_ctx.position} ${_ctx.cssVisible ? \"show-tooltip\" : \"\"}`]),\n    ref: \"parentItem\"\n  }, [_ctx.active ? withDirectives((openBlock(), createElementBlock(\"div\", {\n    key: 0,\n    class: normalizeClass([\"passage-tooltip-body\", _ctx.position]),\n    style: normalizeStyle(`max-width: ${_ctx.width}px; ${_ctx.maxHeight} ${_ctx.absoluteHeight}`),\n    onMouseenter: _cache[0] || (_cache[0] = withModifiers($event => _ctx.clickMode ? () => {} : _ctx.cancelHide(), [\"stop\"])),\n    onMouseleave: _cache[1] || (_cache[1] = withModifiers($event => _ctx.clickMode ? () => {} : _ctx.hide(), [\"stop\"])),\n    ref: \"tooltipBody\"\n  }, [_ctx.title || _ctx.clickMode ? (openBlock(), createElementBlock(\"div\", _hoisted_1$a, [createBaseVNode(\"div\", null, toDisplayString(_ctx.title), 1), _ctx.clickMode ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 0,\n    src: _ctx.Icons.close,\n    style: {\n      \"cursor\": \"pointer\"\n    },\n    onClick: withModifiers(_ctx.hide, [\"stop\"])\n  }, null, 8, [\"src\", \"onClick\"])) : createCommentVNode(\"\", true)])) : createCommentVNode(\"\", true), createBaseVNode(\"div\", _hoisted_2$8, [renderSlot(_ctx.$slots, \"tooltipBody\", {}, () => [createTextVNode(toDisplayString(_ctx.label), 1)])])], 38)), [[vShow, _ctx.domVisible]]) : createCommentVNode(\"\", true), createBaseVNode(\"div\", {\n    style: {\n      \"cursor\": \"pointer\",\n      \"user-select\": \"none\"\n    },\n    onMouseenter: _cache[2] || (_cache[2] = withModifiers($event => _ctx.clickMode ? () => {} : _ctx.show(), [\"prevent\"])),\n    onMouseleave: _cache[3] || (_cache[3] = withModifiers($event => _ctx.clickMode ? () => {} : _ctx.hide(), [\"prevent\"])),\n    onClick: _cache[4] || (_cache[4] = withModifiers(function () {\n      return _ctx.handleClick && _ctx.handleClick(...arguments);\n    }, [\"stop\"]))\n  }, [renderSlot(_ctx.$slots, \"default\")], 32)], 2);\n}\nvar Tooltip = /* @__PURE__ */_export_sfc(_sfc_main$c, [[\"render\", _sfc_render$7]]);\nconst _hoisted_1$9 = {\n  style: {\n    \"border-top\": \"1px solid #dddddd\",\n    \"margin-top\": \"20px\",\n    \"padding-top\": \"15px\"\n  }\n};\nconst _hoisted_2$7 = {\n  style: {\n    \"text-align\": \"left\"\n  }\n};\nconst _hoisted_3$4 = {\n  style: {\n    \"margin-top\": \"10px\"\n  }\n};\nconst _hoisted_4$4 = {\n  class: \"flex-row flex-center\"\n};\nconst _hoisted_5$4 = {\n  style: {\n    \"opacity\": \"0.5\"\n  },\n  class: \"link\"\n};\nconst _sfc_main$b = /* @__PURE__ */defineComponent({\n  props: {\n    appInfo: null\n  },\n  setup(__props) {\n    const props = __props;\n    const {\n      t\n    } = useLocale();\n    const allowedIdentifier = computed$1(() => {\n      var _a;\n      switch ((_a = props.appInfo) == null ? void 0 : _a.allowed_identifier) {\n        case bt.phone:\n          return t(\"phone-number\");\n        case bt.both:\n          return t(\"email-or-phone-number\");\n        default:\n          return t(\"email-address\");\n      }\n    });\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(\"div\", _hoisted_1$9, [createVNode(Tooltip, {\n        title: unref(t)(\"where-is-the-password-field\"),\n        position: unref(TooltipPosition).isTop,\n        clickMode: \"\"\n      }, {\n        tooltipBody: withCtx(() => {\n          var _a, _b;\n          return [createBaseVNode(\"div\", _hoisted_2$7, [createTextVNode(toDisplayString(unref(t)(\"helper-footer-line-1\", [(_b = (_a = __props.appInfo) == null ? void 0 : _a.name) != null ? _b : \"\"])) + \" \", 1), createBaseVNode(\"ul\", null, [createBaseVNode(\"li\", null, toDisplayString(unref(t)(\"helper-footer-bullet-0\")), 1), createBaseVNode(\"li\", null, toDisplayString(unref(t)(\"helper-footer-bullet-1\")), 1), createBaseVNode(\"li\", null, toDisplayString(unref(t)(\"helper-footer-bullet-2\", [unref(allowedIdentifier)])), 1)]), createBaseVNode(\"div\", _hoisted_3$4, toDisplayString(unref(t)(\"helper-footer-line-2\", [unref(allowedIdentifier)])), 1)])];\n        }),\n        default: withCtx(() => [createBaseVNode(\"div\", _hoisted_4$4, [createBaseVNode(\"span\", _hoisted_5$4, toDisplayString(unref(t)(\"where-is-the-password-field\")), 1), createVNode(unref(InlineSvg), {\n          style: {\n            \"margin-left\": \"10px\"\n          },\n          src: unref(Icons).help\n        }, null, 8, [\"src\"])])]),\n        _: 1\n      }, 8, [\"title\", \"position\"])]);\n    };\n  }\n});\nconst _hoisted_1$8 = {\n  class: \"view-email-input\"\n};\nconst _hoisted_2$6 = {\n  class: \"auth-flex-container\"\n};\nconst _hoisted_3$3 = {\n  key: 0,\n  class: \"title main-title has-text-centered\"\n};\nconst _hoisted_4$3 = /* @__PURE__ */createBaseVNode(\"div\", {\n  style: {\n    \"height\": \"20px\"\n  }\n}, null, -1);\nconst _hoisted_5$3 = {\n  key: 3,\n  class: \"notification is-danger has-text-centered\",\n  \"data-test\": \"invalid-app-id\"\n};\nconst _hoisted_6$3 = {\n  class: \"spacer\"\n};\nconst _hoisted_7$3 = {\n  key: 4,\n  class: \"link has-text-centered\"\n};\nconst _hoisted_8$3 = {\n  key: 0\n};\nconst _hoisted_9$3 = [\"onClick\"];\nconst _hoisted_10$2 = {\n  key: 1\n};\nconst _hoisted_11$2 = [\"onClick\"];\nconst _sfc_main$a = /* @__PURE__ */defineComponent({\n  props: {\n    register: {\n      type: Boolean\n    }\n  },\n  setup(__props) {\n    const props = __props;\n    const {\n      t\n    } = useLocale();\n    const showLogin = ref(!props.register);\n    const {\n      appInfo,\n      loading,\n      webauthnAllowed,\n      invalidAppId\n    } = useAppInfo();\n    const identifier = ref(\"\");\n    const {\n      defaultCountryCode\n    } = useDefaultCountryCode();\n    const countryCode = defaultCountryCode;\n    const publicSignup = computed(() => {\n      var _a;\n      return appInfo.value ? (_a = appInfo.value) == null ? void 0 : _a.public_signup : false;\n    });\n    function changeInputPage() {\n      showLogin.value = !showLogin.value;\n    }\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(\"div\", _hoisted_1$8, [createBaseVNode(\"div\", _hoisted_2$6, [!unref(loading) ? (openBlock(), createElementBlock(\"div\", _hoisted_3$3, toDisplayString(showLogin.value ? unref(t)(\"login-title\") : unref(t)(\"register-title\")), 1)) : createCommentVNode(\"\", true), _hoisted_4$3, !unref(loading) ? withDirectives((openBlock(), createBlock(Login, {\n        key: 1,\n        identifier: identifier.value,\n        \"onUpdate:identifier\": _cache[0] || (_cache[0] = $event => identifier.value = $event),\n        canToggleLoginRegister: true,\n        countryCode: unref(countryCode),\n        \"onUpdate:countryCode\": _cache[1] || (_cache[1] = $event => isRef(countryCode) ? countryCode.value = $event : null),\n        appInfo: unref(appInfo),\n        webauthnAllowed: unref(webauthnAllowed),\n        visible: showLogin.value\n      }, null, 8, [\"identifier\", \"countryCode\", \"appInfo\", \"webauthnAllowed\", \"visible\"])), [[vShow, showLogin.value]]) : createCommentVNode(\"\", true), !unref(loading) ? withDirectives((openBlock(), createBlock(Register, {\n        key: 2,\n        identifier: identifier.value,\n        \"onUpdate:identifier\": _cache[2] || (_cache[2] = $event => identifier.value = $event),\n        canToggleLoginRegister: true,\n        countryCode: unref(countryCode),\n        \"onUpdate:countryCode\": _cache[3] || (_cache[3] = $event => isRef(countryCode) ? countryCode.value = $event : null),\n        appInfo: unref(appInfo),\n        webauthnAllowed: unref(webauthnAllowed)\n      }, null, 8, [\"identifier\", \"countryCode\", \"appInfo\", \"webauthnAllowed\"])), [[vShow, !showLogin.value]]) : createCommentVNode(\"\", true), unref(invalidAppId) ? (openBlock(), createElementBlock(\"div\", _hoisted_5$3, toDisplayString(unref(t)(\"invalid-app-id\")), 1)) : createCommentVNode(\"\", true), createBaseVNode(\"div\", _hoisted_6$3, [createVNode(EphemeralAppInfo)]), !unref(loading) ? (openBlock(), createElementBlock(\"div\", _hoisted_7$3, [showLogin.value && unref(publicSignup) ? (openBlock(), createElementBlock(\"div\", _hoisted_8$3, [createTextVNode(toDisplayString(unref(t)(\"dont-have-an-account\")) + \" \", 1), createBaseVNode(\"a\", {\n        onClick: withModifiers(changeInputPage, [\"prevent\"]),\n        role: \"button\",\n        \"data-test\": \"register-link\"\n      }, toDisplayString(unref(t)(\"register-here\")), 9, _hoisted_9$3)])) : !showLogin.value ? (openBlock(), createElementBlock(\"div\", _hoisted_10$2, [createTextVNode(toDisplayString(unref(t)(\"already-have-an-account\")) + \" \", 1), createBaseVNode(\"a\", {\n        onClick: withModifiers(changeInputPage, [\"prevent\"]),\n        role: \"button\",\n        \"data-test\": \"login-link\"\n      }, toDisplayString(unref(t)(\"login-here\")), 9, _hoisted_11$2)])) : createCommentVNode(\"\", true)])) : createCommentVNode(\"\", true), !unref(loading) ? (openBlock(), createBlock(_sfc_main$b, {\n        key: 5,\n        appInfo: unref(appInfo)\n      }, null, 8, [\"appInfo\"])) : createCommentVNode(\"\", true)])]);\n    };\n  }\n});\nconst _hoisted_1$7 = {\n  class: \"view-email-input\"\n};\nconst _hoisted_2$5 = {\n  key: 1,\n  class: \"notification is-danger has-text-centered\",\n  \"data-test\": \"invalid-app-id\"\n};\nconst _sfc_main$9 = /* @__PURE__ */defineComponent({\n  setup(__props) {\n    const {\n      t\n    } = useLocale();\n    const identifier = ref(\"\");\n    const {\n      defaultCountryCode\n    } = useDefaultCountryCode();\n    const countryCode = defaultCountryCode;\n    const {\n      appInfo,\n      loading,\n      webauthnAllowed,\n      invalidAppId\n    } = useAppInfo();\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(\"div\", _hoisted_1$7, [!unref(loading) ? (openBlock(), createBlock(Login, {\n        key: 0,\n        identifier: identifier.value,\n        \"onUpdate:identifier\": _cache[0] || (_cache[0] = $event => identifier.value = $event),\n        countryCode: unref(countryCode),\n        \"onUpdate:countryCode\": _cache[1] || (_cache[1] = $event => isRef(countryCode) ? countryCode.value = $event : null),\n        canToggleLoginRegister: false,\n        appInfo: unref(appInfo),\n        webauthnAllowed: unref(webauthnAllowed)\n      }, null, 8, [\"identifier\", \"countryCode\", \"appInfo\", \"webauthnAllowed\"])) : createCommentVNode(\"\", true), unref(invalidAppId) ? (openBlock(), createElementBlock(\"div\", _hoisted_2$5, toDisplayString(unref(t)(\"invalid-app-id\")), 1)) : createCommentVNode(\"\", true), !unref(loading) ? (openBlock(), createBlock(_sfc_main$b, {\n        key: 2,\n        appInfo: unref(appInfo)\n      }, null, 8, [\"appInfo\"])) : createCommentVNode(\"\", true)]);\n    };\n  }\n});\nconst _hoisted_1$6 = {\n  class: \"view-email-input\"\n};\nconst _hoisted_2$4 = {\n  key: 1,\n  class: \"notification is-danger has-text-centered\",\n  \"data-test\": \"invalid-app-id\"\n};\nconst _sfc_main$8 = /* @__PURE__ */defineComponent({\n  setup(__props) {\n    const {\n      t\n    } = useLocale();\n    const identifier = ref(\"\");\n    const {\n      defaultCountryCode\n    } = useDefaultCountryCode();\n    const countryCode = defaultCountryCode;\n    const {\n      appInfo,\n      loading,\n      webauthnAllowed,\n      invalidAppId\n    } = useAppInfo();\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(\"div\", _hoisted_1$6, [!unref(loading) ? (openBlock(), createBlock(Register, {\n        key: 0,\n        identifier: identifier.value,\n        \"onUpdate:identifier\": _cache[0] || (_cache[0] = $event => identifier.value = $event),\n        countryCode: unref(countryCode),\n        \"onUpdate:countryCode\": _cache[1] || (_cache[1] = $event => isRef(countryCode) ? countryCode.value = $event : null),\n        canToggleLoginRegister: false,\n        appInfo: unref(appInfo),\n        webauthnAllowed: unref(webauthnAllowed)\n      }, null, 8, [\"identifier\", \"countryCode\", \"appInfo\", \"webauthnAllowed\"])) : createCommentVNode(\"\", true), unref(invalidAppId) ? (openBlock(), createElementBlock(\"div\", _hoisted_2$4, toDisplayString(unref(t)(\"invalid-app-id\")), 1)) : createCommentVNode(\"\", true), !unref(loading) ? (openBlock(), createBlock(_sfc_main$b, {\n        key: 2,\n        appInfo: unref(appInfo)\n      }, null, 8, [\"appInfo\"])) : createCommentVNode(\"\", true)]);\n    };\n  }\n});\nconst _sfc_main$7 = defineComponent({\n  name: \"Spinner\"\n});\nconst _hoisted_1$5 = {\n  class: \"spinner-box\"\n};\nconst _hoisted_2$3 = {\n  class: \"spinner-content\"\n};\nfunction _sfc_render$6(_ctx, _cache, $props, $setup, $data, $options) {\n  return openBlock(), createElementBlock(\"div\", _hoisted_1$5, [createBaseVNode(\"div\", _hoisted_2$3, [renderSlot(_ctx.$slots, \"default\")])]);\n}\nvar Spinner = /* @__PURE__ */_export_sfc(_sfc_main$7, [[\"render\", _sfc_render$6]]);\nconst _hoisted_1$4 = {\n  class: \"auth-flex-container\"\n};\nconst _hoisted_2$2 = {\n  class: \"title has-text-centered\"\n};\nconst _hoisted_3$2 = {\n  key: 0,\n  class: \"content has-text-centered\",\n  style: {\n    \"margin-bottom\": \"15px !important\"\n  }\n};\nconst _hoisted_4$2 = [\"innerHTML\"];\nconst _hoisted_5$2 = {\n  class: \"flex-row flex-center\"\n};\nconst _hoisted_6$2 = [\"onClick\", \"disabled\"];\nconst _hoisted_7$2 = /* @__PURE__ */createBaseVNode(\"div\", {\n  class: \"spacer\"\n}, null, -1);\nconst _hoisted_8$2 = {\n  class: \"link has-text-centered\"\n};\nconst _hoisted_9$2 = [\"onClick\"];\nconst _sfc_main$6 = /* @__PURE__ */defineComponent({\n  props: {\n    identifier: null,\n    userIsRegistering: {\n      type: Boolean\n    },\n    identifierVerifying: {\n      type: Boolean\n    },\n    setupNewDevice: {\n      type: Boolean\n    },\n    identifierType: null\n  },\n  setup(__props) {\n    const props = __props;\n    const {\n      t,\n      locale\n    } = useLocale();\n    const {\n      appId\n    } = useAppId();\n    const passage = new Qe(appId.value);\n    const {\n      router: router2\n    } = useRouter();\n    const isEmail = computed(() => {\n      return props.identifierType === IdentifierType.email;\n    });\n    const title = computed(() => {\n      if (props.identifierVerifying) {\n        if (isEmail.value) {\n          if (props.userIsRegistering) {\n            return t(\"verify-email-to-register\");\n          } else {\n            return t(\"verify-email-to-login\");\n          }\n        } else {\n          if (props.userIsRegistering) {\n            return t(\"verify-phone-to-register\");\n          } else {\n            return t(\"verify-phone-to-login\");\n          }\n        }\n      } else {\n        if (isEmail.value) {\n          if (props.userIsRegistering) {\n            return t(\"check-email-to-register\");\n          } else {\n            return t(\"check-email-to-login\");\n          }\n        } else {\n          if (props.userIsRegistering) {\n            return t(\"check-phone-to-register\");\n          } else {\n            return t(\"check-phone-to-login\");\n          }\n        }\n      }\n    });\n    const message = computed(() => {\n      let messageValue = \"\";\n      const messageType = props.identifierType === IdentifierType.email ? t(\"messagetype-email\") : t(\"messagetype-sms\");\n      const messageMedium = props.identifierType === IdentifierType.email ? t(\"email\") : t(\"phone-number\");\n      const registrationType = props.userIsRegistering ? t(\"registration\") : t(\"login\");\n      const loginMessage = props.identifierVerifying ? t(\"please-verify-identifier\", [messageMedium, registrationType]) : t(\"you-will-be-automatically-signed-in\");\n      messageValue = t(\"weve-sent-messagetype\", [messageType, props.identifier, loginMessage]);\n      if (props.setupNewDevice && !props.userIsRegistering) {\n        messageValue = t(\"we-dont-recognize-this-device\") + \" \" + messageValue;\n      }\n      return messageValue;\n    });\n    onMounted(() => {\n      if (props.userIsRegistering) {\n        magicLinkSendRegister();\n      } else {\n        magicLinkSendLogin();\n      }\n    });\n    function changeEmail() {\n      localStorage.removeItem(\"email\");\n      localStorage.removeItem(\"magic_link_id\");\n      localStorage.removeItem(\"wait_count\");\n      waitForActivatedMagicLink(721);\n      router2.push(router2.homeRoute);\n    }\n    function resendMagicLink() {\n      return __async(this, null, function* () {\n        yield magicLinkSendLogin();\n      });\n    }\n    const showWaiting = ref(false);\n    const loading = ref(true);\n    function magicLinkSendRegister() {\n      return __async(this, null, function* () {\n        showWaiting.value = false;\n        loading.value = true;\n        yield new Promise(resolve => {\n          setTimeout(resolve, 2e3);\n        });\n        try {\n          const res = yield passage.newRegisterMagicLink(props.identifier, locale.value.split(\"-\")[0]);\n          if (res.id != \"\") {\n            localStorage.setItem(\"magic_link_id\", res.id);\n            waitForActivatedMagicLink(0);\n          }\n        } catch (err) {\n          console.log(\"magicLinkSend error\", err);\n        } finally {\n          loading.value = false;\n        }\n      });\n    }\n    function magicLinkSendLogin() {\n      return __async(this, null, function* () {\n        showWaiting.value = false;\n        loading.value = true;\n        try {\n          const res = yield passage.newLoginMagicLink(props.identifier, locale.value.split(\"-\")[0]);\n          if (res.id != \"\") {\n            localStorage.setItem(\"magic_link_id\", res.id);\n            waitForActivatedMagicLink(0);\n          }\n        } catch (err) {\n          console.log(\"magicLinkSend error\", err);\n        } finally {\n          yield new Promise(resolve => {\n            setTimeout(resolve, 3e3);\n          });\n          loading.value = false;\n        }\n      });\n    }\n    let authResult = void 0;\n    function lookupMagicLink() {\n      return __async(this, null, function* () {\n        const id = localStorage.getItem(\"magic_link_id\");\n        yield lookupMagicLinkActivated(id).then(() => __async(this, null, function* () {\n          if (authResult && authResult.redirect_url != \"\") {\n            localStorage.removeItem(\"magic_link_id\");\n            localStorage.removeItem(\"wait_count\");\n            yield storeLastLogin();\n            useCallbacks().onEvent.value(OnEventType.onMagicLinkActivated);\n            useCallbacks().onSuccess.value(authResult);\n          }\n        }));\n      });\n    }\n    function lookupMagicLinkActivated(id) {\n      return __async(this, null, function* () {\n        yield passage.getMagicLinkStatus(id).then(res => {\n          waitForActivatedMagicLink(721);\n          authResult = res;\n        }).catch(() => {});\n        return;\n      });\n    }\n    let timer;\n    function waitForActivatedMagicLink(count) {\n      let i = count;\n      if (i < 720) {\n        showWaiting.value = true;\n        timer = setTimeout(() => __async(this, null, function* () {\n          delay(i);\n          i++;\n          waitForActivatedMagicLink(i);\n        }), 5e3);\n      } else {\n        clearTimeout(timer);\n        showWaiting.value = false;\n        return;\n      }\n    }\n    function delay(i) {\n      lookupMagicLink();\n      localStorage.setItem(\"wait_count\", i.toString());\n    }\n    return (_ctx, _cache) => {\n      return openBlock(), createElementBlock(\"div\", _hoisted_1$4, [createBaseVNode(\"div\", _hoisted_2$2, [createBaseVNode(\"span\", null, toDisplayString(unref(title)), 1)]), createVNode(Spinner, null, {\n        default: withCtx(() => [unref(isEmail) ? (openBlock(), createBlock(unref(InlineSvg), {\n          key: 0,\n          src: unref(Icons).email,\n          alt: \"Email envelope\"\n        }, null, 8, [\"src\"])) : (openBlock(), createBlock(unref(InlineSvg), {\n          key: 1,\n          src: unref(Icons).phone,\n          alt: \"Message bubbles\"\n        }, null, 8, [\"src\"]))]),\n        _: 1\n      }), unref(message) ? (openBlock(), createElementBlock(\"div\", _hoisted_3$2, [createBaseVNode(\"span\", {\n        innerHTML: unref(message)\n      }, null, 8, _hoisted_4$2)])) : createCommentVNode(\"\", true), createBaseVNode(\"div\", _hoisted_5$2, [createBaseVNode(\"button\", {\n        onClick: withModifiers(resendMagicLink, [\"prevent\"]),\n        type: \"button\",\n        class: \"button is-primary\",\n        part: \"button\",\n        disabled: loading.value\n      }, toDisplayString(unref(t)(\"resend-isemail-email-message\", [unref(isEmail) ? unref(t)(\"email\") : unref(t)(\"message\")])), 9, _hoisted_6$2)]), _hoisted_7$2, createBaseVNode(\"div\", _hoisted_8$2, [createBaseVNode(\"a\", {\n        onClick: withModifiers(changeEmail, [\"prevent\"]),\n        role: \"button\",\n        \"data-test\": \"change-email-button\"\n      }, toDisplayString(unref(t)(\"change-isemail-email-phone\", [unref(isEmail) ? unref(t)(\"email\") : unref(t)(\"phone\")])), 9, _hoisted_9$2)])]);\n    };\n  }\n});\nconst _sfc_main$5 = defineComponent({\n  name: \"MagicLinkView\",\n  props: {\n    identifier: {\n      type: String,\n      required: true\n    },\n    userIsRegistering: {\n      type: Boolean,\n      default: false\n    },\n    identifierVerifying: {\n      type: Boolean,\n      default: false\n    },\n    setupNewDevice: {\n      type: Boolean,\n      default: false\n    },\n    identifierType: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    MagicLink: _sfc_main$6\n  }\n});\nconst _hoisted_1$3 = {\n  class: \"view-access-token\"\n};\nfunction _sfc_render$5(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_magic_link = resolveComponent(\"magic-link\");\n  return openBlock(), createElementBlock(\"div\", _hoisted_1$3, [createVNode(_component_magic_link, {\n    identifier: _ctx.identifier,\n    userIsRegistering: _ctx.userIsRegistering,\n    identifierVerifying: _ctx.identifierVerifying,\n    setupNewDevice: _ctx.setupNewDevice,\n    identifierType: _ctx.identifierType\n  }, null, 8, [\"identifier\", \"userIsRegistering\", \"identifierVerifying\", \"setupNewDevice\", \"identifierType\"])]);\n}\nvar MagicLinkView = /* @__PURE__ */_export_sfc(_sfc_main$5, [[\"render\", _sfc_render$5]]);\nconst _sfc_main$4 = defineComponent({\n  name: \"RegisterDevice\",\n  components: {\n    InlineSvg,\n    PlatformIcon: _sfc_main$k\n  },\n  props: {\n    identifier: {\n      type: String,\n      required: true\n    },\n    identifierType: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    const {\n      t\n    } = useLocale();\n    const {\n      appId\n    } = useAppId();\n    const {\n      router: router2\n    } = useRouter();\n    const {\n      onSuccess: onSuccess2\n    } = useCallbacks();\n    const showFailure = ref(false);\n    const {\n      autofocusButton\n    } = useAutofocusButton();\n    const isEmail = computed(() => {\n      return props.identifierType === IdentifierType.email;\n    });\n    const title = computed(() => {\n      if (showFailure.value) {\n        return t(\"register-with-link\", [isEmail.value ? t(\"email\") : t(\"sms-text\")]);\n      }\n      return t(\"register-without-a-password\");\n    });\n    return {\n      appId,\n      router: router2,\n      onSuccess: onSuccess2,\n      isEmail,\n      showFailure,\n      title,\n      Icons,\n      t,\n      autofocusButton\n    };\n  },\n  data: () => {\n    return {\n      loading: false,\n      authResult: null,\n      passage: null\n    };\n  },\n  created: function () {\n    this.passage = new Qe(this.appId);\n  },\n  methods: {\n    signUpWebAuthn(identifier) {\n      return __async(this, null, function* () {\n        this.loading = true;\n        this.showFailure = false;\n        this.authResult = {\n          auth_token: \"\",\n          redirect_url: \"\"\n        };\n        try {\n          const res = yield this.passage.register(identifier);\n          this.authResult = res;\n          this.loading = false;\n          if (this.authResult.redirect_url) {\n            storeLastLogin(identifier);\n            this.onSuccess(this.authResult);\n          }\n        } catch (err) {\n          this.showFailure = true;\n          this.loading = false;\n        }\n      });\n    },\n    registerWithEmail() {\n      if (this.showFailure) {\n        this.router.push(MagicLinkRoute, {\n          identifier: this.identifier,\n          identifierType: this.identifierType,\n          userIsRegistering: false\n        });\n      } else {\n        this.router.push(MagicLinkRoute, {\n          identifier: this.identifier,\n          identifierType: this.identifierType,\n          userIsRegistering: true\n        });\n      }\n    },\n    changeEmail() {\n      localStorage.removeItem(\"email\");\n      this.router.push(this.router.homeRoute, {\n        register: true\n      });\n    },\n    redirectNow() {\n      if (this.authResult.redirect_url) {\n        storeLastLogin(this.identifier);\n        this.onSuccess(this.authResult);\n      }\n    },\n    onButtonClick() {\n      this.signUpWebAuthn(this.identifier);\n    }\n  }\n});\nconst _hoisted_1$2 = {\n  class: \"auth-flex-container\"\n};\nconst _hoisted_2$1 = {\n  class: \"title secondary-title has-text-centered\"\n};\nconst _hoisted_3$1 = {\n  class: \"image has-text-centered\"\n};\nconst _hoisted_4$1 = {\n  class: \"content wrap-text has-text-centered\",\n  style: {\n    \"margin-bottom\": \"10px !important\"\n  },\n  \"data-tag\": \"register-device-message\"\n};\nconst _hoisted_5$1 = {\n  key: 0,\n  style: {\n    \"margin-bottom\": \"5px\"\n  }\n};\nconst _hoisted_6$1 = {\n  key: 1\n};\nconst _hoisted_7$1 = {\n  key: 2\n};\nconst _hoisted_8$1 = {\n  style: {\n    \"margin-bottom\": \"10px\"\n  }\n};\nconst _hoisted_9$1 = {\n  key: 0,\n  class: \"flex-row flex-center\"\n};\nconst _hoisted_10$1 = [\"disabled\"];\nconst _hoisted_11$1 = [\"disabled\"];\nconst _hoisted_12$1 = {\n  key: 1,\n  class: \"flex-row flex-center\"\n};\nconst _hoisted_13$1 = [\"disabled\"];\nconst _hoisted_14$1 = {\n  key: 2,\n  class: \"content has-text-centered\",\n  style: {\n    \"margin-top\": \"20px !important\"\n  }\n};\nconst _hoisted_15$1 = {\n  class: \"link\"\n};\nconst _hoisted_16$1 = {\n  key: 3,\n  class: \"spacer\"\n};\nconst _hoisted_17$1 = {\n  key: 4,\n  class: \"flex-row flex-wrap flex-between\"\n};\nconst _hoisted_18 = {\n  class: \"link\"\n};\nconst _hoisted_19 = {\n  class: \"link\"\n};\nfunction _sfc_render$4(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_inline_svg = resolveComponent(\"inline-svg\");\n  const _component_platform_icon = resolveComponent(\"platform-icon\");\n  return openBlock(), createElementBlock(\"div\", _hoisted_1$2, [createBaseVNode(\"div\", _hoisted_2$1, toDisplayString(_ctx.title), 1), createBaseVNode(\"figure\", _hoisted_3$1, [_ctx.showFailure && _ctx.isEmail ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 0,\n    src: _ctx.Icons.loginWithEmail,\n    alt: \"Biometrics scan failed\",\n    style: {\n      \"margin\": \"5px\"\n    }\n  }, null, 8, [\"src\"])) : _ctx.showFailure && !_ctx.isEmail ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 1,\n    src: _ctx.Icons.loginWithText,\n    alt: \"Biometrics scan failed\",\n    style: {\n      \"margin\": \"5px\"\n    }\n  }, null, 8, [\"src\"])) : (openBlock(), createBlock(_component_platform_icon, {\n    key: 2\n  }))]), createBaseVNode(\"div\", _hoisted_4$1, [_ctx.identifier ? (openBlock(), createElementBlock(\"div\", _hoisted_5$1, [createBaseVNode(\"strong\", null, toDisplayString(_ctx.identifier), 1)])) : createCommentVNode(\"\", true), _ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_6$1, [createBaseVNode(\"p\", null, toDisplayString(_ctx.isEmail ? _ctx.t(\"registration-with-link-error-message-email\") : _ctx.t(\"registration-with-link-error-message-phone\")), 1)])) : (openBlock(), createElementBlock(\"div\", _hoisted_7$1, [createBaseVNode(\"div\", _hoisted_8$1, toDisplayString(_ctx.t(\"register-your-account\")), 1), createBaseVNode(\"div\", null, toDisplayString(_ctx.t(\"does-not-give-app-personal-info\")), 1)]))]), _ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_9$1, [createBaseVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = withModifiers(function () {\n      return _ctx.registerWithEmail && _ctx.registerWithEmail(...arguments);\n    }, [\"prevent\"])),\n    type: \"button\",\n    part: \"button\",\n    class: \"button is-primary small\",\n    disabled: _ctx.loading,\n    style: {\n      \"margin-right\": \"5px\"\n    },\n    \"data-test\": \"login-with-email-button\",\n    ref: \"autofocusButton\"\n  }, toDisplayString(_ctx.t(\"send-email-or-text-link\", [_ctx.isEmail ? _ctx.t(\"email\") : _ctx.t(\"sms-text\")])), 9, _hoisted_10$1), createBaseVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = withModifiers(function () {\n      return _ctx.onButtonClick && _ctx.onButtonClick(...arguments);\n    }, [\"prevent\"])),\n    type: \"button\",\n    part: \"button\",\n    class: \"button is-secondary small\",\n    disabled: _ctx.loading,\n    style: {\n      \"margin-left\": \"5px\"\n    }\n  }, toDisplayString(_ctx.t(\"try-again\")), 9, _hoisted_11$1)])) : (openBlock(), createElementBlock(\"div\", _hoisted_12$1, [createBaseVNode(\"button\", {\n    onClick: _cache[2] || (_cache[2] = withModifiers(function () {\n      return _ctx.onButtonClick && _ctx.onButtonClick(...arguments);\n    }, [\"prevent\"])),\n    type: \"button\",\n    class: normalizeClass([\"button\", [{\n      \"is-loading\": _ctx.loading\n    }]]),\n    part: \"button\",\n    disabled: _ctx.loading,\n    \"data-test\": \"register-main-button\",\n    tabindex: \"0\",\n    ref: \"autofocusButton\"\n  }, [createBaseVNode(\"span\", null, toDisplayString(_ctx.t(\"register-with-device\")), 1)], 10, _hoisted_13$1)])), _ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_14$1, [createBaseVNode(\"div\", _hoisted_15$1, [createBaseVNode(\"a\", {\n    onClick: _cache[3] || (_cache[3] = withModifiers(function () {\n      return _ctx.changeEmail && _ctx.changeEmail(...arguments);\n    }, [\"prevent\"])),\n    role: \"button\",\n    \"data-test\": \"change-email-button\"\n  }, toDisplayString(_ctx.t(\"change-isemail-email-phone\", [_ctx.isEmail ? _ctx.t(\"email\") : _ctx.t(\"phone\")])), 1)])])) : createCommentVNode(\"\", true), !_ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_16$1)) : createCommentVNode(\"\", true), !_ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_17$1, [createBaseVNode(\"div\", _hoisted_18, [createBaseVNode(\"a\", {\n    onClick: _cache[4] || (_cache[4] = withModifiers(function () {\n      return _ctx.changeEmail && _ctx.changeEmail(...arguments);\n    }, [\"prevent\"])),\n    role: \"button\",\n    \"data-test\": \"change-email-button\"\n  }, toDisplayString(_ctx.t(\"change-isemail-email-phone\", [_ctx.isEmail ? _ctx.t(\"email\") : _ctx.t(\"phone\")])), 1)]), createBaseVNode(\"div\", _hoisted_19, [createBaseVNode(\"a\", {\n    onClick: _cache[5] || (_cache[5] = withModifiers(function () {\n      return _ctx.registerWithEmail && _ctx.registerWithEmail(...arguments);\n    }, [\"prevent\"])),\n    role: \"button\",\n    \"data-test\": \"register-email-button\"\n  }, toDisplayString(_ctx.t(\"register-with-link\", [_ctx.isEmail ? _ctx.t(\"email\") : _ctx.t(\"sms-text\")])), 1)])])) : createCommentVNode(\"\", true)]);\n}\nvar RegisterDevice = /* @__PURE__ */_export_sfc(_sfc_main$4, [[\"render\", _sfc_render$4]]);\nconst _sfc_main$3 = defineComponent({\n  name: \"RegisterDeviceView\",\n  props: {\n    identifier: {\n      type: String,\n      required: true\n    },\n    identifierType: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    RegisterDevice\n  }\n});\nfunction _sfc_render$3(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_register_device = resolveComponent(\"register-device\");\n  return openBlock(), createBlock(_component_register_device, {\n    identifier: _ctx.identifier,\n    identifierType: _ctx.identifierType\n  }, null, 8, [\"identifier\", \"identifierType\"]);\n}\nvar RegisterDeviceView = /* @__PURE__ */_export_sfc(_sfc_main$3, [[\"render\", _sfc_render$3]]);\nconst _sfc_main$2 = defineComponent({\n  name: \"WebauthnSignIn\",\n  components: {\n    InlineSvg,\n    PlatformIcon: _sfc_main$k\n  },\n  props: {\n    identifier: {\n      type: String,\n      required: true\n    },\n    identifierType: {\n      type: String,\n      required: true\n    }\n  },\n  setup(props) {\n    const {\n      t\n    } = useLocale();\n    const {\n      appId\n    } = useAppId();\n    const {\n      router: router2\n    } = useRouter();\n    const isEmail = computed(() => {\n      return props.identifierType === IdentifierType.email;\n    });\n    const {\n      autofocusButton\n    } = useAutofocusButton();\n    return {\n      appId,\n      router: router2,\n      isEmail,\n      Icons,\n      t,\n      autofocusButton\n    };\n  },\n  data: () => {\n    return {\n      showFailure: false,\n      loading: false,\n      passage: null,\n      authResult: null\n    };\n  },\n  created: function () {\n    this.passage = new Qe(this.appId);\n  },\n  mounted() {\n    this.signInWebAuthn();\n  },\n  methods: {\n    signInWebAuthn() {\n      return __async(this, null, function* () {\n        this.authResult = {\n          auth_token: \"\",\n          redirect_url: \"\"\n        };\n        this.showFailure = false;\n        if (!this.identifier) {\n          return;\n        }\n        this.loading = true;\n        try {\n          const res = yield this.passage.login(this.identifier);\n          this.authResult = res;\n          if (this.authResult.redirect_url) {\n            storeLastLogin(this.identifier);\n            useCallbacks().onSuccess.value(this.authResult);\n          }\n          this.loading = false;\n        } catch (err) {\n          const error = err;\n          this.showFailure = true;\n          this.loading = false;\n          if (error.statusCode === M.PSGParsePublicKeyForLoginFailed) {\n            this.showFailure = true;\n          } else {\n            this.router.push(MagicLinkRoute, {\n              identifier: this.identifier,\n              identifierType: this.identifierType\n            });\n          }\n        }\n      });\n    },\n    loginWithEmail() {\n      this.router.push(MagicLinkRoute, {\n        identifier: this.identifier,\n        identifierType: this.identifierType\n      });\n    },\n    changeEmail() {\n      localStorage.removeItem(\"email\");\n      this.router.push(this.router.homeRoute);\n    }\n  }\n});\nconst _hoisted_1$1 = {\n  class: \"auth-flex-container\"\n};\nconst _hoisted_2 = {\n  class: \"title has-text-centered\"\n};\nconst _hoisted_3 = {\n  class: \"image has-text-centered\",\n  style: {\n    \"margin\": \"5px auto\"\n  }\n};\nconst _hoisted_4 = {\n  key: 0,\n  class: \"content wrap-text has-text-centered\",\n  style: {\n    \"margin-bottom\": \"25px !important\"\n  }\n};\nconst _hoisted_5 = {\n  key: 0,\n  style: {\n    \"margin-bottom\": \"5px\"\n  }\n};\nconst _hoisted_6 = {\n  key: 1,\n  class: \"content wrap-text has-text-centered\",\n  style: {\n    \"margin-bottom\": \"5px !important\"\n  }\n};\nconst _hoisted_7 = {\n  key: 0,\n  style: {\n    \"margin-bottom\": \"5px\"\n  }\n};\nconst _hoisted_8 = {\n  \"data-test\": \"failure-message\"\n};\nconst _hoisted_9 = {\n  key: 2,\n  class: \"flex-row flex-center\"\n};\nconst _hoisted_10 = [\"disabled\"];\nconst _hoisted_11 = [\"disabled\"];\nconst _hoisted_12 = {\n  key: 3,\n  class: \"content has-text-centered\",\n  style: {\n    \"margin-top\": \"20px !important\"\n  }\n};\nconst _hoisted_13 = {\n  class: \"link\"\n};\nconst _hoisted_14 = {\n  key: 4,\n  class: \"spacer\"\n};\nconst _hoisted_15 = {\n  key: 5,\n  class: \"flex-row flex-wrap flex-between\"\n};\nconst _hoisted_16 = {\n  class: \"link\"\n};\nconst _hoisted_17 = {\n  class: \"link\"\n};\nfunction _sfc_render$2(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_inline_svg = resolveComponent(\"inline-svg\");\n  const _component_platform_icon = resolveComponent(\"platform-icon\");\n  return openBlock(), createElementBlock(\"div\", _hoisted_1$1, [createBaseVNode(\"div\", _hoisted_2, toDisplayString(_ctx.showFailure ? _ctx.t(\"login-with-link\", [_ctx.isEmail ? _ctx.t(\"email\") : _ctx.t(\"sms-text\")]) : _ctx.t(\"verify-your-identity\")), 1), createBaseVNode(\"figure\", _hoisted_3, [_ctx.showFailure && _ctx.isEmail ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 0,\n    src: _ctx.Icons.loginWithEmail,\n    alt: \"Biometrics scan failed\",\n    style: {\n      \"margin\": \"5px\"\n    }\n  }, null, 8, [\"src\"])) : _ctx.showFailure && !_ctx.isEmail ? (openBlock(), createBlock(_component_inline_svg, {\n    key: 1,\n    src: _ctx.Icons.loginWithText,\n    alt: \"Biometrics scan failed\",\n    style: {\n      \"margin\": \"5px\"\n    }\n  }, null, 8, [\"src\"])) : (openBlock(), createBlock(_component_platform_icon, {\n    key: 2\n  }))]), !_ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_4, [_ctx.identifier ? (openBlock(), createElementBlock(\"div\", _hoisted_5, [createBaseVNode(\"strong\", null, toDisplayString(_ctx.identifier), 1)])) : createCommentVNode(\"\", true), createBaseVNode(\"div\", null, toDisplayString(_ctx.t(\"log-into-your-account\")), 1)])) : _ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_6, [_ctx.identifier ? (openBlock(), createElementBlock(\"div\", _hoisted_7, [createBaseVNode(\"strong\", null, toDisplayString(_ctx.identifier), 1)])) : createCommentVNode(\"\", true), createBaseVNode(\"div\", _hoisted_8, [createBaseVNode(\"p\", null, toDisplayString(_ctx.isEmail ? _ctx.t(\"login-with-link-error-message-email\") : _ctx.t(\"login-with-link-error-message-phone\")), 1)])])) : createCommentVNode(\"\", true), _ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_9, [createBaseVNode(\"button\", {\n    onClick: _cache[0] || (_cache[0] = withModifiers(function () {\n      return _ctx.loginWithEmail && _ctx.loginWithEmail(...arguments);\n    }, [\"prevent\"])),\n    type: \"button\",\n    part: \"button\",\n    class: \"button is-primary small\",\n    disabled: _ctx.loading,\n    style: {\n      \"margin-right\": \"5px\"\n    },\n    \"data-test\": \"login-with-email-button\",\n    ref: \"autofocusButton\"\n  }, toDisplayString(_ctx.t(\"send-email-or-text-link\", [_ctx.isEmail ? _ctx.t(\"email\") : _ctx.t(\"sms-text\")])), 9, _hoisted_10), createBaseVNode(\"button\", {\n    onClick: _cache[1] || (_cache[1] = withModifiers(function () {\n      return _ctx.signInWebAuthn && _ctx.signInWebAuthn(...arguments);\n    }, [\"prevent\"])),\n    type: \"button\",\n    part: \"button\",\n    class: \"button is-secondary small\",\n    disabled: _ctx.loading,\n    style: {\n      \"margin-left\": \"5px\"\n    }\n  }, toDisplayString(_ctx.t(\"try-again\")), 9, _hoisted_11)])) : createCommentVNode(\"\", true), _ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_12, [createBaseVNode(\"div\", _hoisted_13, [createBaseVNode(\"a\", {\n    onClick: _cache[2] || (_cache[2] = withModifiers(function () {\n      return _ctx.changeEmail && _ctx.changeEmail(...arguments);\n    }, [\"prevent\"])),\n    role: \"button\",\n    \"data-test\": \"change-email-button\"\n  }, toDisplayString(_ctx.t(\"change-isemail-email-phone\", [_ctx.isEmail ? _ctx.t(\"email\") : _ctx.t(\"phone\")])), 1)])])) : createCommentVNode(\"\", true), !_ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_14)) : createCommentVNode(\"\", true), !_ctx.showFailure ? (openBlock(), createElementBlock(\"div\", _hoisted_15, [createBaseVNode(\"div\", _hoisted_16, [createBaseVNode(\"a\", {\n    onClick: _cache[3] || (_cache[3] = withModifiers(function () {\n      return _ctx.changeEmail && _ctx.changeEmail(...arguments);\n    }, [\"prevent\"])),\n    role: \"button\",\n    \"data-test\": \"change-email-button\"\n  }, toDisplayString(_ctx.t(\"change-isemail-email-phone\", [_ctx.isEmail ? _ctx.t(\"email\") : _ctx.t(\"phone\")])), 1)]), createBaseVNode(\"div\", _hoisted_17, [createBaseVNode(\"a\", {\n    onClick: _cache[4] || (_cache[4] = withModifiers(function () {\n      return _ctx.loginWithEmail && _ctx.loginWithEmail(...arguments);\n    }, [\"prevent\"])),\n    role: \"button\",\n    \"data-test\": \"register-email-button\"\n  }, toDisplayString(_ctx.t(\"login-with-link\", [_ctx.isEmail ? _ctx.t(\"email\") : _ctx.t(\"sms-text\")])), 1)])])) : createCommentVNode(\"\", true)]);\n}\nvar WebauthnSignIn = /* @__PURE__ */_export_sfc(_sfc_main$2, [[\"render\", _sfc_render$2]]);\nconst _sfc_main$1 = defineComponent({\n  name: \"WebauthnSignInView\",\n  props: {\n    identifier: {\n      type: String,\n      required: true\n    },\n    identifierType: {\n      type: String,\n      required: true\n    }\n  },\n  components: {\n    WebauthnSignIn\n  }\n});\nconst _hoisted_1 = {\n  class: \"view-webauthn-sign-in\"\n};\nfunction _sfc_render$1(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_webauthn_sign_in = resolveComponent(\"webauthn-sign-in\");\n  return openBlock(), createElementBlock(\"div\", _hoisted_1, [createVNode(_component_webauthn_sign_in, {\n    identifier: _ctx.identifier,\n    identifierType: _ctx.identifierType\n  }, null, 8, [\"identifier\", \"identifierType\"])]);\n}\nvar WebauthnSignInView = /* @__PURE__ */_export_sfc(_sfc_main$1, [[\"render\", _sfc_render$1]]);\nconst _sfc_main = defineComponent({\n  name: \"RouterView\",\n  components: {\n    ActivateMagicLinkView,\n    AuthView: _sfc_main$a,\n    LoginView: _sfc_main$9,\n    RegisterView: _sfc_main$8,\n    MagicLinkView,\n    RegisterDeviceView,\n    WebauthnSignInView\n  },\n  setup() {\n    const {\n      currentRoute: currentRoute2\n    } = useRouter();\n    const currentComponent = computed(() => currentRoute2.value.component);\n    const currentProps = computed(() => {\n      const props = currentRoute2.value.props;\n      if (props === void 0) {\n        return {};\n      }\n      return props;\n    });\n    return {\n      currentComponent,\n      currentProps\n    };\n  }\n});\nfunction _sfc_render(_ctx, _cache, $props, $setup, $data, $options) {\n  return openBlock(), createBlock(resolveDynamicComponent(_ctx.currentComponent), normalizeProps(guardReactiveProps(_ctx.currentProps)), {\n    default: withCtx(() => [renderSlot(_ctx.$slots, \"default\")]),\n    _: 3\n  }, 16);\n}\nvar PassageRouterView = /* @__PURE__ */_export_sfc(_sfc_main, [[\"render\", _sfc_render]]);\nexport { LoginRoute as L, PassageRouterView as P, RegisterRoute as R, useRouter as a, useCallbacks as u };","map":{"version":3,"names":["r","ref","n","readonly","p","reactive","q","computed","w","watch","d","defineComponent","I","InlineSvg","t","_sfc_main$k","x","useLocale","c","useAppId","y","useAddDevice","z","Icons","_","_export_sfc","e","resolveComponent","f","createElementBlock","h","createBaseVNode","A","toDisplayString","B","normalizeClass","i","createBlock","C","withModifiers","D","createCommentVNode","F","Fragment","k","openBlock","Q","Qe","M","E","onMounted","g","withDirectives","v","vShow","G","normalizeStyle","H","createVNode","J","bt","K","isStringNullish","L","vt","S","St","N","intlTelInput","O","createTextVNode","P","vModelText","R","renderSlot","U","UserMetadata","T","LayoutType","V","transformMetadata","W","X","withCtx","Y","onBeforeMount","Z","computed$1","$","unref","a0","useAppInfo","a1","isRef","j","useDefaultCountryCode","a2","normalizeProps","a3","guardReactiveProps","a4","resolveDynamicComponent","OnEventType","OnEventType2","defaultBeforeAuth","defaultOnSuccess","authResult2","window","location","href","redirect_url","defaultOnEvent","beforeAuth","onSuccess","onEvent","setBeforeAuth","newBeforeAuth","value","setOnSuccess","newOnSuccess","setOnEvent","newOnEvent","useCallbacks","AuthRoute","component","LoginRoute","RegisterRoute","RegisterDeviceRoute","MagicLinkRoute","WebauthnSignInRoute","ActivateMagicLinkRoute","Router","constructor","_history","_homeRoute","push","homeRoute","currentRoute","length","route","props","__spreadProps","__spreadValues","resetRouter","router","useRouter","useAutofocusButton","autofocusButton","autofocus","focus","_sfc_main$j","name","components","PlatformIcon","authResult","type","Object","required","setup","appId","showFailure","showSuccess","newDevice","addDevice","addPending","errorMessage","title","onButtonClick","__async","_a","_b","id","onSkipButtonClick","_hoisted_2$c","class","_hoisted_4$8","key","style","_hoisted_8$6","_ctx","_hoisted_1$g","_component_inline_svg","src","fingerprintFailed","alt","_component_platform_icon","_hoisted_3$8","_hoisted_5$8","_hoisted_6$7","_hoisted_7$6","onClick","_cache","arguments","part","disabled","_hoisted_10$4","_hoisted_11$4","_hoisted_9$5","_hoisted_12$3","role","useUIState","loading","pageLoading","showAddDevice","uiSuccess","_ref","uiError","uiLoading","_ref2","checkUserGestureRequired","webkitConvertPointFromNodeToPage","useWebauthnUtils","passage","deviceRecognized","webauthnAllowed","userGestureRequired","verifyWebAuthnAllowed","appInfo","checkWebauthnConfig","isWebauthnSupported","isDeviceRecognized","magicLink","userID","split","credIDExists","checkWebauthnAndDeviceRecognized","MagicLinkActionEnum","MagicLinkActionEnum2","useMagicLinkUtils","magicLinkAction","invalidMagicLink","isMagicLinkValid","searchParams","URLSearchParams","has","storageKey","getLastLogin","localStorage","getItem","storeLastLogin","identiferOrUserInfo","setItem","currentInfo","getCurrentUser","userInfo","email","phone","useMagicLinkActivation","_ref3","uiState","magicLinkUtils","webauthnUtils","onBeforeActivate","auth_token","onActivateError","onActivateErrorInvalidMagicLink","onActivateSuccess","_0","_ref4","result","Promise","resolve","setTimeout","activateWithoutBiometrics","magicLinkActivate","err","statusCode","NotFound","activateWithBiometrics","magicLinkActivateWebAuthnLogin","error","PSGCredObjectDoesNotExist","Unauthorized","_sfc_main$i","String","AddDevice","activation","redirectNow","shouldAutoActivate","shouldAutoActivateWithBio","onMagicLinkActivateSuccess","_hoisted_3$7","_hoisted_1$f","_hoisted_2$b","fingerprintSuccess","emailSuccess","VERIFY","emailFailed","LOGIN","_hoisted_4$7","_hoisted_5$7","_hoisted_6$6","_hoisted_7$5","_hoisted_8$5","_hoisted_9$4","_hoisted_10$3","_hoisted_11$3","_hoisted_12$2","_hoisted_13$2","_hoisted_15$2","_hoisted_16$2","_hoisted_17$2","_hoisted_18$1","_hoisted_14$2","_component_AddDevice","_sfc_main$h","ActivateMagicLink","_hoisted_1$e","_component_activate_magic_link","useMagicLink","router2","queryString","search","urlParams","get","IdentifierType","IdentifierType2","_sfc_main$g","emits","validationError","default","identifier","countryCode","identifierMode","showWelcomeBack","Boolean","context","identifierParseError","identifierInput","controlContainer","showWelcomeUI","label","identifierType","both","charAt","toUpperCase","slice","placeholder","inputMode","identifierText","set","newIdentifier","emit","formattedIdentifier","isPhoneNumber","phoneInput","getNumber","trim","toLowerCase","clearErrors","checkIdentifier","validateInput","identifierExists","userHasWebauthn","userHasPasskey","emailVerified","phoneVerified","userStatus","webauthn","status","email_verified","phone_verified","webauthn_types","includes","Passkey","INACTIVE","isEmail","emailRegEx","test","isPhoneNumberRegex","isValidNumber","message","showCountryCode","addEventListener","getSelectedCountryData","iso2","initialCountry","utilsScript","dropdownContainer","autoPlaceholder","hideCountryCode","destroy","moveInput","parent","getRootNode","host","appendChild","labelRef","moveBack","append","phoneNumberRegex","countryCodeText","newValue","setCountry","switchAccount","_hoisted_1$d","_hoisted_4$6","$props","$setup","$data","$options","onSubmit","_hoisted_2$a","$event","autocomplete","inputmode","onInput","_hoisted_3$6","$slots","_hoisted_5$6","_hoisted_6$5","_sfc_main$f","ValidatedIdentifierForm","canToggleLoginRegister","visible","newCountryCode","inputForm","onLoaded","allowed_identifier","event","beforeAuthResult","errorString","checkIdentifierExistsAndStatus","userNeedsToVerify","identifierVerifying","browserInfo","tryPasskey","PublicKeyCredential","getPassKeySupported","onVerifyIdentity","onMagicLinkLogin","setupNewDevice","identiferString","require_identifier_verification","lastLogin","_component_validated_identifier_form","onOnSubmit","_sfc_main$e","publicSignup","public_signup","validMetadata","metadataComponent","validate","ACTIVE","createUser","user_metadata","metadata","user_metadata_schema","startsWith","userIsRegistering","onRegisterDevice","onMagicLinkRegister","layouts","registration","_component_user_metadata","isEditing","layoutType","Registration","userMetadata","_hoisted_1$c","ephemeralAppIdKey","ephemeralAppNameKey","EphemeralAppService","newEphemeralApp","ephemeralAppUrl","response","fetch","method","body","JSON","stringify","auth_origin","origin","Math","random","toString","responseBody","json","app","_sfc_main$d","consoleUrl","isEphemeral","claimed","ephemeralClaimUrl","exampleTag","passageWebSetup","appIdUnassigned","updateAppId","ephemeralAppId","ephemeralAppName","nameParam","encodeURIComponent","logToConsole","ephemeralService","res","checkIfClaimed","ephemeral","console","info","_hoisted_1$b","_hoisted_2$9","_hoisted_3$5","_hoisted_4$5","target","_hoisted_5$5","_hoisted_7$4","_hoisted_8$4","TooltipPosition","TooltipPosition2","_sfc_main$c","active","sticky","position","clickMode","parentItem","tooltipBody","width","maxHeight","absoluteHeight","cssVisible","domVisible","calculateTooltipSize","absoluteMaxWidth","parentItemDiv","viewport","getElementById","left","viewLeft","right","viewRight","getBoundingClientRect","itemLeft","itemRight","top","itemTop","itemMidpoint","spaceLeft","spaceRight","viewportSafeWidth","viewportSafeHeight","min","calculateScrollHeight","contentHeight","scrollHeight","show","clearTimeout","hideTimeout","innerTimeout","hide","cancelHide","handleClick","onMouseenter","onMouseleave","_hoisted_1$a","close","_hoisted_2$8","allowedIdentifier","showLogin","register","invalidAppId","defaultCountryCode","changeInputPage","_sfc_main$7","_hoisted_1$5","_hoisted_2$3","locale","messageValue","messageType","messageMedium","registrationType","loginMessage","magicLinkSendRegister","magicLinkSendLogin","changeEmail","removeItem","waitForActivatedMagicLink","resendMagicLink","showWaiting","newRegisterMagicLink","log","newLoginMagicLink","lookupMagicLink","lookupMagicLinkActivated","then","onMagicLinkActivated","getMagicLinkStatus","catch","timer","count","delay","_sfc_main$5","MagicLink","_sfc_main$6","_hoisted_1$3","_component_magic_link","_sfc_main$4","onSuccess2","data","created","methods","signUpWebAuthn","registerWithEmail","_hoisted_2$1","_hoisted_4$1","_hoisted_7$1","_hoisted_18","_hoisted_1$2","_hoisted_3$1","loginWithEmail","loginWithText","_hoisted_5$1","_hoisted_6$1","_hoisted_8$1","_hoisted_9$1","_hoisted_10$1","_hoisted_11$1","_hoisted_12$1","tabindex","_hoisted_13$1","_hoisted_14$1","_hoisted_15$1","_hoisted_16$1","_hoisted_17$1","_hoisted_19","_sfc_main$3","RegisterDevice","_component_register_device","_sfc_main$2","mounted","signInWebAuthn","login","PSGParsePublicKeyForLoginFailed","_hoisted_3","_hoisted_16","_hoisted_1$1","_hoisted_2","_hoisted_4","_hoisted_5","_hoisted_6","_hoisted_7","_hoisted_8","_hoisted_9","_hoisted_10","_hoisted_11","_hoisted_12","_hoisted_13","_hoisted_14","_hoisted_15","_hoisted_17","_sfc_main$1","WebauthnSignIn","_hoisted_1","_component_webauthn_sign_in","_sfc_main","ActivateMagicLinkView","AuthView","_sfc_main$a","LoginView","_sfc_main$9","RegisterView","_sfc_main$8","MagicLinkView","RegisterDeviceView","WebauthnSignInView","currentRoute2","currentComponent","currentProps","_sfc_render"],"sources":["/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/composables/useCallbacks.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/router/routes.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/router/router.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/composables/useRouter.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/composables/useAutofocusButton.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/ActivateMagicLink/components/AddDevice.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/ActivateMagicLink/composables/useUIState.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/utils/userGestureRequired.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/ActivateMagicLink/composables/useWebauthnUtils.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/ActivateMagicLink/composables/useMagicLinkUtils.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/utils/lastLogin.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/ActivateMagicLink/composables/useMagicLinkActivation.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/ActivateMagicLink/ActivateMagicLink.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/views/ActivateMagicLinkView.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/composables/useMagicLink.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/ValidatedIdentifierForm/IntentifierTypes.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/ValidatedIdentifierForm/ValidatedIdentifierForm.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/Login/Login.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/Register/Register.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/services/EphemeralAppService.ts","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/EphemeralAppInfo/EphemeralAppInfo.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/ui-components/Tooltip.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/HelpFooter/HelpFooter.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/views/AuthView.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/views/LoginView.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/views/RegisterView.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/ui-components/Spinner.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/MagicLink/MagicLink.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/views/MagicLinkView.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/RegisterDevice/RegisterDevice.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/views/RegisterDeviceView.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/components/WebauthnSignIn/WebauthnSignIn.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/views/WebauthnSignInView.vue","/Users/kaalabhairava/Documents/PassageExpress/example-react/03-Login-With-Profile/node_modules/@passageidentity/passage-elements/src/PassageAuth/views/RouterView/RouterView.vue"],"sourcesContent":["import { ref, readonly, Ref } from 'vue'\nimport { authResult } from '@passageidentity/passage-js'\n\ninterface IUseCallbacks {\n  beforeAuth: Ref<BeforeAuthCallback>\n  onSuccess: Ref<OnSuccessCallback>\n  onEvent: Ref<OnEventCallback>\n  setBeforeAuth: (newBeforeAuth?: BeforeAuthCallback) => void\n  setOnSuccess: (newOnSuccess?: OnSuccessCallback) => void\n  setOnEvent: (newOnEvent?: OnEventCallback) => void\n}\n\nexport enum OnEventType {\n  onLoaded = 'onLoaded',\n  onRegisterDevice = 'onRegisterDevice',\n  onVerifyIdentity = 'onVerifyIdentity',\n  onMagicLinkLogin = 'onMagicLinkLogin',\n  onMagicLinkRegister = 'onMagicLinkRegister',\n  onMagicLinkActivated = 'onMagicLinkActivated',\n  onMagicLinkActivateSuccess = 'onMagicLinkActivateSuccess',\n}\n\nexport type BeforeAuthCallback = (identifier: string) => boolean\n\nexport type OnSuccessCallback = (authResult: authResult) => void\n\nexport type OnEventCallback = (type: OnEventType, data?: unknown) => void\n\nconst defaultBeforeAuth = () => {\n  return true\n}\n\nconst defaultOnSuccess = (authResult: authResult) => {\n  window.location.href = authResult.redirect_url\n}\n\nconst defaultOnEvent = () => {\n  return\n}\n\nconst beforeAuth = ref<BeforeAuthCallback>(defaultBeforeAuth)\n\nconst onSuccess = ref<OnSuccessCallback>(defaultOnSuccess)\n\nconst onEvent = ref<OnEventCallback>(defaultOnEvent)\n\nfunction setBeforeAuth(newBeforeAuth?: BeforeAuthCallback) {\n  if (newBeforeAuth === undefined) {\n    beforeAuth.value = defaultBeforeAuth\n    return\n  }\n  beforeAuth.value = newBeforeAuth\n}\n\nfunction setOnSuccess(newOnSuccess?: OnSuccessCallback) {\n  if (newOnSuccess === undefined) {\n    onSuccess.value = defaultOnSuccess\n    return\n  }\n  onSuccess.value = newOnSuccess\n}\n\nfunction setOnEvent(newOnEvent?: OnEventCallback) {\n  if (newOnEvent === undefined) {\n    onEvent.value = defaultOnEvent\n    return\n  }\n  onEvent.value = newOnEvent\n}\n\nexport function useCallbacks(): IUseCallbacks {\n  return {\n    beforeAuth: readonly(beforeAuth),\n    onSuccess: readonly(onSuccess),\n    onEvent: readonly(onEvent),\n    setBeforeAuth,\n    setOnSuccess,\n    setOnEvent,\n  }\n}\n","import { IdentifierType } from '@/PassageAuth/components/ValidatedIdentifierForm/IntentifierTypes'\n\nexport interface IRoute<T> {\n  component: string\n  props?: T\n}\n\nexport interface IHomeRouteProps {\n  register?: boolean\n}\nexport const AuthRoute: IRoute<IHomeRouteProps> = {\n  component: 'auth-view',\n}\nexport const LoginRoute: IRoute<IHomeRouteProps> = {\n  component: 'login-view',\n}\nexport const RegisterRoute: IRoute<IHomeRouteProps> = {\n  component: 'register-view',\n}\n\nexport interface IRegisterDeviceRouteProps {\n  identifier: string\n  identifierType: IdentifierType\n}\nexport const RegisterDeviceRoute: IRoute<IRegisterDeviceRouteProps> = {\n  component: 'register-device-view',\n}\n\nexport interface IMagicLinkRouteProps {\n  identifier: string\n  identifierType: IdentifierType\n  setupNewDevice?: boolean\n  userIsRegistering?: boolean\n  identifierVerifying?: boolean\n}\nexport const MagicLinkRoute: IRoute<IMagicLinkRouteProps> = {\n  component: 'magic-link-view',\n}\n\nexport interface IWebauthnSignInRouteProps {\n  identifier: string\n  identifierType: IdentifierType\n}\nexport const WebauthnSignInRoute: IRoute<IWebauthnSignInRouteProps> = {\n  component: 'webauthn-sign-in-view',\n}\n\nexport interface IActivateMagicLinkRouteProps {\n  magicLink: string\n}\nexport const ActivateMagicLinkRoute: IRoute<IActivateMagicLinkRouteProps> = {\n  component: 'activate-magic-link-view',\n}\n\nexport type RouteProps =\n  | IHomeRouteProps\n  | IRegisterDeviceRouteProps\n  | IMagicLinkRouteProps\n  | IWebauthnSignInRouteProps\n  | IActivateMagicLinkRouteProps\n","import { IRoute, IHomeRouteProps, AuthRoute, RouteProps } from './routes'\n\nexport class Router {\n  private _history: IRoute<RouteProps>[] = []\n  private _homeRoute: IRoute<IHomeRouteProps> = AuthRoute\n\n  constructor() {\n    this._history.push(this._homeRoute)\n  }\n\n  get homeRoute(): IRoute<IHomeRouteProps> {\n    return this._homeRoute\n  }\n\n  set homeRoute(homeRoute: IRoute<IHomeRouteProps>) {\n    this._homeRoute = homeRoute\n    this._history[0] = homeRoute\n  }\n\n  get currentRoute(): IRoute<RouteProps> {\n    return this._history[this._history.length - 1]\n  }\n\n  push<T>(route: IRoute<T>, props?: T): void {\n    /* eslint-disable-next-line @typescript-eslint/ban-ts-comment */\n    // @ts-ignore\n    this._history.push({ ...route, props })\n  }\n\n  resetRouter(): void {\n    this._history = []\n    this._homeRoute = AuthRoute\n    this._history.push(this._homeRoute)\n  }\n}\n","import { reactive, computed } from 'vue'\nimport { Router } from '../router/router'\nimport { IRoute, RouteProps } from '../router/routes'\n\nconst router = reactive<Router>(new Router())\nconst currentRoute = computed<IRoute<RouteProps>>(() => router.currentRoute)\n\n// eslint-disable-next-line @typescript-eslint/explicit-module-boundary-types\nexport function useRouter() {\n  return {\n    router,\n    currentRoute,\n  }\n}\n","import { Ref, ref, watch } from 'vue'\n\ninterface IAutoFocusButton {\n  autofocusButton: Ref<HTMLElement | undefined>\n}\n\nexport function useAutofocusButton(): IAutoFocusButton {\n  const autofocusButton = ref<HTMLElement>()\n\n  function autofocus() {\n    if (autofocusButton.value === undefined) {\n      return\n    }\n    autofocusButton.value.focus()\n  }\n\n  watch(autofocusButton, () => {\n    autofocus()\n  })\n\n  return {\n    autofocusButton,\n  }\n}\n","<template>\n  <div class=\"title has-text-centered\" :class=\"[showFailure ? 'secondary-title' : 'main-title']\">\n    {{ title }}\n  </div>\n\n  <figure class=\"image has-text-centered\">\n    <inline-svg v-if=\"showFailure\" :src=\"Icons.fingerprintFailed\" alt=\"Device failure\" />\n    <platform-icon v-else />\n  </figure>\n\n  <div class=\"content has-text-centered\" data-test=\"activate-magic-link-message\">\n    <div v-if=\"showFailure\">{{ t('failed-to-add-this-device') }}</div>\n    <div v-else>\n      <div style=\"margin-bottom: 10px\">\n        <strong>{{ t('save-device') }}</strong>\n      </div>\n      <div style=\"margin-bottom: 10px\">\n        {{ t('trust-device') }}\n      </div>\n      <div style=\"margin-bottom: 10px\">\n        {{ t('does-not-give-app-personal-info') }}\n      </div>\n    </div>\n  </div>\n\n  <!-- On Safari, we may need text here so the user knows they need to click because of their browser -->\n  <!-- If this is true, show the button -->\n  <div class=\"flex-row flex-center\" style=\"padding: 20px 0px\">\n    <button\n      @click.prevent=\"onButtonClick\"\n      type=\"button\"\n      class=\"button is-primary\"\n      part=\"button\"\n      :class=\"{ 'is-loading': addPending }\"\n      :disabled=\"addPending\"\n      data-test=\"save-device-button\"\n      ref=\"autofocusButton\"\n    >\n      <span v-if=\"showFailure\">{{ t('try-again') }}</span>\n      <span v-else>{{ t('continue') }}</span>\n    </button>\n  </div>\n\n  <div class=\"link has-text-centered\" v-if=\"!showSuccess\">\n    <div>\n      <a @click.prevent=\"onSkipButtonClick\" role=\"button\" data-test=\"add-device-skip\">{{ t('skip') }}</a>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, ref, computed } from 'vue'\nimport { authResult, PassageDevice } from '@passageidentity/passage-js'\nimport type { PropType } from 'vue'\nimport { useCallbacks } from '@/composables/useCallbacks'\nimport useAddDevice from '../../../../composables/useAddDevice'\nimport { useAppId } from '@/composables/useAppId'\nimport { Icons } from '@/utils/Icons'\nimport InlineSvg from 'vue-inline-svg'\nimport PlatformIcon from '@/components/PlatformIcon/PlatformIcon.vue'\nimport { useLocale } from '@/composables/useLocale'\nimport { useAutofocusButton } from '@/composables/useAutofocusButton'\n\nexport default defineComponent({\n  name: 'AddDevice',\n  components: {\n    InlineSvg,\n    PlatformIcon,\n  },\n  props: {\n    authResult: {\n      type: Object as PropType<authResult>,\n      required: false,\n    },\n  },\n  setup(props) {\n    const { t } = useLocale()\n    const { appId } = useAppId()\n    const showFailure = ref<boolean>(false)\n    const showSuccess = ref<boolean>(false)\n    const newDevice = ref<PassageDevice>()\n    const { addDevice, addPending, errorMessage } = useAddDevice(appId.value)\n    const { autofocusButton } = useAutofocusButton()\n\n    const title = computed<string>(() => {\n      if (showFailure.value) {\n        return t('something-went-wrong')\n      } else {\n        return t('success')\n      }\n    })\n\n    async function onButtonClick() {\n      newDevice.value = await addDevice()\n      if (newDevice.value?.id) {\n        showSuccess.value = true\n        showFailure.value = false\n        if (props.authResult?.redirect_url) {\n          useCallbacks().onSuccess.value(props.authResult)\n        }\n      } else {\n        showFailure.value = true\n        showSuccess.value = false\n      }\n    }\n\n    const onSkipButtonClick = () => {\n      if (props.authResult?.redirect_url) {\n        useCallbacks().onSuccess.value(props.authResult)\n      }\n    }\n    return {\n      showSuccess,\n      showFailure,\n      title,\n      addPending,\n      errorMessage,\n      newDevice,\n      onButtonClick,\n      onSkipButtonClick,\n      Icons,\n      t,\n      autofocusButton,\n    }\n  },\n})\n</script>\n","import { useLocale } from '@/composables/useLocale'\nimport { ref, Ref, computed, ComputedRef } from 'vue'\n\nexport interface IUseUIState {\n  showFailure: Ref<boolean>\n  showSuccess: Ref<boolean>\n  loading: Ref<boolean>\n  pageLoading: Ref<boolean>\n  showAddDevice: Ref<boolean>\n  title: ComputedRef<string>\n  uiSuccess: (props: { addDevice: boolean }) => void\n  uiLoading: (props: { addDevice: boolean }) => void\n  uiError: () => void\n}\n\nexport default function useUIState(): IUseUIState {\n  const showFailure = ref<boolean>(false)\n  const showSuccess = ref<boolean>(false)\n  const loading = ref<boolean>(false)\n  const pageLoading = ref<boolean>(true)\n  const showAddDevice = ref<boolean>(false)\n  const { t } = useLocale()\n\n  const title = computed<string>(() => {\n    if (showSuccess.value) {\n      return t('success')\n    }\n    if (showFailure.value) {\n      return t('something-went-wrong')\n    }\n    return t('verify-your-identity')\n  })\n\n  const uiSuccess = ({ addDevice = false }) => {\n    showSuccess.value = true\n    showFailure.value = false\n    showAddDevice.value = addDevice\n    loading.value = false\n  }\n\n  const uiError = () => {\n    showSuccess.value = false\n    showFailure.value = true\n    showAddDevice.value = false\n    loading.value = false\n  }\n\n  const uiLoading = ({ addDevice = false }) => {\n    showSuccess.value = false\n    showFailure.value = false\n    showAddDevice.value = addDevice\n    loading.value = true\n  }\n\n  return {\n    showFailure,\n    showSuccess,\n    loading,\n    pageLoading,\n    showAddDevice,\n    title,\n    uiSuccess,\n    uiError,\n    uiLoading,\n  }\n}\n","export function checkUserGestureRequired(): boolean {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  return typeof (window as any).webkitConvertPointFromNodeToPage === 'function'\n}\n","import { Ref, ref } from 'vue'\nimport { Passage } from '@passageidentity/passage-js'\nimport { checkUserGestureRequired } from '@/utils/userGestureRequired'\n\nexport interface IUseWebauthnUtils {\n  deviceRecognized: Ref<boolean>\n  webauthnAllowed: Ref<boolean>\n  userGestureRequired: boolean\n  verifyWebAuthnAllowed: () => Promise<boolean>\n  isDeviceRecognized: (magicLink: string) => boolean\n  checkWebauthnAndDeviceRecognized: (magicLink: string) => Promise<void>\n}\n\nexport default function useWebauthnUtils(passage: Passage): IUseWebauthnUtils {\n  const deviceRecognized = ref<boolean>(false)\n  const webauthnAllowed = ref<boolean>(false)\n\n  const userGestureRequired = checkUserGestureRequired()\n\n  const verifyWebAuthnAllowed = async () => {\n    const appInfo = await passage.appInfo()\n    if (passage.checkWebauthnConfig(appInfo)) {\n      webauthnAllowed.value = await passage.isWebauthnSupported(false)\n    } else {\n      webauthnAllowed.value = false\n    }\n    return webauthnAllowed.value\n  }\n\n  const isDeviceRecognized = (magicLink: string): boolean => {\n    const userID = magicLink.split('.')[2]\n    deviceRecognized.value = webauthnAllowed.value && passage.credIDExists(userID) ? true : false\n    return deviceRecognized.value\n  }\n\n  const checkWebauthnAndDeviceRecognized = async (magicLink: string): Promise<void> => {\n    await verifyWebAuthnAllowed()\n    isDeviceRecognized(magicLink)\n  }\n\n  return {\n    deviceRecognized,\n    webauthnAllowed,\n    userGestureRequired,\n    checkWebauthnAndDeviceRecognized,\n    verifyWebAuthnAllowed,\n    isDeviceRecognized,\n  }\n}\n","import { Ref, ref } from 'vue'\n\nexport enum MagicLinkActionEnum {\n  LOGIN = 'psg_magic_link',\n  VERIFY = 'psg_verify_link',\n}\n\nexport interface IUseMagicLinkUtils {\n  magicLinkAction: Ref<MagicLinkActionEnum | undefined>\n  invalidMagicLink: Ref<boolean>\n  isMagicLinkValid: () => boolean\n}\n\nexport type IUseMagicLinkUtilsComposable = (magicLink: string) => IUseMagicLinkUtils\n\nexport const useMagicLinkUtils: IUseMagicLinkUtilsComposable = (magicLink) => {\n  const magicLinkAction = ref<MagicLinkActionEnum>()\n  const invalidMagicLink = ref<boolean>(false)\n\n  const isMagicLinkValid = () => {\n    const searchParams = new URLSearchParams(window.location.href.split('?')[1])\n    if (searchParams.has(MagicLinkActionEnum.LOGIN)) {\n      magicLinkAction.value = MagicLinkActionEnum.LOGIN\n    } else if (searchParams.has(MagicLinkActionEnum.VERIFY)) {\n      magicLinkAction.value = MagicLinkActionEnum.VERIFY\n    }\n    if (!magicLinkAction.value || !magicLink) {\n      invalidMagicLink.value = true\n    }\n    return !invalidMagicLink.value\n  }\n\n  return {\n    magicLinkAction,\n    invalidMagicLink,\n    isMagicLinkValid,\n  }\n}\n\nexport default useMagicLinkUtils\n","import { useAppId } from '@/composables/useAppId'\nimport { Passage, PassageUserInfo } from '@passageidentity/passage-js'\n\nconst storageKey = 'psg_last_login'\n\nexport function getLastLogin(): string | null {\n  return localStorage.getItem(storageKey)\n}\n\nexport async function storeLastLogin(identiferOrUserInfo?: string | PassageUserInfo): Promise<void> {\n  if (identiferOrUserInfo && typeof identiferOrUserInfo === 'string') {\n    localStorage.setItem(storageKey, identiferOrUserInfo)\n    return\n  }\n  let currentInfo = identiferOrUserInfo as PassageUserInfo | undefined\n  if (identiferOrUserInfo === undefined) {\n    const { appId } = useAppId()\n    const passage = new Passage(appId.value)\n    currentInfo = await passage.getCurrentUser().userInfo()\n  }\n  if (currentInfo === undefined) {\n    return\n  }\n  localStorage.setItem(storageKey, currentInfo.email ? currentInfo.email : currentInfo.phone)\n}\n","import { IUseUIState } from './useUIState'\nimport { IUseMagicLinkUtils } from './useMagicLinkUtils'\nimport { IUseWebauthnUtils } from './useWebauthnUtils'\nimport { Passage, authResult, PassageError, PassageErrorCode } from '@passageidentity/passage-js'\nimport { ref, Ref } from 'vue'\nimport { useCallbacks } from '@/composables/useCallbacks'\nimport { storeLastLogin } from '@/utils/lastLogin'\n\ninterface IUseMagicLinkActivationReturn {\n  authResult: Ref<authResult>\n  onBeforeActivate: () => void\n  onActivateError: () => void\n  onActivateErrorInvalidMagicLink: () => void\n  onActivateSuccess: (props: { addDevice: boolean; result: authResult }) => Promise<void>\n  activateWithBiometrics: () => Promise<void>\n  activateWithoutBiometrics: () => Promise<void>\n}\n\ninterface IUseMagicLinkActivationProps {\n  uiState: IUseUIState\n  magicLinkUtils: IUseMagicLinkUtils\n  passage: Passage\n  magicLink: string\n  webauthnUtils: IUseWebauthnUtils\n}\ntype IUseMagicLinkActivation = (props: IUseMagicLinkActivationProps) => IUseMagicLinkActivationReturn\n\nconst useMagicLinkActivation: IUseMagicLinkActivation = ({\n  magicLink,\n  uiState,\n  magicLinkUtils,\n  passage,\n  webauthnUtils,\n}) => {\n  const authResult = ref<authResult>(null as unknown as authResult)\n\n  const onBeforeActivate = () => {\n    uiState.uiLoading({ addDevice: false })\n    authResult.value = { auth_token: '', redirect_url: '' }\n  }\n\n  const onActivateError = () => {\n    uiState.uiError()\n  }\n\n  const onActivateErrorInvalidMagicLink = () => {\n    magicLinkUtils.invalidMagicLink.value = true\n    uiState.uiError()\n  }\n\n  const onActivateSuccess = async ({ addDevice = false, result }: { addDevice: boolean; result: authResult }) => {\n    authResult.value = result\n    const userInfo = await passage.getCurrentUser().userInfo()\n    storeLastLogin(userInfo)\n    uiState.uiSuccess({ addDevice: addDevice })\n\n    await new Promise((resolve) => {\n      setTimeout(resolve, 1000)\n    })\n\n    if (authResult.value.redirect_url && !uiState.showAddDevice.value) {\n      useCallbacks().onSuccess.value(authResult.value)\n    }\n  }\n\n  const activateWithoutBiometrics = async () => {\n    onBeforeActivate()\n    try {\n      const result = await passage.magicLinkActivate(magicLink)\n      onActivateSuccess({ addDevice: webauthnUtils.webauthnAllowed.value, result })\n      //eslint-disable-next-line  @typescript-eslint/no-explicit-any\n    } catch (err: any) {\n      if (err.statusCode === PassageErrorCode.NotFound) {\n        onActivateErrorInvalidMagicLink()\n      } else {\n        onActivateError()\n      }\n    }\n  }\n  const activateWithBiometrics = async () => {\n    onBeforeActivate()\n    try {\n      const result = await passage.magicLinkActivateWebAuthnLogin(magicLink)\n      onActivateSuccess({ addDevice: false, result })\n      //eslint-disable-next-line  @typescript-eslint/no-explicit-any\n    } catch (err: any) {\n      const error = err as PassageError\n      if (error.statusCode === PassageErrorCode.NotFound) {\n        onActivateErrorInvalidMagicLink()\n      } else if (\n        error.statusCode === PassageErrorCode.PSGCredObjectDoesNotExist ||\n        error.statusCode === PassageErrorCode.Unauthorized\n      ) {\n        activateWithoutBiometrics()\n      } else {\n        onActivateError()\n      }\n    }\n  }\n\n  return {\n    authResult,\n    onBeforeActivate,\n    onActivateError,\n    onActivateErrorInvalidMagicLink,\n    onActivateSuccess,\n    activateWithoutBiometrics,\n    activateWithBiometrics,\n  }\n}\n\nexport default useMagicLinkActivation\n","<template>\n  <div class=\"auth-flex-container\" v-show=\"!pageLoading && !showAddDevice\">\n    <div class=\"title has-text-centered\" :class=\"[showSuccess ? 'main-title' : 'secondary-title']\">\n      {{ showFailure ? (invalidMagicLink ? t('invalid-link') : t('device-login-failed-title')) : title }}\n    </div>\n\n    <figure class=\"image has-text-centered\">\n      <inline-svg v-if=\"showSuccess && webauthnAllowed\" :src=\"Icons.fingerprintSuccess\" alt=\"Device success\" />\n      <inline-svg v-else-if=\"showSuccess && !webauthnAllowed\" :src=\"Icons.emailSuccess\" alt=\"Magic link success\" />\n      <inline-svg\n        v-else-if=\"showFailure && magicLinkAction === MagicLinkActionEnum.VERIFY\"\n        :src=\"Icons.emailFailed\"\n        alt=\"Magic link failure\"\n      />\n      <inline-svg v-else-if=\"showFailure && invalidMagicLink\" :src=\"Icons.emailFailed\" alt=\"Magic link failure\" />\n      <inline-svg v-else-if=\"showFailure && webauthnAllowed\" :src=\"Icons.fingerprintFailed\" alt=\"Device failure\" />\n      <platform-icon v-else-if=\"webauthnAllowed\" />\n    </figure>\n\n    <div class=\"content has-text-centered\" data-test=\"activate-magic-link-message\">\n      <!-- Successful Magic Link Activation or Verification -->\n      <div v-if=\"showSuccess && magicLinkAction === MagicLinkActionEnum.LOGIN\">\n        {{ t('successfully-logged-in-redirect') }}\n      </div>\n\n      <div v-else-if=\"showSuccess && magicLinkAction === MagicLinkActionEnum.VERIFY\">\n        {{ t('successfully-changed-email') }}\n      </div>\n\n      <!-- Magic Link Login or Magic Link Verify link is invalid -->\n      <div v-else-if=\"showFailure && invalidMagicLink && magicLinkAction === MagicLinkActionEnum.VERIFY\">\n        {{ t('link-invalid') }}\n      </div>\n      <div v-else-if=\"showFailure && invalidMagicLink\">{{ t('login-link-invalid') }}</div>\n\n      <!-- Magic Link Activation Failed -->\n      <div v-else-if=\"showFailure && magicLinkAction === MagicLinkActionEnum.VERIFY\">\n        {{ t('verification-failed-please-try-again') }}\n      </div>\n      <div v-else-if=\"showFailure\">{{ t('device-login-failed') }}</div>\n\n      <!-- Prompt User To Login Or Verify Via Webauthn -->\n      <div v-else-if=\"webauthnAllowed && magicLinkAction === MagicLinkActionEnum.LOGIN\">\n        {{ t('log-in-to-proceed') }}\n      </div>\n      <div v-else-if=\"webauthnAllowed && magicLinkAction === MagicLinkActionEnum.VERIFY\">\n        {{ t('verify-your-identity-with-device') }}\n      </div>\n\n      <div v-else-if=\"webauthnAllowed\">\n        {{ t('log-into-your-account-extended') }}\n      </div>\n    </div>\n\n    <!-- On Safari, we may need text here so the user knows they need to click because of their browser -->\n    <!-- If this is true, show the button -->\n    <div\n      class=\"flex-row flex-center\"\n      v-if=\"userGestureRequired || showFailure || showSuccess\"\n      style=\"padding: 20px 0px\"\n    >\n      <button\n        @click.prevent=\"onButtonClick\"\n        type=\"button\"\n        class=\"button is-primary\"\n        part=\"button\"\n        :class=\"{ 'is-loading': loading, 'small': showFailure && invalidMagicLink }\"\n        :disabled=\"loading\"\n        data-test=\"activate-magic-link-button\"\n      >\n        <span v-if=\"showFailure && invalidMagicLink\">{{ t('request-new-link') }}</span>\n        <span v-else-if=\"showFailure\">{{ t('try-again') }}</span>\n        <span v-else-if=\"showSuccess\">{{ t('redirect-now') }}</span>\n        <span v-else>{{ t('login-with-device') }}</span>\n      </button>\n    </div>\n  </div>\n  <div\n    class=\"auth-flex-container\"\n    v-if=\"!pageLoading && showAddDevice\"\n    :style=\"showFailure ? 'justify-content: space-between' : ''\"\n  >\n    <AddDevice :auth-result=\"activation.authResult.value\" />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, onMounted } from 'vue'\nimport { Passage } from '@passageidentity/passage-js'\nimport { useAppId } from '@/composables/useAppId'\nimport { useCallbacks, OnEventType } from '@/composables/useCallbacks'\nimport AddDevice from './components/AddDevice.vue'\nimport useUIState from './composables/useUIState'\nimport useWebauthnUtils from './composables/useWebauthnUtils'\nimport useMagicLinkUtils, { MagicLinkActionEnum } from './composables/useMagicLinkUtils'\nimport useMagicLinkActivation from './composables/useMagicLinkActivation'\nimport { Icons } from '@/utils/Icons'\nimport InlineSvg from 'vue-inline-svg'\nimport PlatformIcon from '@/components/PlatformIcon/PlatformIcon.vue'\nimport { useLocale } from '@/composables/useLocale'\n\nexport default defineComponent({\n  name: 'ActivateMagicLink',\n  props: {\n    magicLink: {\n      type: String,\n      required: true,\n    },\n  },\n  components: {\n    AddDevice,\n    InlineSvg,\n    PlatformIcon,\n  },\n  setup(props) {\n    const { t } = useLocale()\n    const { appId } = useAppId()\n    const passage = new Passage(appId.value)\n    const uiState = useUIState()\n    const webauthnUtils = useWebauthnUtils(passage)\n    const magicLinkUtils = useMagicLinkUtils(props.magicLink)\n    const activation = useMagicLinkActivation({\n      uiState,\n      webauthnUtils,\n      magicLinkUtils,\n      passage,\n      magicLink: props.magicLink,\n    })\n\n    function onButtonClick() {\n      if (magicLinkUtils.invalidMagicLink.value) {\n        // need to eliminate the `psg_magic_link` url param before redirecting to EmailInputView\n        window.location.href = window.location.href.split('?')[0]\n      } else {\n        if (webauthnUtils.deviceRecognized.value) {\n          activation.activateWithBiometrics()\n        } else {\n          activation.activateWithoutBiometrics()\n        }\n      }\n    }\n\n    function redirectNow() {\n      if (activation.authResult.value?.redirect_url) {\n        useCallbacks().onSuccess.value(activation.authResult.value)\n      }\n    }\n\n    onMounted(async () => {\n      if (magicLinkUtils.isMagicLinkValid()) {\n        await webauthnUtils.checkWebauthnAndDeviceRecognized(props.magicLink)\n\n        const shouldAutoActivate =\n          !webauthnUtils.deviceRecognized.value ||\n          !webauthnUtils.webauthnAllowed.value ||\n          (!webauthnUtils.userGestureRequired && webauthnUtils.deviceRecognized.value)\n\n        const shouldAutoActivateWithBio = !webauthnUtils.userGestureRequired && webauthnUtils.deviceRecognized.value\n\n        if (shouldAutoActivate) {\n          shouldAutoActivateWithBio ? activation.activateWithBiometrics() : activation.activateWithoutBiometrics()\n        }\n\n        useCallbacks().onEvent.value(OnEventType.onMagicLinkActivateSuccess)\n      } else {\n        uiState.uiError()\n      }\n      uiState.pageLoading.value = false\n    })\n\n    return {\n      ...uiState,\n      ...webauthnUtils,\n      ...magicLinkUtils,\n      activation,\n      MagicLinkActionEnum,\n      onButtonClick,\n      redirectNow,\n      Icons,\n      t,\n    }\n  },\n})\n</script>\n","<template>\n  <div class=\"view-verify-token\">\n    <activate-magic-link :magicLink=\"magicLink\" />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport ActivateMagicLink from '../components/ActivateMagicLink/ActivateMagicLink.vue'\n\nexport default defineComponent({\n  name: 'ActivateMagicLinkView',\n  props: {\n    magicLink: {\n      type: String,\n      required: true,\n    },\n  },\n  components: {\n    ActivateMagicLink,\n  },\n})\n</script>\n","import { ActivateMagicLinkRoute } from '@/PassageAuth/router/routes'\nimport { onMounted } from 'vue'\nimport { useRouter } from './useRouter'\n\nexport function useMagicLink(): void {\n  const { router } = useRouter()\n  onMounted(() => {\n    const queryString = window.location.search\n    const urlParams = new URLSearchParams(queryString)\n\n    // check to see if URL is psg_magic_link or psg_verify_link\n    let magicLink = null\n    if (urlParams.has('psg_magic_link')) {\n      magicLink = urlParams.get('psg_magic_link')\n    } else if (urlParams.has('psg_verify_link')) {\n      magicLink = urlParams.get('psg_verify_link')\n    }\n\n    if (magicLink !== null) {\n      router.push(ActivateMagicLinkRoute, { magicLink: magicLink })\n    }\n  })\n}\n","import { PassageUserStatus } from '@passageidentity/passage-js'\nexport { Identifier as IdentifierMode } from '@passageidentity/passage-js'\nexport interface IValidatedEmailEvent {\n  identifier: string\n  identifierExists: boolean\n  identifierType: IdentifierType\n  userHasWebauthn: boolean\n  userStatus: PassageUserStatus\n  userID: string\n  emailVerified: boolean\n  phoneVerified: boolean\n  userHasPasskey: boolean\n}\n\nexport enum IdentifierType {\n  phone = 'PHONE',\n  email = 'EMAIL',\n}\n","<template>\n  <form @submit.prevent=\"checkIdentifier\">\n    <div class=\"has-text-centered\" v-show=\"showWelcomeBack\">\n      {{ t('welcome-back-sign-in-as') }}<br /><strong>{{ identifierText }}</strong>\n    </div>\n    <div v-show=\"!showWelcomeBack\">\n      <div class=\"label\" ref=\"labelRef\">{{ label }}</div>\n      <input\n        v-model=\"identifierText\"\n        type=\"text\"\n        class=\"input\"\n        part=\"input\"\n        :class=\"{ 'is-danger': error }\"\n        :autocomplete=\"inputMode\"\n        :inputmode=\"inputMode\"\n        id=\"identifier\"\n        :placeholder=\"placeholder\"\n        @input.prevent=\"clearErrors\"\n        ref=\"identifierInput\"\n        data-test=\"identifier-input\"\n      />\n    </div>\n    <div ref=\"controlContainer\" style=\"width: 100%\"></div>\n    <div\n      :style=\"`text-align: ${showWelcomeUI ? 'center' : 'left'};`\"\n      class=\"help is-danger error-message\"\n      data-test=\"validation-error\"\n    >\n      {{ error }}\n    </div>\n    <slot></slot>\n    <div class=\"flex-row flex-center\">\n      <button type=\"submit\" class=\"button is-primary\" part=\"button\" data-test=\"continue-button\" ref=\"autofocusButton\">\n        {{ t('continue') }}\n      </button>\n    </div>\n    <div v-if=\"showWelcomeUI\" style=\"margin-top: 30px\" class=\"link has-text-centered\">\n      <a @click.prevent=\"switchAccount\" role=\"button\" data-test=\"register-link\">{{ t('switch-account') }}</a>\n    </div>\n  </form>\n</template>\n\n<script lang=\"ts\">\nimport { Passage, PassageUserStatus, WebAuthnType } from '@passageidentity/passage-js'\nimport { computed, defineComponent, HTMLAttributes, onMounted, ref, watch } from 'vue'\nimport { isStringNullish } from '@/utils/stringUtils'\nimport { IdentifierMode, IdentifierType } from './IntentifierTypes'\nimport intlTelInput from 'intl-tel-input'\nimport { useLocale } from '@/composables/useLocale'\nimport { useAutofocusButton } from '@/composables/useAutofocusButton'\n\nexport default defineComponent({\n  name: 'ValidatedIdentiferForm',\n  emits: ['onSubmit', 'update:validationError', 'update:identifier', 'update:countryCode', 'update:showWelcomeBack'],\n  props: {\n    appId: {\n      type: String,\n      required: true,\n    },\n    validationError: {\n      type: String,\n      default: '',\n    },\n    identifier: {\n      type: String,\n      required: true,\n    },\n    countryCode: {\n      type: String,\n      required: true,\n    },\n    identifierMode: {\n      type: String as () => IdentifierMode,\n      required: true,\n    },\n    showWelcomeBack: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  setup(props, context) {\n    const { t } = useLocale()\n    const identifierParseError = ref<string>('')\n    const identifierInput = ref()\n    const controlContainer = ref()\n    const { autofocusButton } = useAutofocusButton()\n\n    const showWelcomeUI = computed<boolean>(() => {\n      return props.showWelcomeBack\n    })\n\n    const label = computed<string>(() => {\n      let identifierType\n      switch (props.identifierMode) {\n        case IdentifierMode.phone:\n          identifierType = t('phone-number')\n          break\n        case IdentifierMode.email:\n          identifierType = t('email-address')\n          break\n        case IdentifierMode.both:\n          identifierType = t('email-or-phone-number')\n          break\n      }\n      return identifierType.charAt(0).toUpperCase() + identifierType.slice(1)\n    })\n\n    const placeholder = computed<string>(() => {\n      return 'example@email.com'\n    })\n\n    const inputMode = computed<HTMLAttributes['inputmode']>(() => {\n      if (props.identifierMode === IdentifierMode.phone) {\n        return 'tel'\n      }\n      return 'email'\n    })\n\n    const identifierText = computed<string>({\n      get(): string {\n        return props.identifier\n      },\n      set(newIdentifier): void {\n        context.emit('update:identifier', newIdentifier)\n      },\n    })\n\n    function formattedIdentifier(): string {\n      if (!identifierText.value) {\n        return ''\n      }\n      // the null assertion is safe because isPhoneNumber already checks if phoneInput is undefined\n      let identifier = identifierText.value\n      // if the welcome UI is shown we just want the value of identifierText since intl-tel-input will be null\n      if (!showWelcomeUI.value) {\n        identifier = isPhoneNumber() ? phoneInput?.getNumber() ?? '' : identifierText.value\n      }\n      return identifier.trim().toLowerCase()\n    }\n\n    const error = computed<string>(() => {\n      if (!isStringNullish(props.validationError)) {\n        return props.validationError\n      }\n      if (!isStringNullish(identifierParseError.value)) {\n        return identifierParseError.value\n      }\n      return ''\n    })\n\n    function clearErrors() {\n      identifierParseError.value = ''\n      context.emit('update:validationError', '')\n    }\n\n    async function checkIdentifier() {\n      if (!validateInput()) {\n        return\n      }\n\n      const passage = new Passage(props.appId)\n      let identifierExists,\n        userHasWebauthn,\n        userHasPasskey,\n        emailVerified,\n        phoneVerified = false\n      let userStatus\n      let userID = ''\n      try {\n        const userInfo = await passage.identifierExists(formattedIdentifier())\n        if (userInfo !== null) {\n          identifierExists = true\n          userHasWebauthn = userInfo.webauthn\n          userStatus = userInfo.status\n          userID = userInfo.id\n          emailVerified = userInfo.email_verified\n          phoneVerified = userInfo.phone_verified\n          userHasPasskey = userInfo.webauthn_types.includes(WebAuthnType.Passkey)\n        } else {\n          identifierExists = false\n          userHasWebauthn = false\n          userStatus = PassageUserStatus.INACTIVE\n        }\n      } catch (e) {\n        let errorMessage\n        switch (props.identifierMode) {\n          case IdentifierMode.email:\n            errorMessage = t('enter-a-valid-email-address')\n            break\n          case IdentifierMode.phone:\n            errorMessage = t('enter-a-valid-phone-number')\n            break\n          case IdentifierMode.both:\n            errorMessage = t('enter-a-valid-email-or-phone-number')\n            break\n        }\n        identifierParseError.value = errorMessage\n        return\n      }\n      context.emit('onSubmit', {\n        identifier: formattedIdentifier(),\n        identifierExists: identifierExists,\n        identifierType: isPhoneNumber() ? IdentifierType.phone : IdentifierType.email,\n        userHasWebauthn: userHasWebauthn,\n        userStatus: userStatus,\n        userID: userID,\n        emailVerified: emailVerified,\n        phoneVerified: phoneVerified,\n        userHasPasskey,\n      })\n    }\n\n    function isEmail(): boolean {\n      // There are a ton of Regular expressions for email validation. I picked this one, but this should be thoroughly tested.\n      const emailRegEx =\n        /^(([^<>()[\\]\\\\.,;:\\s@\"]+(\\.[^<>()[\\]\\\\.,;:\\s@\"]+)*)|(\".+\"))@((\\[[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\.[0-9]{1,3}\\])|(([a-zA-Z\\-0-9]+\\.)+[a-zA-Z]{2,}))$/\n      return emailRegEx.test(formattedIdentifier())\n    }\n\n    function isPhoneNumber(): boolean {\n      if (showWelcomeUI.value) {\n        return isPhoneNumberRegex()\n      }\n      if (phoneInput === undefined) {\n        return false\n      }\n      return phoneInput.isValidNumber()\n    }\n\n    function validateInput(): boolean {\n      if (formattedIdentifier() === '') {\n        let message = ''\n        switch (props.identifierMode) {\n          case IdentifierMode.phone:\n            message = t('enter-a-phone-number')\n            break\n          case IdentifierMode.email:\n            message = t('enter-an-email-address')\n            break\n          case IdentifierMode.both:\n            message = t('enter-an-email-or-phone-number')\n            break\n        }\n        identifierParseError.value = message\n        return false\n      } else if (props.identifierMode === IdentifierMode.email && !isEmail()) {\n        identifierParseError.value = t('enter-a-valid-email-address')\n        return false\n      } else if (props.identifierMode === IdentifierMode.phone && !isPhoneNumber()) {\n        identifierParseError.value = t('enter-a-valid-phone-number')\n        return false\n      } else if (props.identifierMode === IdentifierMode.both && !isPhoneNumber() && !isEmail()) {\n        identifierParseError.value = t('enter-a-valid-email-or-phone-number')\n        return false\n      }\n      return true\n    }\n\n    let phoneInput: intlTelInput.Plugin | undefined\n    function showCountryCode() {\n      if (phoneInput !== undefined) {\n        return\n      }\n      // we need the country code shared between login and register boxes so we emit it back up to the prop\n      // this also has the effect of storing the country code when the box is destroyed\n      ;(identifierInput.value as HTMLElement).addEventListener('countrychange', () => {\n        context.emit('update:countryCode', phoneInput?.getSelectedCountryData().iso2 ?? '')\n      })\n      phoneInput = intlTelInput(identifierInput.value, {\n        initialCountry: props.countryCode,\n        utilsScript: 'https://cdnjs.cloudflare.com/ajax/libs/intl-tel-input/17.0.8/js/utils.js',\n        dropdownContainer: controlContainer.value,\n        autoPlaceholder: 'aggressive',\n      })\n      identifierInput.value.focus()\n    }\n\n    function hideCountryCode() {\n      if (phoneInput === undefined) {\n        return\n      }\n      phoneInput.destroy()\n      phoneInput = undefined\n      if (identifierInput.value) {\n        identifierInput.value.focus()\n      }\n    }\n\n    function moveInput() {\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      const parent = ((identifierInput.value as HTMLElement).getRootNode() as any).host as HTMLElement\n      parent.appendChild(identifierInput.value)\n    }\n\n    const labelRef = ref<HTMLElement>()\n\n    function moveBack() {\n      labelRef.value?.append(identifierInput.value)\n    }\n\n    onMounted(() => {\n      if (props.identifierMode === IdentifierMode.phone) {\n        showCountryCode()\n      }\n    })\n\n    // a simpler phone number check that supports partially correct phone numbers\n    // only used to handle the toggling of showing & hiding the country code selector\n    function isPhoneNumberRegex(): boolean {\n      const phoneNumberRegex = /^\\+$|^\\+?[0-9,(,),\\-, ]+$/\n      return phoneNumberRegex.test(identifierText.value.trim())\n    }\n\n    // we only need to switch showing country code if we're in both mode\n    if (props.identifierMode === IdentifierMode.both) {\n      watch(identifierText, () => {\n        if (isPhoneNumberRegex()) {\n          showCountryCode()\n        } else {\n          hideCountryCode()\n        }\n      })\n    }\n\n    // if we recieve a new value for the prop it needs to be manually applied to the\n    // country code selector\n    const countryCodeText = computed<string>(() => {\n      return props.countryCode\n    })\n    watch(countryCodeText, (newValue) => {\n      phoneInput?.setCountry(newValue)\n    })\n\n    function switchAccount() {\n      context.emit('update:showWelcomeBack', false)\n      identifierText.value = ''\n    }\n\n    return {\n      error,\n      identifierText,\n      checkIdentifier,\n      clearErrors,\n      identifierInput,\n      controlContainer,\n      placeholder,\n      label,\n      inputMode,\n      moveInput,\n      labelRef,\n      moveBack,\n      showWelcomeUI,\n      switchAccount,\n      t,\n      autofocusButton,\n    }\n  },\n})\n</script>\n","<template>\n  <validated-identifier-form\n    :appId=\"appId\"\n    :identifierMode=\"identifierMode\"\n    v-model:showWelcomeBack=\"showWelcomeBack\"\n    v-model:identifier=\"identifierText\"\n    v-model:validationError=\"error\"\n    v-model:countryCode=\"countryCodeText\"\n    @onSubmit=\"onSubmit($event)\"\n    ref=\"inputForm\"\n  >\n  </validated-identifier-form>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, ref, PropType, watch, onMounted } from 'vue'\nimport { useMagicLink } from '@/PassageAuth/composables/useMagicLink'\nimport { useRouter } from '@/PassageAuth/composables/useRouter'\nimport ValidatedIdentifierForm from '../ValidatedIdentifierForm/ValidatedIdentifierForm.vue'\nimport { IdentifierType, IValidatedEmailEvent } from '../ValidatedIdentifierForm/IntentifierTypes'\nimport { useAppId } from '@/composables/useAppId'\nimport { WebauthnSignInRoute, MagicLinkRoute } from '@/PassageAuth/router/routes'\nimport { useCallbacks, OnEventType } from '@/composables/useCallbacks'\nimport { Identifier, Passage, PassageAppInfo, PassageUserStatus } from '@passageidentity/passage-js'\nimport { getLastLogin } from '@/utils/lastLogin'\nimport { useLocale } from '@/composables/useLocale'\n\nexport default defineComponent({\n  name: 'Login',\n  components: {\n    ValidatedIdentifierForm,\n  },\n  props: {\n    canToggleLoginRegister: Boolean,\n    identifier: {\n      type: String,\n      required: true,\n    },\n    countryCode: {\n      type: String,\n      required: true,\n    },\n    appInfo: {\n      type: Object as PropType<PassageAppInfo>,\n      required: true,\n    },\n    webauthnAllowed: {\n      type: Boolean,\n      required: true,\n    },\n    visible: {\n      type: Boolean,\n      default: false,\n    },\n  },\n  emits: ['update:identifier', 'update:countryCode'],\n  setup(props, context) {\n    const { router } = useRouter()\n    const { appId } = useAppId()\n    const { t } = useLocale()\n    const error = ref<string>('')\n\n    const identifierText = computed<string>({\n      get(): string {\n        return props.identifier\n      },\n      set(newIdentifier): void {\n        context.emit('update:identifier', newIdentifier)\n      },\n    })\n\n    const countryCodeText = computed<string>({\n      get(): string {\n        return props.countryCode\n      },\n      set(newCountryCode): void {\n        context.emit('update:countryCode', newCountryCode)\n      },\n    })\n    const passage = new Passage(appId.value)\n\n    const inputForm = ref<Record<string, unknown>>()\n\n    watch(inputForm, async () => {\n      useCallbacks().onEvent.value(OnEventType.onLoaded)\n    })\n\n    const identifierMode = computed<Identifier>(() => {\n      return props.appInfo.allowed_identifier ?? Identifier.email\n    })\n    useMagicLink()\n\n    async function onSubmit(event: IValidatedEmailEvent) {\n      const {\n        identifier,\n        identifierExists,\n        userHasWebauthn,\n        userHasPasskey,\n        userStatus,\n        userID,\n        identifierType,\n        emailVerified,\n        phoneVerified,\n      } = event\n\n      // if a beforeAuth() callback was defined, call it now\n      const beforeAuthResult = useCallbacks().beforeAuth.value(identifier)\n      if (!beforeAuthResult) {\n        return\n      }\n\n      const errorString = checkIdentifierExistsAndStatus(identifierExists, identifierType, userStatus)\n      if (errorString !== '') {\n        error.value = errorString\n        return\n      }\n\n      if (userNeedsToVerify(emailVerified, phoneVerified, identifierType)) {\n        router.push(MagicLinkRoute, { identifier, identifierType, identifierVerifying: true })\n      } else {\n        const browserInfo = await passage.browserInfo()\n        const tryPasskey = userHasPasskey && window.PublicKeyCredential && browserInfo.getPassKeySupported\n        if (tryPasskey) {\n          useCallbacks().onEvent.value(OnEventType.onVerifyIdentity)\n          router.push(WebauthnSignInRoute, { identifier, identifierType })\n          return\n        }\n        if (props.webauthnAllowed) {\n          if (userHasWebauthn && passage.credIDExists(userID)) {\n            useCallbacks().onEvent.value(OnEventType.onVerifyIdentity)\n            router.push(WebauthnSignInRoute, { identifier, identifierType })\n          } else {\n            // Setup new device\n            useCallbacks().onEvent.value(OnEventType.onMagicLinkLogin)\n            router.push(MagicLinkRoute, { identifier, identifierType, setupNewDevice: true })\n          }\n        } else {\n          useCallbacks().onEvent.value(OnEventType.onMagicLinkLogin)\n          router.push(MagicLinkRoute, { identifier, identifierType })\n        }\n      }\n    }\n\n    function checkIdentifierExistsAndStatus(\n      identifierExists: boolean,\n      identifierType: IdentifierType,\n      userStatus: PassageUserStatus,\n    ): string {\n      if (!identifierExists) {\n        let identiferString = identifierType === IdentifierType.email ? t('email') : t('phone')\n        identiferString = identiferString.charAt(0).toUpperCase() + identiferString.slice(1)\n        let message = t('not-recognized', [identiferString])\n        if (props.canToggleLoginRegister) {\n          message = message + '. ' + t('toggle-register')\n        }\n        return message\n      }\n      if (identifierExists && userStatus === PassageUserStatus.INACTIVE) {\n        return t('account-no-longer-active')\n      }\n      return ''\n    }\n\n    function userNeedsToVerify(\n      emailVerified: boolean,\n      phoneVerified: boolean,\n      identifierType: IdentifierType,\n    ): boolean {\n      if (props.appInfo.require_identifier_verification) {\n        if (\n          (identifierType === IdentifierType.email && !emailVerified) ||\n          (identifierType === IdentifierType.phone && !phoneVerified)\n        ) {\n          return true\n        }\n      }\n      return false\n    }\n\n    const showWelcomeBack = ref<boolean>(false)\n    onMounted(() => {\n      const lastLogin = getLastLogin()\n      if (lastLogin) {\n        identifierText.value = lastLogin\n        showWelcomeBack.value = true\n      }\n    })\n    // clear welcome back autofill when switching to register\n    watch(\n      () => props.visible,\n      () => {\n        if (showWelcomeBack.value === true) {\n          identifierText.value = ''\n        }\n        showWelcomeBack.value = false\n      },\n    )\n\n    return {\n      appId,\n      error,\n      identifierText,\n      countryCodeText,\n      onSubmit,\n      identifierMode,\n      inputForm,\n      showWelcomeBack,\n    }\n  },\n})\n</script>\n","<template>\n  <div>\n    <validated-identifier-form\n      :appId=\"appId\"\n      :identifierMode=\"identifierMode\"\n      v-model:identifier=\"identifierText\"\n      v-model:validationError=\"error\"\n      v-model:countryCode=\"countryCodeText\"\n      @onSubmit=\"onSubmit($event)\"\n    >\n      <user-metadata\n        v-if=\"appInfo && appInfo.layouts.registration.length > 0\"\n        :isEditing=\"true\"\n        :appInfo=\"appInfo\"\n        :layoutType=\"LayoutType.Registration\"\n        :userMetadata=\"metadata\"\n        ref=\"metadataComponent\"\n      />\n    </validated-identifier-form>\n    <div v-if=\"!publicSignup\" class=\"notification is-danger has-text-centered\" data-test=\"invalid-app-id\">\n      {{ t('public-registration-not-allowed') }}\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent, computed, ref, PropType } from 'vue'\nimport { useMagicLink } from '@/PassageAuth/composables/useMagicLink'\nimport { useAppId } from '@/composables/useAppId'\nimport { useRouter } from '@/PassageAuth/composables/useRouter'\nimport ValidatedIdentifierForm from '../ValidatedIdentifierForm/ValidatedIdentifierForm.vue'\nimport { IdentifierType, IValidatedEmailEvent } from '../ValidatedIdentifierForm/IntentifierTypes'\nimport { MagicLinkRoute, RegisterDeviceRoute } from '@/PassageAuth/router/routes'\nimport { useCallbacks, OnEventType } from '@/composables/useCallbacks'\nimport {\n  Identifier,\n  Metadata,\n  Passage,\n  PassageAppInfo,\n  PassageError,\n  PassageUserStatus,\n} from '@passageidentity/passage-js'\nimport UserMetadata, { LayoutType } from '@/components/UserMetadata/UserMetadata.vue'\nimport { transformMetadata } from '@/PassageProfile/composables/useUpdateUser'\nimport { useLocale } from '@/composables/useLocale'\n\nexport default defineComponent({\n  name: 'Register',\n  props: {\n    canToggleLoginRegister: Boolean,\n    identifier: {\n      type: String,\n      required: true,\n    },\n    countryCode: {\n      type: String,\n      required: true,\n    },\n    appInfo: {\n      type: Object as PropType<PassageAppInfo>,\n      required: true,\n    },\n    webauthnAllowed: {\n      type: Boolean,\n      required: true,\n    },\n  },\n  emits: ['update:identifier', 'update:countryCode'],\n  components: {\n    ValidatedIdentifierForm,\n    UserMetadata,\n  },\n  setup(props, context) {\n    const { t } = useLocale()\n    const { router } = useRouter()\n    const { appId } = useAppId()\n    const error = ref<string>('')\n\n    const identifierText = computed<string>({\n      get(): string {\n        return props.identifier\n      },\n      set(newIdentifier): void {\n        context.emit('update:identifier', newIdentifier)\n      },\n    })\n\n    const countryCodeText = computed<string>({\n      get(): string {\n        return props.countryCode\n      },\n      set(newCountryCode): void {\n        context.emit('update:countryCode', newCountryCode)\n      },\n    })\n\n    const publicSignup = computed<boolean>(() => {\n      return props.appInfo.public_signup\n    })\n\n    const identifierMode = computed<Identifier>(() => {\n      return props.appInfo.allowed_identifier\n    })\n    useMagicLink()\n\n    async function onSubmit(event: IValidatedEmailEvent) {\n      const { identifier, identifierExists, userStatus, identifierType } = event\n\n      // if a beforeAuth() callback was defined, call it now\n      const beforeAuthResult = useCallbacks().beforeAuth.value(identifier)\n      if (!beforeAuthResult) {\n        return\n      }\n      let validMetadata = true\n      if (metadataComponent.value) {\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n        validMetadata = (metadataComponent.value as any).validate()\n      }\n\n      if (identifierExists) {\n        if (userStatus === PassageUserStatus.ACTIVE) {\n          let message = t('account-already-exists', [\n            identifierType === IdentifierType.email ? t('email') : t('phone-number'),\n          ])\n          if (props.canToggleLoginRegister) {\n            message = message + t('toggle-login')\n          }\n          error.value = message\n          return\n        } else if (userStatus === PassageUserStatus.INACTIVE) {\n          error.value = t('account-no-longer-active')\n          return\n        }\n      }\n\n      const passage = new Passage(appId.value)\n      if (!validMetadata) {\n        return\n      }\n      try {\n        await passage.createUser({\n          identifier,\n          user_metadata: transformMetadata(metadata.value, props.appInfo.user_metadata_schema, true),\n        })\n      } catch (err) {\n        if (err instanceof PassageError && err.message.startsWith('Public signup')) {\n          error.value = err.message\n        } else {\n          error.value = t('unexpected-error')\n        }\n\n        return\n      }\n\n      if (props.appInfo.require_identifier_verification) {\n        router.push(MagicLinkRoute, { identifier, identifierType, userIsRegistering: true, identifierVerifying: true })\n      } else {\n        if (props.webauthnAllowed) {\n          useCallbacks().onEvent.value(OnEventType.onRegisterDevice, { identifier })\n          router.push(RegisterDeviceRoute, { identifier, identifierType })\n        } else {\n          useCallbacks().onEvent.value(OnEventType.onMagicLinkRegister, { identifier })\n          router.push(MagicLinkRoute, { identifier, identifierType, userIsRegistering: true })\n        }\n      }\n    }\n\n    const metadata = ref<Metadata>({})\n    const metadataComponent = ref()\n\n    return {\n      appId,\n      error,\n      identifierText,\n      countryCodeText,\n      onSubmit,\n      identifierMode,\n      metadata,\n      metadataComponent,\n      LayoutType,\n      publicSignup,\n      t,\n    }\n  },\n})\n</script>\n","export const ephemeralAppIdKey = 'psg_ephemeral_app_id'\nexport const ephemeralAppNameKey = 'psg_ephemeral_app_name'\n\nexport class EphemeralAppService {\n  // eslint-disable-next-line @typescript-eslint/no-explicit-any\n  async newEphemeralApp(): Promise<any> {\n    const ephemeralAppUrl: string = process.env.VUE_APP_ROOT_API + '/v1/apps/'\n    const response = await fetch(ephemeralAppUrl, {\n      method: 'POST',\n      body: JSON.stringify({\n        auth_origin: window.location.origin,\n        name: 'Ephemeral Random ' + (Math.random() * 1000000).toString(),\n      }),\n    })\n    const responseBody = await response.json()\n    if (response.status !== 200) {\n      throw responseBody.message\n    }\n\n    localStorage.setItem(ephemeralAppIdKey, responseBody.app.id)\n    localStorage.setItem(ephemeralAppNameKey, responseBody.app.name)\n\n    return responseBody\n  }\n}\n","<template>\n  <div v-if=\"isEphemeral\">\n    <div v-if=\"error\" class=\"notification is-danger\">\n      {{ t('unable-to-create-test-app') }}\n    </div>\n    <div v-else class=\"notification ephemeral-box\" data-test=\"ephemeral-app-message\">\n      <div v-if=\"!claimed\">\n        {{ t('currently-using-test-app') }}\n        <a :href=\"ephemeralClaimUrl\" target=\"_blank\">{{ t('click-here') }}</a\n        >.<!-- eslint-disable-line @intlify/vue-i18n/no-raw-text-->\n      </div>\n      <div v-else>{{ t('add-your-claimed-app-like-this') }} <br />{{ exampleTag }}</div>\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, ref, onBeforeMount } from 'vue'\nimport { Passage } from '@passageidentity/passage-js'\nimport { EphemeralAppService, ephemeralAppIdKey, ephemeralAppNameKey } from '@/services/EphemeralAppService'\nimport { useAppId } from '@/composables/useAppId'\nimport { useLocale } from '@/composables/useLocale'\nexport default defineComponent({\n  name: 'EphemeralAppInfo',\n  setup() {\n    const consoleUrl = process.env.VUE_APP_CONSOLE_URL || ''\n\n    const { t } = useLocale()\n\n    const error = ref<boolean>(false)\n    const isEphemeral = ref<boolean>(false)\n    const claimed = ref<boolean>(false)\n    const ephemeralClaimUrl = ref<string>('')\n    const exampleTag = ref<string>('')\n\n    const passageWebSetup = async (): Promise<void> => {\n      const { appIdUnassigned, updateAppId } = useAppId()\n      if (appIdUnassigned.value) {\n        isEphemeral.value = true\n        const ephemeralAppId: string | null = localStorage.getItem(ephemeralAppIdKey)\n        const ephemeralAppName: string | null = localStorage.getItem(ephemeralAppNameKey)\n        // If ephemeral app exists in localStorage\n        if (ephemeralAppId) {\n          const nameParam = ephemeralAppName ? `?name=${encodeURIComponent(ephemeralAppName)}` : ''\n          ephemeralClaimUrl.value = `${consoleUrl}/claim/${ephemeralAppId}${nameParam}`\n          updateAppId(ephemeralAppId)\n          logToConsole()\n        }\n        // Create new ephemeral app\n        else {\n          try {\n            const ephemeralService = new EphemeralAppService()\n            const res = await ephemeralService.newEphemeralApp()\n            updateAppId(res.app.id)\n            const nameParam = res.app.name ? `?name=${encodeURIComponent(res.app.name)}` : ''\n            ephemeralClaimUrl.value = `${consoleUrl}/claim/${res.app.id}${nameParam}`\n            logToConsole()\n          } catch (err) {\n            error.value = true\n            updateAppId('')\n          }\n        }\n      }\n    }\n\n    const checkIfClaimed = async (): Promise<void> => {\n      const { appId } = useAppId()\n      if (!isEphemeral.value) {\n        return\n      }\n      const passage = new Passage(appId.value)\n      try {\n        const res = await passage.appInfo()\n        if (!res.ephemeral) {\n          claimed.value = true\n          exampleTag.value = `<passage-auth app-id=\"${appId.value}\"/>`\n        }\n      } catch {\n        error.value = true\n      }\n    }\n\n    function logToConsole() {\n      const { appId } = useAppId()\n      console.info(`Passage Test App ID: ${appId.value}`)\n      console.info(`Claim your app: ${ephemeralClaimUrl.value}`)\n    }\n\n    onBeforeMount(async () => {\n      await passageWebSetup()\n      await checkIfClaimed()\n    })\n\n    return {\n      error,\n      isEphemeral,\n      claimed,\n      ephemeralClaimUrl,\n      exampleTag,\n      t,\n    }\n  },\n})\n</script>\n","<template>\n  <div class=\"passage-tooltip\" :class=\"`${position} ${cssVisible ? 'show-tooltip' : ''}`\" ref=\"parentItem\">\n    <div\n      v-if=\"active\"\n      v-show=\"domVisible\"\n      class=\"passage-tooltip-body\"\n      :class=\"position\"\n      :style=\"`max-width: ${width}px; ${maxHeight} ${absoluteHeight}`\"\n      @mouseenter.stop=\"clickMode ? () => {} : cancelHide()\"\n      @mouseleave.stop=\"clickMode ? () => {} : hide()\"\n      ref=\"tooltipBody\"\n    >\n      <div v-if=\"title || clickMode\" class=\"tooltip-header\">\n        <div>{{ title }}</div>\n        <inline-svg v-if=\"clickMode\" :src=\"Icons.close\" style=\"cursor: pointer\" @click.stop=\"hide\" />\n      </div>\n      <div class=\"tooltip-content\">\n        <slot name=\"tooltipBody\">{{ label }}</slot>\n      </div>\n    </div>\n    <div\n      style=\"cursor: pointer; user-select: none\"\n      @mouseenter.prevent=\"clickMode ? () => {} : show()\"\n      @mouseleave.prevent=\"clickMode ? () => {} : hide()\"\n      @click.stop=\"handleClick\"\n    >\n      <slot></slot>\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, onMounted, PropType, ref } from 'vue'\nimport InlineSvg from 'vue-inline-svg'\nimport { Icons } from '@/utils/Icons'\n\nexport enum TooltipPosition {\n  isTop = 'is-top',\n  isBottom = 'is-bottom',\n  isLeft = 'is-left',\n  isRight = 'is-right',\n}\n\nexport default defineComponent({\n  name: 'Tooltip',\n  components: {\n    InlineSvg,\n  },\n  props: {\n    label: String,\n    active: {\n      type: Boolean,\n      default: true,\n    },\n    sticky: {\n      type: Boolean,\n      default: false,\n    },\n    position: {\n      type: String as PropType<TooltipPosition>,\n      default: TooltipPosition.isTop,\n    },\n    clickMode: {\n      type: Boolean,\n      default: false,\n    },\n    title: {\n      type: String,\n      default: '',\n    },\n  },\n  setup(props) {\n    const parentItem = ref()\n    const tooltipBody = ref<HTMLElement>()\n    const width = ref<number>(0)\n    const maxHeight = ref<string>('')\n    const absoluteHeight = ref<string>('')\n    const cssVisible = ref<boolean>(props.sticky)\n    const domVisible = ref<boolean>(props.sticky)\n\n    function calculateTooltipSize(): void {\n      const absoluteMaxWidth = 500\n      if (parentItem.value === undefined || parentItem.value === null) {\n        return\n      }\n      const parentItemDiv = parentItem.value as HTMLElement\n      const viewport = (parentItemDiv.getRootNode() as ShadowRoot).getElementById('passage-auth-container')\n      if (viewport === null) {\n        return\n      }\n      const { left: viewLeft, right: viewRight } = viewport.getBoundingClientRect()\n      const { left: itemLeft, right: itemRight, top: itemTop } = parentItemDiv.getBoundingClientRect()\n      const itemMidpoint = (itemRight - itemLeft) / 2 + itemLeft\n      const spaceLeft = itemMidpoint - viewLeft - 20\n      const spaceRight = viewRight - itemMidpoint - 20\n      let viewportSafeWidth\n      const viewportSafeHeight = itemTop - 20\n      switch (props.position) {\n        case TooltipPosition.isTop:\n        case TooltipPosition.isBottom:\n          viewportSafeWidth = viewRight - viewLeft - 20\n          break\n        case TooltipPosition.isLeft:\n          viewportSafeWidth = spaceLeft\n          break\n        case TooltipPosition.isRight:\n          viewportSafeWidth = spaceRight\n          break\n      }\n      maxHeight.value = `max-height: ${viewportSafeHeight}px;`\n      width.value = Math.min(viewportSafeWidth, absoluteMaxWidth)\n    }\n\n    function calculateScrollHeight() {\n      const parentItemDiv = parentItem.value as HTMLElement\n      const { top: itemTop } = parentItemDiv.getBoundingClientRect()\n      const contentHeight = tooltipBody.value?.scrollHeight || 0\n      const viewportSafeHeight = itemTop - 20\n      if (contentHeight > viewportSafeHeight) {\n        absoluteHeight.value = `height: ${viewportSafeHeight}px;`\n      }\n    }\n\n    function show(): void {\n      if (props.sticky) {\n        return\n      }\n      clearTimeout(hideTimeout)\n      clearTimeout(innerTimeout)\n      domVisible.value = true\n      calculateTooltipSize()\n      setTimeout(() => {\n        cssVisible.value = true\n        calculateScrollHeight()\n      }, 100)\n    }\n\n    let hideTimeout: NodeJS.Timeout\n    let innerTimeout: NodeJS.Timeout\n    function hide(): void {\n      if (props.sticky) {\n        return\n      }\n      hideTimeout = setTimeout(() => {\n        cssVisible.value = false\n        innerTimeout = setTimeout(() => {\n          domVisible.value = false\n        }, 150)\n      }, 100)\n    }\n\n    function cancelHide(): void {\n      clearTimeout(hideTimeout)\n      clearTimeout(innerTimeout)\n    }\n\n    function handleClick(): void {\n      if (domVisible.value) {\n        hide()\n      } else {\n        show()\n      }\n    }\n\n    onMounted(() => {\n      calculateTooltipSize()\n    })\n\n    return {\n      parentItem,\n      width,\n      maxHeight,\n      absoluteHeight,\n      cssVisible,\n      domVisible,\n      show,\n      hide,\n      cancelHide,\n      handleClick,\n      Icons,\n      tooltipBody,\n    }\n  },\n})\n</script>\n","<template>\n  <div style=\"border-top: 1px solid #dddddd; margin-top: 20px; padding-top: 15px\">\n    <tooltip :title=\"t('where-is-the-password-field')\" :position=\"TooltipPosition.isTop\" clickMode>\n      <template #tooltipBody>\n        <div style=\"text-align: left\">\n          {{ t('helper-footer-line-1', [appInfo?.name ?? '']) }}\n          <ul>\n            <li>\n              {{ t('helper-footer-bullet-0') }}\n            </li>\n            <li>{{ t('helper-footer-bullet-1') }}</li>\n            <li>\n              {{ t('helper-footer-bullet-2', [allowedIdentifier]) }}\n            </li>\n          </ul>\n          <div style=\"margin-top: 10px\">{{ t('helper-footer-line-2', [allowedIdentifier]) }}</div>\n        </div>\n      </template>\n      <div class=\"flex-row flex-center\">\n        <span style=\"opacity: 0.5\" class=\"link\">{{ t('where-is-the-password-field') }}</span\n        ><inline-svg style=\"margin-left: 10px\" :src=\"Icons.help\" />\n      </div>\n    </tooltip>\n  </div>\n</template>\n<script setup lang=\"ts\">\nimport Tooltip, { TooltipPosition } from '@/ui-components/Tooltip.vue'\nimport { PassageAppInfo, Identifier } from '@passageidentity/passage-js'\nimport { computed } from '@vue/reactivity'\nimport InlineSvg from 'vue-inline-svg'\nimport { Icons } from '@/utils/Icons'\nimport { useLocale } from '@/composables/useLocale'\n\nconst props = defineProps<{\n  appInfo?: PassageAppInfo\n}>()\n\nconst { t } = useLocale()\n\nconst allowedIdentifier = computed<string>(() => {\n  switch (props.appInfo?.allowed_identifier) {\n    case Identifier.phone:\n      return t('phone-number')\n    case Identifier.both:\n      return t('email-or-phone-number')\n    default:\n      return t('email-address')\n  }\n})\n</script>\n","<template>\n  <div class=\"view-email-input\">\n    <div class=\"auth-flex-container\">\n      <div v-if=\"!loading\" class=\"title main-title has-text-centered\">\n        {{ showLogin ? t('login-title') : t('register-title') }}\n      </div>\n      <div style=\"height: 20px\"></div>\n      <login\n        v-if=\"!loading\"\n        v-show=\"showLogin\"\n        v-model:identifier=\"identifier\"\n        :canToggleLoginRegister=\"true\"\n        v-model:countryCode=\"countryCode\"\n        :appInfo=\"appInfo!\"\n        :webauthnAllowed=\"webauthnAllowed\"\n        :visible=\"showLogin\"\n      ></login>\n      <register\n        v-if=\"!loading\"\n        v-show=\"!showLogin\"\n        v-model:identifier=\"identifier\"\n        :canToggleLoginRegister=\"true\"\n        v-model:countryCode=\"countryCode\"\n        :appInfo=\"appInfo!\"\n        :webauthnAllowed=\"webauthnAllowed\"\n      />\n      <div v-if=\"invalidAppId\" class=\"notification is-danger has-text-centered\" data-test=\"invalid-app-id\">\n        {{ t('invalid-app-id') }}\n      </div>\n      <div class=\"spacer\">\n        <ephemeral-app-info />\n      </div>\n      <div v-if=\"!loading\" class=\"link has-text-centered\">\n        <div v-if=\"showLogin && publicSignup\">\n          {{ t('dont-have-an-account') }}\n          <a @click.prevent=\"changeInputPage\" role=\"button\" data-test=\"register-link\">{{ t('register-here') }}</a>\n        </div>\n        <div v-else-if=\"!showLogin\">\n          {{ t('already-have-an-account') }}\n          <a @click.prevent=\"changeInputPage\" role=\"button\" data-test=\"login-link\">{{ t('login-here') }}</a>\n        </div>\n      </div>\n      <help-footer v-if=\"!loading\" :appInfo=\"appInfo\" />\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, ref } from 'vue'\nimport { useAppInfo } from '@/composables/useAppInfo'\nimport Login from '../components/Login/Login.vue'\nimport Register from '../components/Register/Register.vue'\nimport EphemeralAppInfo from '../components/EphemeralAppInfo/EphemeralAppInfo.vue'\nimport HelpFooter from '../components/HelpFooter/HelpFooter.vue'\nimport { useLocale } from '@/composables/useLocale'\nimport { useDefaultCountryCode } from '@/composables/useDefaultCountryCode'\n\nconst { t } = useLocale()\n\nconst props = defineProps<{\n  register?: boolean\n}>()\n\nconst showLogin = ref<boolean>(!props.register)\n\nconst { appInfo, loading, webauthnAllowed, invalidAppId } = useAppInfo()\n\nconst identifier = ref<string>('')\n\nconst { defaultCountryCode } = useDefaultCountryCode()\nconst countryCode = defaultCountryCode\n\nconst publicSignup = computed<boolean>(() => {\n  return appInfo.value ? appInfo.value?.public_signup : false\n})\n\nfunction changeInputPage() {\n  showLogin.value = !showLogin.value\n}\n</script>\n","<template>\n  <div class=\"view-email-input\">\n    <login\n      v-if=\"!loading\"\n      v-model:identifier=\"identifier\"\n      v-model:countryCode=\"countryCode\"\n      :canToggleLoginRegister=\"false\"\n      :appInfo=\"appInfo!\"\n      :webauthnAllowed=\"webauthnAllowed\"\n    ></login>\n    <div v-if=\"invalidAppId\" class=\"notification is-danger has-text-centered\" data-test=\"invalid-app-id\">\n      {{ t('invalid-app-id') }}\n    </div>\n    <help-footer v-if=\"!loading\" :appInfo=\"appInfo\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useAppInfo } from '@/composables/useAppInfo'\nimport { ref } from 'vue'\nimport Login from '../components/Login/Login.vue'\nimport HelpFooter from '../components/HelpFooter/HelpFooter.vue'\nimport { useLocale } from '@/composables/useLocale'\nimport { useDefaultCountryCode } from '@/composables/useDefaultCountryCode'\n\nconst { t } = useLocale()\n\nconst identifier = ref<string>('')\nconst { defaultCountryCode } = useDefaultCountryCode()\nconst countryCode = defaultCountryCode\n\nconst { appInfo, loading, webauthnAllowed, invalidAppId } = useAppInfo()\n</script>\n","<template>\n  <div class=\"view-email-input\">\n    <register\n      v-if=\"!loading\"\n      v-model:identifier=\"identifier\"\n      v-model:countryCode=\"countryCode\"\n      :canToggleLoginRegister=\"false\"\n      :appInfo=\"appInfo!\"\n      :webauthnAllowed=\"webauthnAllowed\"\n    />\n    <div v-if=\"invalidAppId\" class=\"notification is-danger has-text-centered\" data-test=\"invalid-app-id\">\n      {{ t('invalid-app-id') }}\n    </div>\n    <help-footer v-if=\"!loading\" :appInfo=\"appInfo\" />\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { useAppInfo } from '@/composables/useAppInfo'\nimport { ref } from 'vue'\nimport Register from '../components/Register/Register.vue'\nimport HelpFooter from '../components/HelpFooter/HelpFooter.vue'\nimport { useLocale } from '@/composables/useLocale'\nimport { useDefaultCountryCode } from '@/composables/useDefaultCountryCode'\n\nconst { t } = useLocale()\n\nconst identifier = ref<string>('')\nconst { defaultCountryCode } = useDefaultCountryCode()\nconst countryCode = defaultCountryCode\n\nconst { appInfo, loading, webauthnAllowed, invalidAppId } = useAppInfo()\n</script>\n","<template>\n  <div class=\"spinner-box\">\n    <div class=\"spinner-content\">\n      <slot></slot>\n    </div>\n  </div>\n</template>\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\n\nexport default defineComponent({\n  name: 'Spinner',\n})\n</script>\n","<template>\n  <div class=\"auth-flex-container\">\n    <div class=\"title has-text-centered\">\n      <span>{{ title }}</span>\n    </div>\n\n    <spinner>\n      <inline-svg v-if=\"isEmail\" :src=\"Icons.email\" alt=\"Email envelope\" />\n      <inline-svg v-else :src=\"Icons.phone\" alt=\"Message bubbles\" />\n    </spinner>\n\n    <div v-if=\"message\" class=\"content has-text-centered\" style=\"margin-bottom: 15px !important\">\n      <span v-html=\"message\"></span>\n    </div>\n\n    <div class=\"flex-row flex-center\">\n      <button\n        @click.prevent=\"resendMagicLink\"\n        type=\"button\"\n        class=\"button is-primary\"\n        part=\"button\"\n        :disabled=\"loading\"\n      >\n        {{ t('resend-isemail-email-message', [isEmail ? t('email') : t('message')]) }}\n      </button>\n    </div>\n\n    <div class=\"spacer\"></div>\n\n    <div class=\"link has-text-centered\">\n      <a @click.prevent=\"changeEmail\" role=\"button\" data-test=\"change-email-button\">{{\n        t('change-isemail-email-phone', [isEmail ? t('email') : t('phone')])\n      }}</a>\n    </div>\n  </div>\n</template>\n\n<script setup lang=\"ts\">\nimport { computed, onMounted, ref } from 'vue'\nimport { Passage, authResult as AuthResult } from '@passageidentity/passage-js'\nimport { useAppId } from '@/composables/useAppId'\nimport { useRouter } from '@/PassageAuth/composables/useRouter'\nimport { useCallbacks, OnEventType } from '@/composables/useCallbacks'\nimport { IdentifierType } from '../ValidatedIdentifierForm/IntentifierTypes'\nimport Spinner from '../../../ui-components/Spinner.vue'\nimport { Icons } from '@/utils/Icons'\nimport InlineSvg from 'vue-inline-svg'\nimport { storeLastLogin } from '@/utils/lastLogin'\nimport { useLocale } from '@/composables/useLocale'\n\nconst props = defineProps<{\n  identifier: string\n  userIsRegistering: boolean\n  identifierVerifying: boolean\n  setupNewDevice: boolean\n  identifierType: IdentifierType\n}>()\nconst { t, locale } = useLocale()\nconst { appId } = useAppId()\nconst passage = new Passage(appId.value)\nconst { router } = useRouter()\nconst isEmail = computed<boolean>(() => {\n  return props.identifierType === IdentifierType.email\n})\n\nconst title = computed<string>(() => {\n  if (props.identifierVerifying) {\n    if (isEmail.value) {\n      if (props.userIsRegistering) {\n        return t('verify-email-to-register')\n      } else {\n        return t('verify-email-to-login')\n      }\n    } else {\n      if (props.userIsRegistering) {\n        return t('verify-phone-to-register')\n      } else {\n        return t('verify-phone-to-login')\n      }\n    }\n  } else {\n    if (isEmail.value) {\n      if (props.userIsRegistering) {\n        return t('check-email-to-register')\n      } else {\n        return t('check-email-to-login')\n      }\n    } else {\n      if (props.userIsRegistering) {\n        return t('check-phone-to-register')\n      } else {\n        return t('check-phone-to-login')\n      }\n    }\n  }\n})\n\nconst message = computed<string>(() => {\n  let messageValue = ''\n  const messageType = props.identifierType === IdentifierType.email ? t('messagetype-email') : t('messagetype-sms')\n  const messageMedium = props.identifierType === IdentifierType.email ? t('email') : t('phone-number')\n  const registrationType = props.userIsRegistering ? t('registration') : t('login')\n  const loginMessage = props.identifierVerifying\n    ? t('please-verify-identifier', [messageMedium, registrationType])\n    : t('you-will-be-automatically-signed-in')\n  messageValue = t('weve-sent-messagetype', [messageType, props.identifier, loginMessage])\n  if (props.setupNewDevice && !props.userIsRegistering) {\n    messageValue = t('we-dont-recognize-this-device') + ' ' + messageValue\n  }\n  return messageValue\n})\n\nonMounted(() => {\n  if (props.userIsRegistering) {\n    magicLinkSendRegister()\n  } else {\n    magicLinkSendLogin()\n  }\n})\n\nfunction changeEmail() {\n  localStorage.removeItem('email')\n  localStorage.removeItem('magic_link_id')\n  localStorage.removeItem('wait_count')\n  waitForActivatedMagicLink(721) // past the 1 hour polling limit\n  router.push(router.homeRoute)\n}\n\nasync function resendMagicLink(): Promise<void> {\n  await magicLinkSendLogin()\n}\n\nconst showWaiting = ref<boolean>(false)\nconst loading = ref<boolean>(true)\nasync function magicLinkSendRegister() {\n  showWaiting.value = false\n  loading.value = true\n\n  // Wait n seconds so user knows something happened\n  await new Promise((resolve) => {\n    setTimeout(resolve, 2000)\n  })\n\n  try {\n    const res = await passage.newRegisterMagicLink(props.identifier, locale.value.split('-')[0])\n\n    if (res.id != '') {\n      localStorage.setItem('magic_link_id', res.id)\n      waitForActivatedMagicLink(0)\n    }\n  } catch (err) {\n    console.log('magicLinkSend error', err)\n  } finally {\n    loading.value = false\n  }\n}\n\nasync function magicLinkSendLogin() {\n  showWaiting.value = false\n  loading.value = true\n\n  try {\n    const res = await passage.newLoginMagicLink(props.identifier, locale.value.split('-')[0])\n\n    if (res.id != '') {\n      localStorage.setItem('magic_link_id', res.id)\n      waitForActivatedMagicLink(0)\n    }\n  } catch (err) {\n    console.log('magicLinkSend error', err)\n  } finally {\n    // Disable the resend email button for 3 seconds\n    await new Promise((resolve) => {\n      setTimeout(resolve, 3000)\n    })\n    loading.value = false\n  }\n}\n\nlet authResult: AuthResult | undefined = undefined\nasync function lookupMagicLink() {\n  const id = localStorage.getItem('magic_link_id')\n  // eslint-disable-next-line @typescript-eslint/no-non-null-assertion\n  await lookupMagicLinkActivated(id!).then(async () => {\n    if (authResult && authResult.redirect_url != '') {\n      localStorage.removeItem('magic_link_id')\n      localStorage.removeItem('wait_count')\n      await storeLastLogin()\n      useCallbacks().onEvent.value(OnEventType.onMagicLinkActivated)\n      useCallbacks().onSuccess.value(authResult)\n    }\n  })\n}\nasync function lookupMagicLinkActivated(id: string) {\n  await passage\n    .getMagicLinkStatus(id)\n    // eslint-disable-next-line @typescript-eslint/no-explicit-any\n    .then((res: AuthResult) => {\n      waitForActivatedMagicLink(721) //past the 1 hour polling limit -- stops lookup\n      authResult = res\n    })\n    .catch(() => {\n      // this is a totally normal error to get to, so don't do anything\n      // waiting for the user to click the magic link\n      //console.error('lookup error', e)\n    })\n  return\n}\n\nlet timer: NodeJS.Timeout\nfunction waitForActivatedMagicLink(count: number) {\n  let i = count\n  if (i < 720) {\n    showWaiting.value = true\n    timer = setTimeout(async () => {\n      delay(i)\n      i++\n      waitForActivatedMagicLink(i)\n    }, 5000)\n  } else {\n    clearTimeout(timer)\n    showWaiting.value = false\n    return\n  }\n}\n\nfunction delay(i: number) {\n  lookupMagicLink()\n  localStorage.setItem('wait_count', i.toString())\n}\n</script>\n","<template>\n  <div class=\"view-access-token\">\n    <magic-link\n      :identifier=\"identifier\"\n      :userIsRegistering=\"userIsRegistering\"\n      :identifierVerifying=\"identifierVerifying\"\n      :setupNewDevice=\"setupNewDevice\"\n      :identifierType=\"identifierType\"\n    />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport MagicLink from '../components/MagicLink/MagicLink.vue'\nimport { IdentifierType } from '../components/ValidatedIdentifierForm/IntentifierTypes'\n\nexport default defineComponent({\n  name: 'MagicLinkView',\n  props: {\n    identifier: {\n      type: String,\n      required: true,\n    },\n    userIsRegistering: {\n      type: Boolean,\n      default: false,\n    },\n    identifierVerifying: {\n      type: Boolean,\n      default: false,\n    },\n    setupNewDevice: {\n      type: Boolean,\n      default: false,\n    },\n    identifierType: {\n      type: String as () => IdentifierType,\n      required: true,\n    },\n  },\n  components: {\n    MagicLink,\n  },\n})\n</script>\n","<template>\n  <div class=\"auth-flex-container\">\n    <div class=\"title secondary-title has-text-centered\">\n      {{ title }}\n    </div>\n\n    <figure class=\"image has-text-centered\">\n      <inline-svg\n        v-if=\"showFailure && isEmail\"\n        :src=\"Icons.loginWithEmail\"\n        alt=\"Biometrics scan failed\"\n        style=\"margin: 5px\"\n      />\n      <inline-svg\n        v-else-if=\"showFailure && !isEmail\"\n        :src=\"Icons.loginWithText\"\n        alt=\"Biometrics scan failed\"\n        style=\"margin: 5px\"\n      />\n      <platform-icon v-else />\n    </figure>\n\n    <div\n      class=\"content wrap-text has-text-centered\"\n      style=\"margin-bottom: 10px !important\"\n      data-tag=\"register-device-message\"\n    >\n      <div v-if=\"identifier\" style=\"margin-bottom: 5px\">\n        <strong>{{ identifier }}</strong>\n      </div>\n      <div v-if=\"showFailure\">\n        <p>\n          {{\n            isEmail ? t('registration-with-link-error-message-email') : t('registration-with-link-error-message-phone')\n          }}\n        </p>\n      </div>\n      <div v-else>\n        <div style=\"margin-bottom: 10px\">\n          {{ t('register-your-account') }}\n        </div>\n        <div>\n          {{ t('does-not-give-app-personal-info') }}\n        </div>\n      </div>\n    </div>\n\n    <div class=\"flex-row flex-center\" v-if=\"showFailure\">\n      <button\n        @click.prevent=\"registerWithEmail\"\n        type=\"button\"\n        part=\"button\"\n        class=\"button is-primary small\"\n        :disabled=\"loading\"\n        style=\"margin-right: 5px\"\n        data-test=\"login-with-email-button\"\n        ref=\"autofocusButton\"\n      >\n        {{ t('send-email-or-text-link', [isEmail ? t('email') : t('sms-text')]) }}\n      </button>\n      <button\n        @click.prevent=\"onButtonClick\"\n        type=\"button\"\n        part=\"button\"\n        class=\"button is-secondary small\"\n        :disabled=\"loading\"\n        style=\"margin-left: 5px\"\n      >\n        {{ t('try-again') }}\n      </button>\n    </div>\n\n    <div class=\"flex-row flex-center\" v-else>\n      <button\n        @click.prevent=\"onButtonClick\"\n        type=\"button\"\n        class=\"button\"\n        part=\"button\"\n        :class=\"[{ 'is-loading': loading }]\"\n        :disabled=\"loading\"\n        data-test=\"register-main-button\"\n        tabindex=\"0\"\n        ref=\"autofocusButton\"\n      >\n        <span>{{ t('register-with-device') }}</span>\n      </button>\n    </div>\n\n    <div class=\"content has-text-centered\" style=\"margin-top: 20px !important\" v-if=\"showFailure\">\n      <div class=\"link\">\n        <a @click.prevent=\"changeEmail\" role=\"button\" data-test=\"change-email-button\">{{\n          t('change-isemail-email-phone', [isEmail ? t('email') : t('phone')])\n        }}</a>\n      </div>\n    </div>\n\n    <div class=\"spacer\" v-if=\"!showFailure\"></div>\n\n    <div class=\"flex-row flex-wrap flex-between\" v-if=\"!showFailure\">\n      <div class=\"link\">\n        <a @click.prevent=\"changeEmail\" role=\"button\" data-test=\"change-email-button\">{{\n          t('change-isemail-email-phone', [isEmail ? t('email') : t('phone')])\n        }}</a>\n      </div>\n      <div class=\"link\">\n        <a @click.prevent=\"registerWithEmail\" role=\"button\" data-test=\"register-email-button\">{{\n          t('register-with-link', [isEmail ? t('email') : t('sms-text')])\n        }}</a>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent, ref } from 'vue'\nimport { Passage, authResult } from '@passageidentity/passage-js'\nimport { useAppId } from '@/composables/useAppId'\nimport { useRouter } from '@/PassageAuth/composables/useRouter'\nimport { MagicLinkRoute } from '@/PassageAuth/router/routes'\nimport { useCallbacks } from '@/composables/useCallbacks'\nimport { IdentifierType } from '../ValidatedIdentifierForm/IntentifierTypes'\nimport { Icons } from '@/utils/Icons'\nimport InlineSvg from 'vue-inline-svg'\nimport PlatformIcon from '@/components/PlatformIcon/PlatformIcon.vue'\nimport { storeLastLogin } from '@/utils/lastLogin'\nimport { useLocale } from '@/composables/useLocale'\nimport { useAutofocusButton } from '@/composables/useAutofocusButton'\n\nexport default defineComponent({\n  name: 'RegisterDevice',\n  components: {\n    InlineSvg,\n    PlatformIcon,\n  },\n  props: {\n    identifier: {\n      type: String,\n      required: true,\n    },\n    identifierType: {\n      type: String as () => IdentifierType,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { t } = useLocale()\n    const { appId } = useAppId()\n    const { router } = useRouter()\n    const { onSuccess } = useCallbacks()\n    const showFailure = ref<boolean>(false)\n\n    const { autofocusButton } = useAutofocusButton()\n\n    const isEmail = computed<boolean>(() => {\n      return props.identifierType === IdentifierType.email\n    })\n\n    const title = computed<string>(() => {\n      if (showFailure.value) {\n        return t('register-with-link', [isEmail.value ? t('email') : t('sms-text')])\n      }\n      return t('register-without-a-password')\n    })\n\n    return {\n      appId,\n      router,\n      onSuccess,\n      isEmail,\n      showFailure,\n      title,\n      Icons,\n      t,\n      autofocusButton,\n    }\n  },\n  data: () => {\n    return {\n      loading: false,\n      authResult: null as unknown as authResult,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      passage: null as any,\n    }\n  },\n  created: function () {\n    this.passage = new Passage(this.appId)\n  },\n  methods: {\n    async signUpWebAuthn(identifier: string): Promise<void> {\n      this.loading = true\n      this.showFailure = false\n      this.authResult = { auth_token: '', redirect_url: '' }\n      try {\n        const res = await this.passage.register(identifier)\n        this.authResult = res\n\n        // Update state\n        this.loading = false\n\n        if (this.authResult.redirect_url) {\n          // alert(\"User with email: \" + this.email + \"--- NOT SIGNED UP\")\n          storeLastLogin(identifier)\n          this.onSuccess(this.authResult)\n        }\n      } catch (err) {\n        this.showFailure = true\n        this.loading = false\n      }\n    },\n    registerWithEmail() {\n      if (this.showFailure) {\n        this.router.push(MagicLinkRoute, {\n          identifier: this.identifier,\n          identifierType: this.identifierType,\n          userIsRegistering: false,\n        })\n      } else {\n        this.router.push(MagicLinkRoute, {\n          identifier: this.identifier,\n          identifierType: this.identifierType,\n          userIsRegistering: true,\n        })\n      }\n    },\n    changeEmail() {\n      localStorage.removeItem('email')\n      this.router.push(this.router.homeRoute, { register: true })\n    },\n    redirectNow() {\n      if (this.authResult.redirect_url) {\n        storeLastLogin(this.identifier)\n        this.onSuccess(this.authResult)\n      }\n    },\n    onButtonClick() {\n      this.signUpWebAuthn(this.identifier)\n    },\n  },\n})\n</script>\n","<template>\n  <register-device :identifier=\"identifier\" :identifierType=\"identifierType\" />\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport RegisterDevice from '../components/RegisterDevice/RegisterDevice.vue'\nimport { IdentifierType } from '../components/ValidatedIdentifierForm/IntentifierTypes'\n\nexport default defineComponent({\n  name: 'RegisterDeviceView',\n  props: {\n    identifier: {\n      type: String,\n      required: true,\n    },\n    identifierType: {\n      type: String as () => IdentifierType,\n      required: true,\n    },\n  },\n  components: {\n    RegisterDevice,\n  },\n})\n</script>\n","<template>\n  <div class=\"auth-flex-container\">\n    <div class=\"title has-text-centered\">\n      {{ showFailure ? t('login-with-link', [isEmail ? t('email') : t('sms-text')]) : t('verify-your-identity') }}\n    </div>\n    <figure class=\"image has-text-centered\" style=\"margin: 5px auto\">\n      <inline-svg\n        v-if=\"showFailure && isEmail\"\n        :src=\"Icons.loginWithEmail\"\n        alt=\"Biometrics scan failed\"\n        style=\"margin: 5px\"\n      />\n      <inline-svg\n        v-else-if=\"showFailure && !isEmail\"\n        :src=\"Icons.loginWithText\"\n        alt=\"Biometrics scan failed\"\n        style=\"margin: 5px\"\n      />\n      <platform-icon v-else />\n    </figure>\n    <div class=\"content wrap-text has-text-centered\" style=\"margin-bottom: 25px !important\" v-if=\"!showFailure\">\n      <div v-if=\"identifier\" style=\"margin-bottom: 5px\">\n        <strong>{{ identifier }}</strong>\n      </div>\n      <div>{{ t('log-into-your-account') }}</div>\n    </div>\n\n    <div class=\"content wrap-text has-text-centered\" style=\"margin-bottom: 5px !important\" v-else-if=\"showFailure\">\n      <div v-if=\"identifier\" style=\"margin-bottom: 5px\">\n        <strong>{{ identifier }}</strong>\n      </div>\n      <div data-test=\"failure-message\">\n        <p>{{ isEmail ? t('login-with-link-error-message-email') : t('login-with-link-error-message-phone') }}</p>\n      </div>\n    </div>\n\n    <div class=\"flex-row flex-center\" v-if=\"showFailure\">\n      <button\n        @click.prevent=\"loginWithEmail\"\n        type=\"button\"\n        part=\"button\"\n        class=\"button is-primary small\"\n        :disabled=\"loading\"\n        style=\"margin-right: 5px\"\n        data-test=\"login-with-email-button\"\n        ref=\"autofocusButton\"\n      >\n        {{ t('send-email-or-text-link', [isEmail ? t('email') : t('sms-text')]) }}\n      </button>\n      <button\n        @click.prevent=\"signInWebAuthn\"\n        type=\"button\"\n        part=\"button\"\n        class=\"button is-secondary small\"\n        :disabled=\"loading\"\n        style=\"margin-left: 5px\"\n      >\n        {{ t('try-again') }}\n      </button>\n    </div>\n\n    <div class=\"content has-text-centered\" style=\"margin-top: 20px !important\" v-if=\"showFailure\">\n      <div class=\"link\">\n        <a @click.prevent=\"changeEmail\" role=\"button\" data-test=\"change-email-button\">{{\n          t('change-isemail-email-phone', [isEmail ? t('email') : t('phone')])\n        }}</a>\n      </div>\n    </div>\n\n    <div class=\"spacer\" v-if=\"!showFailure\"></div>\n\n    <div class=\"flex-row flex-wrap flex-between\" v-if=\"!showFailure\">\n      <div class=\"link\">\n        <a @click.prevent=\"changeEmail\" role=\"button\" data-test=\"change-email-button\">{{\n          t('change-isemail-email-phone', [isEmail ? t('email') : t('phone')])\n        }}</a>\n      </div>\n      <div class=\"link\">\n        <a @click.prevent=\"loginWithEmail\" role=\"button\" data-test=\"register-email-button\">{{\n          t('login-with-link', [isEmail ? t('email') : t('sms-text')])\n        }}</a>\n      </div>\n    </div>\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { computed, defineComponent } from 'vue'\nimport { Passage, authResult, PassageError, PassageErrorCode } from '@passageidentity/passage-js'\nimport { useAppId } from '@/composables/useAppId'\nimport { useRouter } from '@/PassageAuth/composables/useRouter'\nimport { MagicLinkRoute } from '@/PassageAuth/router/routes'\nimport { useCallbacks } from '@/composables/useCallbacks'\nimport { IdentifierType } from '../ValidatedIdentifierForm/IntentifierTypes'\nimport { Icons } from '@/utils/Icons'\nimport InlineSvg from 'vue-inline-svg'\nimport PlatformIcon from '@/components/PlatformIcon/PlatformIcon.vue'\nimport { storeLastLogin } from '@/utils/lastLogin'\nimport { useLocale } from '@/composables/useLocale'\nimport { useAutofocusButton } from '@/composables/useAutofocusButton'\n\nexport default defineComponent({\n  name: 'WebauthnSignIn',\n  components: {\n    InlineSvg,\n    PlatformIcon,\n  },\n  props: {\n    identifier: {\n      type: String,\n      required: true,\n    },\n    identifierType: {\n      type: String as () => IdentifierType,\n      required: true,\n    },\n  },\n  setup(props) {\n    const { t } = useLocale()\n    const { appId } = useAppId()\n    const { router } = useRouter()\n    const isEmail = computed<boolean>(() => {\n      return props.identifierType === IdentifierType.email\n    })\n\n    const { autofocusButton } = useAutofocusButton()\n\n    return {\n      appId,\n      router,\n      isEmail,\n      Icons,\n      t,\n      autofocusButton,\n    }\n  },\n  data: () => {\n    return {\n      showFailure: false,\n      loading: false,\n      // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      passage: null as any,\n      authResult: null as unknown as authResult,\n    }\n  },\n  created: function () {\n    this.passage = new Passage(this.appId)\n  },\n  mounted() {\n    this.signInWebAuthn()\n  },\n  methods: {\n    async signInWebAuthn() {\n      this.authResult = { auth_token: '', redirect_url: '' }\n      this.showFailure = false\n\n      if (!this.identifier) {\n        return\n      }\n\n      this.loading = true\n\n      try {\n        const res = await this.passage.login(this.identifier)\n        this.authResult = res\n        if (this.authResult.redirect_url) {\n          storeLastLogin(this.identifier)\n          useCallbacks().onSuccess.value(this.authResult)\n        }\n        this.loading = false\n        // eslint-disable-next-line @typescript-eslint/no-explicit-any\n      } catch (err: any) {\n        const error = err as PassageError\n        this.showFailure = true\n        this.loading = false\n        if (error.statusCode === PassageErrorCode.PSGParsePublicKeyForLoginFailed) {\n          // TODO: handle this\n          this.showFailure = true\n        } else {\n          this.router.push(MagicLinkRoute, { identifier: this.identifier, identifierType: this.identifierType })\n        }\n      }\n    },\n    loginWithEmail() {\n      this.router.push(MagicLinkRoute, { identifier: this.identifier, identifierType: this.identifierType })\n    },\n    changeEmail() {\n      localStorage.removeItem('email')\n      this.router.push(this.router.homeRoute)\n    },\n  },\n})\n</script>\n","<template>\n  <div class=\"view-webauthn-sign-in\">\n    <webauthn-sign-in :identifier=\"identifier\" :identifierType=\"identifierType\" />\n  </div>\n</template>\n\n<script lang=\"ts\">\nimport { defineComponent } from 'vue'\nimport WebauthnSignIn from '../components/WebauthnSignIn/WebauthnSignIn.vue'\nimport { IdentifierType } from '../components/ValidatedIdentifierForm/IntentifierTypes'\n\nexport default defineComponent({\n  name: 'WebauthnSignInView',\n  props: {\n    identifier: {\n      type: String,\n      required: true,\n    },\n    identifierType: {\n      type: String as () => IdentifierType,\n      required: true,\n    },\n  },\n  components: {\n    WebauthnSignIn,\n  },\n})\n</script>\n","<template>\n  <component :is=\"currentComponent\" v-bind=\"currentProps\"><slot></slot></component>\n</template>\n<script lang=\"ts\">\nimport { defineComponent, computed } from 'vue'\nimport { useRouter } from '@/PassageAuth/composables/useRouter'\nimport ActivateMagicLinkView from '../../views/ActivateMagicLinkView.vue'\nimport AuthView from '../../views/AuthView.vue'\nimport LoginView from '../../views/LoginView.vue'\nimport RegisterView from '../../views/RegisterView.vue'\nimport MagicLinkView from '../../views/MagicLinkView.vue'\nimport RegisterDeviceView from '../../views/RegisterDeviceView.vue'\nimport WebauthnSignInView from '../../views/WebauthnSignInView.vue'\n\nexport default defineComponent({\n  name: 'RouterView',\n  components: {\n    ActivateMagicLinkView,\n    AuthView,\n    LoginView,\n    RegisterView,\n    MagicLinkView,\n    RegisterDeviceView,\n    WebauthnSignInView,\n  },\n  setup() {\n    const { currentRoute } = useRouter()\n    const currentComponent = computed<string>(() => currentRoute.value.component)\n    const currentProps = computed(() => {\n      const props = currentRoute.value.props\n      if (props === undefined) {\n        return {}\n      }\n      return props\n    })\n\n    return {\n      currentComponent,\n      currentProps,\n    }\n  },\n})\n</script>\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}